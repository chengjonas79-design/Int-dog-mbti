<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>èŒå® è”èŒ Â· æ¯›å­©å­MBTIæ€§æ ¼æµ‹è¯•</title>
  <style>
    :root{
      --bg:#f6f7fb; --card:#fff; --text:#111; --muted:#666;
      --pri:#2b6aff; --pri2:#eef2ff; --shadow:0 10px 26px rgba(0,0,0,.08);
      --xhs-red: #ff2442;
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",Arial;color:var(--text);background:var(--bg); overflow-x: hidden;}
    .wrap{max-width:780px;margin:0 auto;padding:18px 16px 60px;}
    .card{background:var(--card);border-radius:16px;padding:20px;box-shadow:var(--shadow);margin:12px 0;}
    .title{font-size:24px;font-weight:900;margin:0 0 8px;letter-spacing:.2px; line-height: 1.3;}
    .sub{margin:0;color:var(--muted);line-height:1.6; font-size: 15px;}
    .row{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;}
    .tag{font-size:12px;color:var(--muted); background: #eee; padding: 2px 8px; border-radius: 4px;}
    .hr{height:1px;background:#eee;margin:16px 0;}
    .q{font-size:19px;font-weight:900;margin:0 0 16px; line-height: 1.4;}
    .opt{width:100%;text-align:left;border:2px solid transparent;border-radius:14px;padding:16px;margin:10px 0;font-size:16px;font-weight:700;cursor:pointer;background:#f7f8ff; transition: all 0.2s;}
    .opt:active{background: var(--pri2); border-color: var(--pri); transform: scale(0.98);}
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:15px;}
    button{border:0;border-radius:12px;padding:12px 18px;font-size:16px;font-weight:800;cursor:pointer; transition: opacity 0.2s;}
    button:active{opacity: 0.8;}
    .primary{background:var(--pri);color:#fff; flex: 1; min-width: 120px;}
    .ghost{background:var(--pri2);color:var(--pri); flex: 1; min-width: 120px;}
    .small{padding:10px 12px;border-radius:10px;font-size:14px;font-weight:800; flex: initial;}
    .muted{color:var(--muted);font-size:13px;line-height:1.7;}
    
    #panel { display: none; }
    
    .resultType{font-size:38px;font-weight:1000;letter-spacing:1px;margin:0; color: var(--pri);}

    .resultName{font-size:22px;font-weight:1000;margin:4px 0 6px;}
    .oneLine{font-size:15px;color:#444;line-height:1.7;margin:0; font-style: italic;}
    ul{padding-left:18px;margin:12px 0 0;}
    li{margin:6px 0;}
    .toast{position:fixed;left:50%;top:50%;transform:translate(-50%, -50%);background:rgba(0,0,0,.8);color:#fff;padding:12px 24px;border-radius:12px;font-size:15px;display:none;z-index:999; text-align: center; width: 80%; max-width: 300px;}
    .progressBar{height:6px;background:#eef0ff;border-radius:999px;overflow:hidden;margin-top:15px;}
    .progressBar>div{height:100%;background:var(--pri);width:0%; transition: width 0.3s;}
    
    /* ç”Ÿæˆæµ·æŠ¥æ ·å¼ï¼šå»¶ç»­ç»“æœé¡µè§†è§‰ç³»ç»Ÿ */
    .poster {
      width: 450px; height: 800px;
      background:
        radial-gradient(circle at 50% -12%, rgba(59,130,246,.14) 0%, rgba(59,130,246,0) 52%),
        linear-gradient(180deg, #FFFFFF 0%, #F7FAFF 100%);
      border-radius: 26px;
      border: 1px solid rgba(148, 182, 255, 0.34);
      padding: 30px 34px 34px;
      display: flex; flex-direction: column; align-items: center;
      color: #111827;
      box-shadow: 0 18px 44px rgba(38, 84, 155, 0.12);
      position: absolute; left: -9999px; top: 0;
    }
    
    .poster-brand {
      align-self: center;
      font-size: 13px;
      color: #9AA6BC;
      letter-spacing: 1.1px;
      margin-bottom: 24px;
      font-weight: 600;
    }
    
    .poster .avatar-wrap { margin: 0 0 26px; }
    .poster .avatar-circle { 
      width: 132px; 
      height: 132px; 
      border: 5px solid rgba(59, 130, 246, 0.28); 
      box-shadow: 0 10px 26px rgba(37,99,235,0.20);
      overflow: hidden;
      cursor: default;
    }
    .poster .avatar-circle:hover { 
      transform: none;
      border-color: rgba(59, 130, 246, 0.28);
      box-shadow: 0 10px 26px rgba(37,99,235,0.20);
    }
    .poster .avatar-circle::after { 
      display: none;
    }
    .poster .avatar-circle img {
      object-fit: cover;
    }
    
    .poster-header { text-align: center; width: 100%; margin-bottom: 16px; }
    .poster-title-main { font-size: 44px; font-weight: 800; color: #111827; line-height: 1.22; letter-spacing: 0.2px; max-width: 370px; margin: 0 auto; }
    
    .poster-center { text-align: center; width: 100%; display: flex; flex-direction: column; align-items: center; padding-bottom: 6px; }
    .poster-type-badge { 
      font-size: 88px; 
      font-weight: 900; 
      letter-spacing: 2px;
      background: transparent;
      color: #1D4ED8;
      margin: 0 0 14px;
      line-height: 1;
      text-shadow: 0 10px 24px rgba(29,78,216,.18);
    }
    .poster-name-sub { font-size: 28px; font-weight: 800; color: #111827; margin: 0 0 16px; line-height: 1.2; }
    .poster-gold-phrase { font-size: 19px; color: #4B5563; line-height: 1.65; margin-bottom: 24px; max-width: 356px; margin-left: auto; margin-right: auto; }
    
    .poster-pill-group { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 0; }
    .poster-pill-item { 
      min-height: 34px;
      padding: 0 16px;
      border-radius: 999px;
      background: linear-gradient(180deg, #F3F7FF 0%, #EAF1FF 100%);
      color: #1E40AF;
      border: 1px solid #D4E1FF;
      font-size: 16px;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
    }
    
    .poster-footer {
      position: relative;
      width: 100%;
      margin-top: auto;
      padding: 0;
      display: grid;
      grid-template-columns: 1fr 144px;
      gap: 12px;
      align-items: end;
    }
    
    .poster-cta-card {
      background: linear-gradient(180deg, #FFFFFF 0%, #F7FAFF 100%);
      border-radius: 16px;
      border: 1px solid #E2EAFF;
      box-shadow: 0 8px 20px rgba(38,84,155,.10);
      padding: 12px;
      height: 144px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    
    .poster-cta-title {
      font-size: 24px;
      font-weight: 800;
      color: #0F172A;
      margin-bottom: 8px;
      line-height: 1.3;
    }
    
    .poster-cta-subtitle {
      font-size: 16px;
      color: #4B5563;
      margin-bottom: 4px;
      line-height: 1.5;
    }
    
    .poster-cta-hint {
      font-size: 15px;
      color: #6B7280;
      line-height: 1.45;
    }
    
    .qr-sticker-card {
      background: linear-gradient(180deg, #FFFFFF 0%, #F7FAFF 100%);
      border-radius: 16px;
      border: 1px solid #E2EAFF;
      padding: 12px;
      height: 144px;
      box-shadow: 0 8px 20px rgba(38,84,155,.10);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }
    
    .qr-sticker-card .qr-img-box {
      width: 110px;
      height: 110px;
      border-radius: 8px;
      overflow: hidden;
      background: white;
      border: 1px solid #E2EAFF;
    }
    
    .qr-sticker-card .qr-img-box img {
      width: 110px;
      height: 110px;
      display: block;
    }
    
    .qr-sticker-card .qr-text-mini {
      text-align: center;
      font-size: 13px;
      color: #6B7280;
      line-height: 16px;
      min-height: 16px;
      font-weight: 700;
    }
    
    .footer-left { flex: 1; }
    .test-cta-title { font-size: 16px; font-weight: 800; color: #111827; margin-bottom: 4px; }
    .test-cta-sub { font-size: 13px; color: #6B7280; }
    
    .qr-box { text-align: center; }
    .qr-container { width: 90px; height: 90px; padding: 5px; border: 1px solid #E5E7EB; border-radius: 12px; background: #fff; margin-bottom: 4px; }
    .qr-label { font-size: 11px; color: #9CA3AF; }

    /* ä¼å¾®å¼¹çª—ï¼šä¸ç»“æœé¡µç»Ÿä¸€è§†è§‰ */
    .modal-mask {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(12, 24, 48, 0.42);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }
    .modal {
      background:
        radial-gradient(circle at 50% -12%, rgba(59,130,246,.16) 0%, rgba(59,130,246,0) 58%),
        linear-gradient(180deg, #FFFFFF 0%, #F8FAFF 100%);
      border-radius: 24px;
      border: 1px solid rgba(148, 182, 255, 0.36);
      box-shadow: 0 20px 44px rgba(15, 23, 42, 0.26);
      padding: 22px 20px 18px;
      width: 100%;
      max-width: 358px;
      position: relative;
      text-align: center;
    }
    .modal-close {
      position: absolute;
      right: 12px;
      top: 12px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 1px solid #D8E4FF;
      background: #fff;
      color: #8A94A7;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      line-height: 1;
      user-select: none;
    }
    .modal-close:active {
      background: #EEF3FF;
      transform: scale(0.97);
    }
    .modal-title {
      font-size: 28px;
      font-weight: 900;
      line-height: 1.25;
      margin-bottom: 8px;
      color: #0F172A;
      letter-spacing: 0.2px;
    }
    .modal-sub {
      font-size: 15px;
      color: #4B5563;
      line-height: 1.7;
      margin-bottom: 10px;
    }
    .wecom-type-chip {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-height: 30px;
      padding: 0 12px;
      border-radius: 999px;
      border: 1px solid #D4E1FF;
      background: linear-gradient(180deg, #F3F7FF 0%, #EAF1FF 100%);
      color: #1E40AF;
      font-size: 13px;
      font-weight: 800;
      margin-bottom: 12px;
    }
    .wecom-type-chip b {
      margin-left: 4px;
      color: #1D4ED8;
      font-weight: 900;
    }
    .wecom-steps {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin: 0 0 12px;
    }
    .wecom-step {
      background: rgba(255,255,255,0.8);
      border: 1px solid #E3EBFF;
      border-radius: 10px;
      padding: 7px 8px;
      font-size: 12px;
      color: #475569;
      line-height: 1.5;
      font-weight: 700;
    }
    .wecom-qr-box {
      background: linear-gradient(180deg, #F8FAFF 0%, #F1F6FF 100%);
      border-radius: 14px;
      padding: 12px;
      margin: 0 0 12px;
      border: 1px solid #E3EBFF;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.75);
    }
    .wecom-qr-inner {
      background: #fff;
      border: 1px solid #DCE7FF;
      border-radius: 12px;
      padding: 10px;
    }
    .wecom-qr-inner img {
      width: 100%;
      max-width: 210px;
      aspect-ratio: 1 / 1;
      display: block;
      margin: 0 auto;
      border-radius: 8px;
    }
    .wecom-note {
      font-size: 12px;
      color: #7B8799;
      line-height: 1.6;
      margin: 0;
    }
    @media (max-width: 380px) {
      .modal { padding: 20px 16px 16px; }
      .modal-title { font-size: 24px; }
      .wecom-steps { grid-template-columns: 1fr; }
    }
    .pillRow { display: flex; gap: 8px; flex-wrap: wrap; margin: 12px 0; }
    .pill { background: var(--pri2); color: var(--pri); padding: 4px 12px; border-radius: 8px; font-size: 13px; font-weight: 700; }
    .community-card {
      background: linear-gradient(180deg, #F8FAFF 0%, #F2F6FF 100%);
      border: 1px solid #E3EBFF;
      border-radius: 14px;
      padding: 16px;
      margin-top: 20px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.7);
    }

    .page {
      max-width: 420px;
      margin: 0 auto;
      padding: 20px 16px;
      background:
        radial-gradient(circle at 50% -10%, rgba(59,130,246,.12) 0%, rgba(59,130,246,0) 48%),
        linear-gradient(180deg, #F5F7FF 0%, #F2F5FC 100%);
      border-radius: 24px;
    }
    .panel-result { background: transparent; box-shadow: none; padding: 0; }
    .result-card {
      background: linear-gradient(180deg, #FFFFFF 0%, #FAFCFF 100%);
      border-radius: 22px;
      box-shadow: 0 12px 34px rgba(38, 84, 155, 0.10);
      border: 1px solid rgba(148, 182, 255, 0.30);
      padding: 24px;
    }
    .result-title {
      font-size: 12px;
      font-weight: 600;
      color: #9AA6BC;
      line-height: 1.2;
      margin: 0 0 20px;
      text-align: center;
      letter-spacing: 1px;
    }
    .result-type {
      font-size: 56px;
      font-weight: 900;
      letter-spacing: 2px;
      text-align: center;
      margin: 0 0 12px;
      color: #1D4ED8;
      line-height: 1;
      text-shadow: 0 8px 24px rgba(29, 78, 216, 0.18);
    }
    .result-name {
      font-size: 34px;
      font-weight: 800;
      text-align: center;
      margin: 0 0 16px;
      color: #111827;
      line-height: 1.25;
    }
    .result-line {
      font-size: 15px;
      color: #4B5563;
      text-align: center;
      max-width: 286px;
      margin: 0 auto 20px;
      line-height: 1.7;
    }
    .result-tags {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      margin: 0 0 28px;
    }
    .result-card .tag {
      min-height: 30px;
      padding: 0 14px;
      border-radius: 999px;
      background: linear-gradient(180deg, #F3F7FF 0%, #EAF1FF 100%);
      color: #1E40AF;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      font-weight: 700;
      border: 1px solid #D4E1FF;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.8);
    }
    .section-title {
      font-weight: 800;
      margin-bottom: 12px;
      font-size: 16px;
      color: #0F172A;
      letter-spacing: 0.2px;
    }
    .tips-card {
      background: linear-gradient(180deg, #F8FAFF 0%, #F2F6FF 100%);
      border-radius: 14px;
      border: 1px solid #E3EBFF;
      padding: 16px;
      margin-bottom: 24px;
    }
    .tips-card ul { list-style: none; padding: 0; margin: 0; }
    .tips-card li { padding-left: 26px; position: relative; margin-bottom: 12px; line-height: 1.75; color: #1F2937; font-size: 15px; }
    .tips-card li:last-child { margin-bottom: 0; }
    .tips-card li::before { content: 'ğŸ¾'; position: absolute; left: 0; top: 1px; font-size: 14px; }

    .avatar-wrap { display: flex; justify-content: center; margin: 8px 0 24px; }
    .avatar-circle { width: 96px; height: 96px; border-radius: 50%; overflow: hidden; border: 3px solid #3B82F6; background: #f3f5ff; flex-shrink: 0; cursor: pointer; transition: all 0.3s; position: relative; box-shadow: 0 8px 20px rgba(37,99,235,0.2); }
    .avatar-circle:hover { transform: scale(1.05); border-color: #2563EB; box-shadow: 0 4px 12px rgba(37,99,235,0.3); }
    .avatar-circle img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .avatar-circle::after { content: "ç‚¹å‡»æ›´æ¢"; position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.6); color: white; font-size: 11px; text-align: center; padding: 4px 0; opacity: 0; transition: opacity 0.3s; }
    .avatar-circle:hover::after { opacity: 1; }

    .btn-primary, .primary { height: 46px; border-radius: 14px; background: linear-gradient(90deg,#2563EB,#1D4ED8); color: #fff; }
    .btn-ghost, .ghost { height: 46px; border-radius: 14px; background: #fff; color: #1D4ED8; border: 1.5px solid #3B82F6; }
    .result-card .btns { margin-top: 12px; }
    .result-card .btns button {
      width: 100%;
      min-width: 100%;
      height: 48px;
      border-radius: 14px;
      font-size: 19px;
      font-weight: 800;
      letter-spacing: 0.2px;
    }

    .qr-card { background: #fff; border-radius: 16px; padding: 16px; display: flex; align-items: flex-end; justify-content: space-between; gap: 14px; border: 1px solid #F3F4F6; }
    .qr-text { flex: 1; }
    .qr-text .test-cta-title { font-size: 16px; font-weight: 800; color: #111827; margin-bottom: 6px; }
    .qr-text .test-cta-sub { font-size: 13px; color: #6B7280; line-height: 1.5; }
    .qr-code { width: 160px; height: 160px; flex-shrink: 0; }
    .qr-code img { width: 100%; height: 100%; display: block; object-fit: cover; }



    .poster-preview {
      display: none;
      margin-top: 16px;
      padding: 14px;
      border-radius: 18px;
      background: linear-gradient(180deg, #F8FAFF 0%, #F3F7FF 100%);
      border: 1px solid #E3EBFF;
      box-shadow: 0 10px 24px rgba(38,84,155,0.08);
    }
    .poster-preview.is-show { display: block; }
    .poster-preview-title {
      font-size: 14px;
      color: #1E40AF;
      font-weight: 800;
      margin-bottom: 4px;
      text-align: center;
      letter-spacing: 0.3px;
    }
    .poster-preview-sub {
      font-size: 12px;
      color: #64748B;
      text-align: center;
      margin-bottom: 10px;
      line-height: 1.5;
    }
    .poster-image-wrap {
      position: relative;
    }
    img#posterImg {
      display: none;
      width: 100%;
      border-radius: 18px;
      box-shadow: 0 10px 26px rgba(38,84,155,0.16);
      border: 1px solid #D8E4FF;
    }
    .poster-avatar-hotspot {
      display: none;
      position: absolute;
      left: 50%;
      top: 17%;
      width: 30%;
      aspect-ratio: 1 / 1;
      transform: translate(-50%, -50%);
      border-radius: 50%;
      border: 2px dashed rgba(37, 99, 235, 0.35);
      background: rgba(59, 130, 246, 0.08);
      cursor: pointer;
      z-index: 2;
      outline: none;
    }
    .poster-avatar-hotspot::after {
      content: "ç‚¹å¤´åƒæ¢";
      position: absolute;
      left: 50%;
      bottom: -28px;
      transform: translateX(-50%);
      height: 20px;
      padding: 0 8px;
      border-radius: 10px;
      background: rgba(255,255,255,0.92);
      border: 1px solid #D4E1FF;
      color: #1E40AF;
      font-size: 11px;
      font-weight: 700;
      line-height: 20px;
      white-space: nowrap;
    }
    .poster-avatar-hotspot:active {
      transform: translate(-50%, -50%) scale(0.97);
    }
    .poster-preview.is-show .poster-avatar-hotspot {
      display: block;
    }
    .save-tip {
      display: none;
      margin-top: 12px;
      min-height: 44px;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 10px 12px;
      background: linear-gradient(90deg, #EEF3FF 0%, #E7EFFF 100%);
      border-radius: 12px;
      border: 1px solid #BCD0FF;
      color: #1E3A8A;
      font-size: 14px;
      font-weight: 700;
      line-height: 1.5;
    }
    /* ç»“æœé¡µç²¾ä¿®ç‰ˆï¼šæ¸©æš–æ²»æ„ˆ + é«˜ä¿¡æ¯å¯†åº¦ */
    .page.page-report {
      max-width: 430px;
      margin: 0 auto;
      padding: 12px;
      background:
        radial-gradient(circle at 22% -12%, rgba(255, 182, 143, 0.24) 0%, rgba(255, 182, 143, 0) 48%),
        radial-gradient(circle at 92% 0%, rgba(255, 222, 187, 0.45) 0%, rgba(255, 222, 187, 0) 42%),
        linear-gradient(180deg, #FFF8F2 0%, #FFFDFB 100%);
      border-radius: 24px;
      border: 1px solid #FFE5D2;
    }
    .page-report .result-card.result-overview {
      background: linear-gradient(180deg, #FFFFFF 0%, #FFF8F2 100%);
      border-radius: 20px;
      border: 1px solid #FFE3D0;
      box-shadow: 0 12px 28px rgba(216, 131, 90, 0.14);
      padding: 18px 18px 16px;
      margin-bottom: 12px;
    }
    .result-top-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      font-size: 12px;
      color: #B58972;
      letter-spacing: 0.2px;
    }
    .result-app {
      font-weight: 700;
    }
    .result-date {
      font-weight: 600;
      color: #C19B86;
    }
    .page-report .avatar-wrap {
      display: flex;
      justify-content: center;
      margin: 6px 0 14px;
    }
    .page-report .avatar-circle {
      width: 98px;
      height: 98px;
      border-radius: 50%;
      border: 3px solid #FFB78A;
      box-shadow: 0 8px 18px rgba(223, 132, 81, 0.24);
      background: #FFF1E7;
    }
    .page-report .result-type {
      font-size: 56px;
      margin: 0 0 8px;
      text-align: center;
      line-height: 1;
      font-weight: 900;
      letter-spacing: 2px;
      color: #FF6D4B;
      text-shadow: 0 8px 20px rgba(255, 109, 75, 0.20);
    }
    .page-report .result-name {
      font-size: 34px;
      text-align: center;
      font-weight: 900;
      color: #40261A;
      line-height: 1.24;
      margin: 0 0 12px;
      letter-spacing: 0.2px;
    }
    .page-report .result-line {
      font-size: 15px;
      color: #6F4B3A;
      text-align: center;
      margin: 0 auto 14px;
      line-height: 1.7;
      max-width: 300px;
    }
    .page-report .result-tags {
      margin: 0 0 14px;
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .page-report .result-card .tag {
      min-height: 30px;
      border-radius: 999px;
      border: 1px solid #FFD8C0;
      background: linear-gradient(180deg, #FFF6EF 0%, #FFEEDF 100%);
      color: #B85C37;
      font-size: 13px;
      font-weight: 800;
      display: inline-flex;
      align-items: center;
      padding: 0 14px;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.84);
    }
    .overview-mini {
      border-radius: 12px;
      border: 1px dashed #FFCDB1;
      background: rgba(255, 244, 235, 0.84);
      color: #8D5A44;
      font-size: 13px;
      line-height: 1.65;
      text-align: center;
      padding: 8px 10px;
    }
    .report-card {
      background: linear-gradient(180deg, #FFFFFF 0%, #FFF9F4 100%);
      border-radius: 18px;
      border: 1px solid #FFE8D8;
      box-shadow: 0 10px 24px rgba(216, 131, 90, 0.10);
      padding: 16px;
      margin-bottom: 12px;
    }
    .report-title {
      margin: 0 0 10px;
      font-size: 27px;
      color: #2E1A10;
      font-weight: 900;
      letter-spacing: 0.2px;
      line-height: 1.28;
    }
    .report-sub {
      margin: -2px 0 12px;
      font-size: 13px;
      color: #8D5A44;
      line-height: 1.6;
    }
    .emotion-cloud {
      position: relative;
      height: 220px;
      border-radius: 14px;
      background:
        radial-gradient(circle at 75% 20%, rgba(255, 188, 129, 0.24) 0%, rgba(255, 188, 129, 0) 45%),
        radial-gradient(circle at 10% 80%, rgba(255, 136, 102, 0.16) 0%, rgba(255, 136, 102, 0) 38%),
        #FFF8F2;
      border: 1px solid #FFE9DA;
      overflow: hidden;
    }
    .emotion-bubble {
      position: absolute;
      width: var(--size);
      height: var(--size);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 6px;
      line-height: 1.3;
      font-size: 14px;
      font-weight: 800;
      color: #6B3C2A;
      background: var(--bubble);
      border: 1px solid rgba(255, 255, 255, 0.8);
      box-shadow: 0 10px 20px rgba(188, 118, 82, 0.16);
    }
    .emotion-bubble:nth-child(1) { left: 6%; top: 54%; }
    .emotion-bubble:nth-child(2) { left: 44%; top: 10%; }
    .emotion-bubble:nth-child(3) { right: 4%; top: 18%; }
    .emotion-bubble:nth-child(4) { right: 14%; bottom: 6%; }
    .emotion-bubble:nth-child(5) { left: 24%; bottom: 4%; }
    .emotion-bubble:nth-child(6) { left: 4%; top: 12%; }
    .dimension-list {
      display: grid;
      gap: 12px;
    }
    .dim-row {
      background: #FFF7EF;
      border: 1px solid #FFE5D2;
      border-radius: 12px;
      padding: 10px 10px 9px;
    }
    .dim-row-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 8px;
    }
    .dim-code {
      font-size: 12px;
      color: #B26C4C;
      font-weight: 800;
      letter-spacing: 0.2px;
    }
    .dim-win {
      font-size: 13px;
      font-weight: 800;
      color: #6D3E2A;
    }
    .dim-track {
      width: 100%;
      height: 10px;
      border-radius: 999px;
      overflow: hidden;
      background: #F7EADF;
      display: flex;
    }
    .dim-fill {
      display: block;
      height: 100%;
      border-radius: 999px;
    }
    .dim-fill-EI { background: linear-gradient(90deg, #FF9A76 0%, #FF6B52 100%); }
    .dim-fill-SN { background: linear-gradient(90deg, #7ACB9D 0%, #45B67B 100%); }
    .dim-fill-TF { background: linear-gradient(90deg, #FFD27E 0%, #FFB648 100%); }
    .dim-fill-JP { background: linear-gradient(90deg, #CAABFF 0%, #AF86FF 100%); }
    .dim-rest {
      flex: 1;
      background: rgba(244, 223, 206, 0.58);
    }
    .dim-row-bottom {
      margin-top: 7px;
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: #A37A63;
      font-weight: 700;
    }
    .dim-row-bottom .is-win {
      color: #6D3E2A;
      font-weight: 900;
    }
    .persona-grid,
    .guide-grid {
      display: grid;
      gap: 10px;
    }
    .persona-block,
    .guide-block {
      background: #FFF8F1;
      border: 1px solid #FFE7D6;
      border-radius: 12px;
      padding: 11px 12px;
    }
    .persona-label,
    .guide-label {
      margin: 0 0 7px;
      font-size: 19px;
      color: #4A2819;
      font-weight: 900;
      line-height: 1.3;
    }
    .report-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 6px;
    }
    .report-list li {
      position: relative;
      padding-left: 18px;
      color: #6E4A3A;
      font-size: 14px;
      line-height: 1.65;
      margin: 0;
    }
    .report-list li::before {
      content: "â€¢";
      position: absolute;
      left: 4px;
      top: 0;
      color: #FF9A6A;
      font-size: 14px;
      font-weight: 900;
    }
    .guide-focus {
      margin: 0 0 10px;
      background: linear-gradient(90deg, #FFF0E4 0%, #FFEBDD 100%);
      border: 1px solid #FFDCC5;
      border-radius: 12px;
      padding: 10px;
      color: #8A593F;
      font-size: 13px;
      line-height: 1.65;
    }
    .share-card .btns {
      margin: 0 0 10px;
    }
    .page-report .share-card .btns button {
      width: 100%;
      min-width: 100%;
      height: 48px;
      border-radius: 14px;
      font-size: 17px;
      font-weight: 900;
      letter-spacing: 0.2px;
    }
    .page-report .poster-preview {
      margin-top: 0;
      border-radius: 16px;
      background: linear-gradient(180deg, #FFF6EE 0%, #FFF3EA 100%);
      border-color: #FFDCC8;
      box-shadow: 0 8px 20px rgba(216, 131, 90, 0.12);
    }
    .page-report .poster-preview-title {
      color: #A45635;
      font-size: 15px;
      margin-bottom: 4px;
    }
    .page-report .poster-preview-sub {
      color: #986A52;
      margin-bottom: 10px;
    }
    .page-report .save-tip {
      background: linear-gradient(90deg, #FFEEDD 0%, #FFE6D0 100%);
      border: 1px solid #FFCEAF;
      color: #8A4F34;
    }
    .page-report .poster-avatar-hotspot {
      border-color: rgba(255, 126, 84, 0.42);
      background: rgba(255, 149, 110, 0.14);
    }
    .page-report .poster-avatar-hotspot::after {
      border-color: #FFD3BA;
      color: #AE5A35;
    }
    .page-report .community-card {
      margin-top: 12px;
      background: linear-gradient(180deg, #FFF5EB 0%, #FFF1E5 100%);
      border: 1px solid #FFDCC6;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.7);
    }
    .page-report .community-card .muted {
      color: #8B6651;
    }
    .page-report .btn-ghost {
      border-color: #FFD0B2;
      color: #AD5A35;
      background: #FFF8F2;
    }
    .page-report .btn-primary {
      background: linear-gradient(90deg, #FF8C63 0%, #FF6D4B 100%);
      color: #fff;
    }
    /* åˆ†äº«æµ·æŠ¥æ”¹æˆæš–è‰²è°ƒï¼ˆç”¨äºç”Ÿæˆå›¾ç‰‡ï¼‰ */
    .poster {
      background:
        radial-gradient(circle at 22% -10%, rgba(255, 182, 143, 0.30) 0%, rgba(255, 182, 143, 0) 48%),
        linear-gradient(180deg, #FFFCF9 0%, #FFF5ED 100%);
      border: 1px solid #FFD8BE;
      box-shadow: 0 20px 40px rgba(198, 124, 85, 0.18);
    }
    .poster-brand { color: #C18A70; }
    .poster .avatar-circle {
      border-color: rgba(255, 145, 100, 0.30);
      box-shadow: 0 10px 24px rgba(205, 119, 78, 0.24);
    }
    .poster-type-badge {
      color: #FF6D4B;
      text-shadow: 0 10px 24px rgba(255, 109, 75, 0.22);
    }
    .poster-gold-phrase { color: #6F4B3A; }
    .poster-pill-item {
      color: #B75B37;
      border-color: #FFD8C0;
      background: linear-gradient(180deg, #FFF6EF 0%, #FFEEDF 100%);
    }
    .poster-cta-card,
    .qr-sticker-card {
      background: linear-gradient(180deg, #FFFFFF 0%, #FFF7EF 100%);
      border-color: #FFDCC7;
      box-shadow: 0 8px 20px rgba(200, 125, 86, 0.10);
    }
    .poster-cta-title { color: #3E2418; }
    .poster-cta-subtitle,
    .poster-cta-hint,
    .qr-sticker-card .qr-text-mini { color: #855640; }
    @media (max-width: 430px) {
      .report-title { font-size: 25px; }
      .page-report .result-name { font-size: 32px; }
      .emotion-cloud { height: 208px; }
      .page-report .poster-avatar-hotspot::after { font-size: 10px; }
    }
    @media (max-width: 380px) {
      .page.page-report { padding: 10px; }
      .report-title { font-size: 23px; }
      .page-report .result-type { font-size: 52px; }
      .page-report .result-name { font-size: 30px; }
      .persona-label, .guide-label { font-size: 17px; }
    }

  </style>

</head>
<body>
  <div class="wrap">
    <div class="card" id="hero">
      <div class="row">
        <div>
          <h1 class="title">èŒå® è”èŒ Â· æ¯›å­©å­MBTIæ€§æ ¼æµ‹è¯•</h1>
          <p class="sub">16 é¢˜ï¼Œ1 åˆ†é’Ÿææ‡‚ä½ å®¶æ¯›å­©å­çš„"é™ªä¼´å‹äººæ ¼"ï¼Œé¡ºä¾¿ç”Ÿæˆä¸€å¼ èƒ½æ™’çš„ç»“æœå¡ã€‚</p>
        </div>
        <div class="tag" id="statusTag">æœªå¼€å§‹</div>
      </div>
      <div class="progressBar"><div id="bar"></div></div>
      <div class="btns">
        <button class="primary" onclick="start()">å¼€å§‹æµ‹è¯•</button>
        <button class="ghost" onclick="showDemo()">çœ‹çœ‹ç¤ºä¾‹</button>
      </div>
      <p class="muted" style="margin-top:10px;">å®Œæˆåå¯åŠ å…¥ã€åŒå“ç§Ã—åŒæ€§æ ¼ã€‘æ¯›å­©å­é™ªä¼´ç¤¾ç¾¤</p>
      <p class="muted" style="margin-top:4px;">å°æç¤ºï¼šæŒ‰ä½ å®¶æ¯›å­©å­"æ—¥å¸¸æœ€å¸¸è§çŠ¶æ€"é€‰ï¼Œä¸ç”¨çº ç»“ä¸ªåˆ«ç‰¹ä¾‹ã€‚</p>
    </div>


    <div class="card" id="panel">
      <div class="row">
        <div class="tag" id="step">å‡†å¤‡ä¸­</div>
        <div class="tag" id="progress"></div>
      </div>
      <div class="hr"></div>
      <div id="content">
        <p class="muted">ç‚¹å‡»ã€Œå¼€å§‹æµ‹è¯•ã€è¿›å…¥ç¬¬ 1 é¢˜ã€‚</p>
      </div>
    </div>

    <div class="toast" id="toast">æµ‹è¯•ç»“æœå·²ç”Ÿæˆ</div>


  </div>

  <div class="modal-mask" id="wecomModal">
    <div class="modal">
      <span class="modal-close" onclick="closeWecomModal()">&times;</span>
      <div class="modal-title">åŠ å…¥åŒç±»æ¯›å­©å­åœˆ</div>
      <div class="modal-sub">å¾®ä¿¡å†…è¯†åˆ«äºŒç»´ç ï¼Œå‘é€ä½ çš„æ¯›å­©å­ç±»å‹å³å¯å…¥ç¾¤</div>
      <div class="wecom-type-chip">å½“å‰ç±»å‹ï¼š<b id="wecomTypeLabel">æ¯›å­©å­æ€§æ ¼</b></div>
      <div class="wecom-steps">
        <div class="wecom-step">1 é•¿æŒ‰è¯†åˆ«äºŒç»´ç </div>
        <div class="wecom-step">2 å‘é€ç±»å‹å¿«é€Ÿè¿›ç¾¤</div>
      </div>
      <div class="wecom-qr-box">
        <div class="wecom-qr-inner">
          <img src="wecom_qr.png" alt="ä¼ä¸šå¾®ä¿¡äºŒç»´ç " />
        </div>
      </div>
      <p class="wecom-note">å·²åŒ¹é…åŒå“ç§äº¤æµç¾¤ï¼Œå…¥ç¾¤åå¯é¢†å–ä¸“å±è®­ç»ƒæ¸…å•ã€‚</p>
    </div>

  </div>

  <!-- æµ·æŠ¥ç”Ÿæˆä¾èµ– -->

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>


<script>
  // 16é¢˜ï¼šæ¯ä¸ªç»´åº¦4é¢˜ï¼ˆæ¯›å­©å­å‘ï¼‰

  // ç»´åº¦ï¼šE/I, S/N, T/F, J/P
  const questions = [
    // E/I
    { id:"E1", dim:"EI", q:"å®¶é‡Œæ¥äº†æ–°å®¢äººï¼ŒTAæ›´å¸¸ï¼š", A:"çƒ­æƒ…å‡‘è¿‘é—»ä¸€é—»ï¼Œæƒ³ç¤¾äº¤", B:"å…ˆé€€åè§‚å¯Ÿï¼Œç¡®è®¤å®‰å…¨å†é è¿‘", scoreA:{E:1}, scoreB:{I:1}},
    { id:"E2", dim:"EI", q:"æ•£æ­¥è·¯ä¸Šé‡åˆ°åˆ«çš„æ¯›å­©å­ï¼ŒTAæ›´åƒï¼š", A:"ä¸»åŠ¨æ¥è¿‘ï¼Œæƒ³æ‰“æ‹›å‘¼", B:"æ›´æ„¿æ„è´´ç€ä½ èµ°ï¼Œä¸å¤ªæ­ç†", scoreA:{E:1}, scoreB:{I:1}},
    { id:"E3", dim:"EI", q:"ä½ å›å®¶å¼€é—¨é‚£ä¸€åˆ»ï¼ŒTAé€šå¸¸ï¼š", A:"å†²æ¥è¿æ¥ï¼Œæƒ…ç»ªæ‹‰æ»¡", B:"å…ˆçœ‹å‡ ç§’ï¼Œç­‰ä½ æ‹›å‘¼å†é è¿‘", scoreA:{E:1}, scoreB:{I:1}},
    { id:"E4", dim:"EI", q:"åœ¨é™Œç”Ÿç¯å¢ƒé‡Œï¼ŒTAæ›´å¯èƒ½ï¼š", A:"è¶Šçƒ­é—¹è¶Šå…´å¥‹ï¼Œåˆ°å¤„æ¢ç´¢", B:"æ‰¾ä¸ªå®‰å…¨ç‚¹çš„ä½ç½®æ…¢æ…¢é€‚åº”", scoreA:{E:1}, scoreB:{I:1}},
    // S/N
    { id:"S1", dim:"SN", q:"åˆ°æ–°åœ°æ–¹ï¼ŒTAæœ€å…ˆæ²‰è¿·çš„æ˜¯ï¼š", A:"åœ°ä¸Šå„ç§å‘³é“ä¸ç»†èŠ‚çº¿ç´¢", B:"æ•´ä½“æ°›å›´ï¼Œå“ªé‡Œå¯èƒ½æœ‰æ–°ç©æ³•", scoreA:{S:1}, scoreB:{N:1}},
    { id:"S2", dim:"SN", q:"ç»™TAæ–°ç©å…·ï¼ŒTAæ›´åƒï¼š", A:"ç ”ç©¶ç»“æ„ï¼šå’¬å“ªå„¿ã€æ€ä¹ˆç©æœ€é¡ºæ‰‹", B:"ç©æ³•å‘æ•£ï¼šå®ƒè¿˜èƒ½æ€ä¹ˆâ€œæ•´æ´»â€", scoreA:{S:1}, scoreB:{N:1}},
    { id:"S3", dim:"SN", q:"å­¦æ–°æŒ‡ä»¤æ—¶ï¼ŒTAæ›´å®¹æ˜“ï¼š", A:"é é‡å¤ç»ƒä¹ ç¨³ç¨³å­¦ä¼š", B:"å­¦ä¼šåä¼šä¸¾ä¸€åä¸‰è‡ªå·±å‘æŒ¥", scoreA:{S:1}, scoreB:{N:1}},
    { id:"S4", dim:"SN", q:"ä½ æŠŠé£Ÿç›†/çªä½ç½®æ¢äº†ï¼ŒTAä¼šï¼š", A:"ç«‹åˆ»å‘ç°ï¼šå’¦æ€ä¹ˆä¸åœ¨è€åœ°æ–¹", B:"æ— æ‰€è°“ï¼šåæ­£æœ€åéƒ½èƒ½æ‰¾åˆ°", scoreA:{S:1}, scoreB:{N:1}},
    // T/F
    { id:"T1", dim:"TF", q:"TAçŠ¯é”™è¢«ä½ åˆ¶æ­¢åï¼ŒTAæ›´åƒï¼š", A:"å…ˆåˆ¤æ–­è§„åˆ™ï¼šè¿™äº‹åˆ°åº•èƒ½ä¸èƒ½åš", B:"å…ˆçœ‹ä½ æƒ…ç»ªï¼šä½ æ˜¯ä¸æ˜¯ç”Ÿæ°”äº†", scoreA:{T:1}, scoreB:{F:1}},
    { id:"T2", dim:"TF", q:"è®­ç»ƒæ—¶TAæ›´åƒå“ªå¥—ï¼š", A:"æŒ‡ä»¤æ¸…æ™°+è§„åˆ™ä¸€è‡´ï¼Œå­¦å¾—æ›´å¿«", B:"å¤šå¤¸å¤šå“„å¤šå¥–åŠ±ï¼ŒçŠ¶æ€æ›´å¥½", scoreA:{T:1}, scoreB:{F:1}},
    { id:"T3", dim:"TF", q:"ä½ å¿ƒæƒ…ä¸å¤ªå¥½æ—¶ï¼ŒTAæ›´å¸¸ï¼š", A:"ç”¨è¡ŒåŠ¨è§£å†³ï¼šå¼ç©å…·/æ‹‰ä½ å»ç©", B:"æƒ…ç»ªé™ªä¼´ï¼šè´´è´´/å®ˆåœ¨ä½ æ—è¾¹", scoreA:{T:1}, scoreB:{F:1}},
    { id:"T4", dim:"TF", q:"é‡åˆ°åˆ«çš„æ¯›å­©å­æŠ¢ç©å…·ï¼ŒTAæ›´å¯èƒ½ï¼š", A:"äº‰å¤º/åšæŒï¼šæˆ‘çš„å°±æ˜¯æˆ‘çš„", B:"é€€ä¸€æ­¥/æ±‚åŠ©ä½ ï¼šåˆ«åµåˆ«åµ", scoreA:{T:1}, scoreB:{F:1}},
    // J/P
    { id:"J1", dim:"JP", q:"æ—¥å¸¸ä½œæ¯ä¸Šï¼ŒTAæ›´åƒï¼š", A:"è§„å¾‹æ´¾ï¼šåˆ°ç‚¹åƒåˆ°ç‚¹ç¡", B:"éšç¼˜æ´¾ï¼šçœ‹å¿ƒæƒ…å†³å®šä»Šå¤©èŠ‚å¥", scoreA:{J:1}, scoreB:{P:1}},
    { id:"J2", dim:"JP", q:"ä½ æ‹¿å‡ºç‰µå¼•ç»³è¦å‡ºé—¨ï¼ŒTAé€šå¸¸ï¼š", A:"ç«‹åˆ»è¿›å…¥çŠ¶æ€ï¼Œå‡†å¤‡å‡ºå‘", B:"çœ‹å¿ƒæƒ…ï¼šæœ‰æ—¶å…´å¥‹æœ‰æ—¶è£…æ­»", scoreA:{J:1}, scoreB:{P:1}},
    { id:"J3", dim:"JP", q:"ç©â€œå¼å›â€ä¹‹ç±»çš„æ¸¸æˆï¼ŒTAæ›´åƒï¼š", A:"æŒ‰æµç¨‹ï¼šå¼æ¥-æ”¾ä¸‹-å†æ¥", B:"éšæ—¶æ”¹è§„åˆ™ï¼šçªç„¶è·‘å/æ•´æ´»", scoreA:{J:1}, scoreB:{P:1}},
    { id:"J4", dim:"JP", q:"å‡ºé—¨è·¯çº¿æ¢äº†ï¼ŒTAæ›´åƒï¼š", A:"æœ‰ç‚¹ä¸çˆ½ï¼šæ€ä¹ˆä¸èµ°è€è·¯ï¼Ÿ", B:"æ›´å¼€å¿ƒï¼šæ¢è·¯=æ–°çš„ä¸–ç•Œï¼", scoreA:{J:1}, scoreB:{P:1}}
  ];

  // 16å‹ç»“æœåº“ï¼ˆä¸­æ–‡å+é‡‘å¥+å»ºè®®+æ ‡ç­¾ï¼‰
  const results = {
    "ENFP": { name:"å¿«ä¹ç¤¾äº¤å°æ—‹é£", line:"äººè§äººçˆ±ï¼Œä½†ç²¾åŠ›åƒæ°¸åŠ¨æœºã€‚", tags:["ç¤¾äº¤è¾¾äºº","é«˜å…´å¥‹","éœ€è¦æ”¾ç”µ"],
      tips:["æ¯å¤©ä¸¤æ¬¡é«˜è´¨é‡æ”¾ç”µï¼ˆå—…é—»+è¿½é€ï¼‰","ç¤¾äº¤è¦â€œæœ‰è¾¹ç•Œâ€ï¼Œé¿å…è¿‡åº¦åˆºæ¿€","è®­ç»ƒçŸ­é¢‘å¿«ï¼Œå¤šç”¨å¥–åŠ±"] },
    "ENFJ": { name:"è´´å¿ƒå›¢å® å“„å“„å®˜", line:"ä¼šè¯»ç©ºæ°”ï¼Œè¿˜ç‰¹åˆ«ä¼šå“„äººã€‚", tags:["æƒ…ç»ªæ„ŸçŸ¥","ç²˜äººæš–å¿ƒ","é…åˆåº¦é«˜"],
      tips:["å¤šç”¨å¤¸å¥–ä¸æŠšæ‘¸å»ºç«‹å®‰å…¨æ„Ÿ","å®‰æ’ç¨³å®šç¤¾äº¤ï¼šç†Ÿäºº+å›ºå®šåœºåœ°","ç»™å®ƒä¸€ä¸ªâ€œé™ªä¼´å²—ä½â€ï¼ˆå¦‚é—¨å£è¿æ¥ï¼‰"] },
    "ENTP": { name:"ç‚¹å­ç‹æ‹†å®¶å¤§å¸ˆ", line:"èªæ˜åˆ°å¯æ€•ï¼Œé—²ç€å°±æƒ³æ•´æ´»ã€‚", tags:["é«˜æ™ºå•†","å¥½å¥‡å¿ƒ","çˆ±æŒ‘æˆ˜"],
      tips:["ç”¨ç›Šæ™ºç©å…·/å¯»å®æ¸¸æˆæ¶ˆè€—è„‘åŠ›","è®­ç»ƒå¢åŠ éš¾åº¦ï¼šå˜æ¢åœºæ™¯/å¹²æ‰°","å®¶é‡Œåšå¥½é˜²å’¬ä¸æ›¿ä»£ç‰©ï¼ˆå’¬èƒ¶ï¼‰"] },
    "ENTJ": { name:"è§„åˆ™æ‰§è¡Œé˜Ÿé•¿", line:"æœ‰ä¸»è§ã€æœ‰ç§©åºï¼Œæƒ³å½“è€å¤§ã€‚", tags:["å¼ºç›®æ ‡","æ‰§è¡ŒåŠ›","ä¸»å¯¼å‹"],
      tips:["è§„åˆ™ä¸€è‡´ï¼Œå£ä»¤ç»Ÿä¸€ï¼ˆå®¶é‡Œæ‰€æœ‰äººï¼‰","ç”¨ä»»åŠ¡é©±åŠ¨ï¼šåä¸‹â†’ç­‰å¾…â†’å¥–åŠ±","æ—©æœŸç¤¾äº¤è®­ç»ƒé¿å…å†²çªå‡çº§"] },

    "ESFP": { name:"æ´¾å¯¹æ°”æ°›ç»„ç»„é•¿", line:"å“ªé‡Œçƒ­é—¹å»å“ªï¼Œå¿«ä¹ä¸è®¾é˜²ã€‚", tags:["å¤–å‘","çˆ±ç©","é«˜äº’åŠ¨"],
      tips:["å¤šå®‰æ’äº’åŠ¨æ¸¸æˆï¼šé£ç›˜/æ‹”æ²³ï¼ˆæœ‰è§„åˆ™ï¼‰","é¿å…è¿‡åº¦å…´å¥‹ï¼šç©å‰å…ˆåä¸‹ç­‰å¾…","ç¤¾äº¤åç»™å®‰é™ä¼‘æ¯æ—¶é—´"] },
    "ESFJ": { name:"å®¶åº­æ°›å›´å®ˆæŠ¤è€…", line:"å°±çˆ±è·Ÿç€ä½ ï¼Œå®¶é‡Œè°éƒ½è¦ç®¡ã€‚", tags:["é»äºº","æŠ¤å®¶","å¥½é…åˆ"],
      tips:["ç»™ç¨³å®šä½œæ¯ä¸å›ºå®šä»ªå¼æ„Ÿ","åˆ†ç¦»è®­ç»ƒè¦å¾ªåºæ¸è¿›ï¼ˆçŸ­æ—¶ç¦»å¼€ï¼‰","å¤šåšâ€œé™ªä¼´å‹ä»»åŠ¡â€æå‡æ»¡è¶³æ„Ÿ"] },
    "ESTP": { name:"å†²é”‹æ¢ç´¢è¡ŒåŠ¨æ´¾", line:"å…ˆå¹²å†è¯´ï¼Œè¡ŒåŠ¨æ°¸è¿œå¿«ä¸€æ­¥ã€‚", tags:["è¡ŒåŠ¨æ´¾","èƒ†å­å¤§","çˆ±æ¢ç´¢"],
      tips:["å¤–å‡ºä¼˜å…ˆâ€œå—…é—»+æ¢ç´¢â€å†è®­ç»ƒ","ç”¨ç»³æ§ä¸å›å«å»ºç«‹è¾¹ç•Œ","ç»™å†²åˆºå‹è¿åŠ¨ï¼ˆçŸ­è·‘/è¿½é€ï¼‰"] },
    "ESTJ": { name:"çºªå¾‹å§”å‘˜å°è­¦é•¿", line:"æœ€æ‡‚è§„çŸ©ï¼Œä¹Ÿæœ€ä¼šâ€œç›¯äººâ€ã€‚", tags:["ç¨³å®š","è®²è§„åˆ™","è¾¹ç•Œæ¸…æ™°"],
      tips:["è®­ç»ƒè¦æ ‡å‡†åŒ–ï¼šå£ä»¤+æ‰‹åŠ¿å›ºå®š","é€‚åˆå­¦ä¹ æŠ€å·§ï¼šå®šç‚¹ã€ç­‰å¾…ã€éšè¡Œ","ç¤¾äº¤å†²çªæ—¶å…ˆè®©å®ƒâ€œåä¸‹å†·é™â€"] },

    "INFP": { name:"ç»ç’ƒå¿ƒæµªæ¼«é™ªä¼´è€…", line:"æ•æ„Ÿåˆæ·±æƒ…ï¼Œåªè®¤è‡ªå·±äººã€‚", tags:["æ•æ„Ÿ","ä¾æ‹","æ…¢çƒ­"],
      tips:["å‡å°‘å¼ºè¡Œç¤¾äº¤ï¼Œç”¨â€œè·ç¦»+å¥–åŠ±â€å»ºç«‹ä¿¡ä»»","ç»™å®‰å…¨åŒºï¼šçª/ç¬¼/è§’è½","ç”¨æ¸©å’Œè®­ç»ƒæ–¹å¼ï¼Œé¿å…å¤§å£°å‘µæ–¥"] },
    "INFJ": { name:"ç¥ç§˜æ²»æ„ˆç³»å®ˆæŠ¤è€…", line:"å®‰é™è§‚å¯Ÿï¼Œä½†å…³é”®æ—¶åˆ»å¾ˆé è°±ã€‚", tags:["è§‚å¯Ÿå‹","ç²˜ä½ ","æœ‰åˆ†å¯¸"],
      tips:["å›ºå®šä½œæ¯ä¸åœºæ™¯ï¼Œå®‰å…¨æ„Ÿæ›´å¼º","è®­ç»ƒç”¨â€œæç¤ºâ†’æˆåŠŸâ†’å¥–åŠ±â€ï¼›ç¤¾äº¤ä»¥ç†Ÿäººå±€ä¸ºä¸»ï¼Œæ…¢æ…¢æ‰©åœˆ"] },
    "INTP": { name:"ç ”ç©¶å‹å¥½å¥‡å®å®", line:"çˆ±ç ”ç©¶ï¼Œåƒä¸ªå°ç§‘å­¦å®¶ã€‚", tags:["ç‹¬ç«‹","å¥½å¥‡","è„‘åŠ›å‹"],
      tips:["å¤šç»™ç›Šæ™ºç©å…·ã€å—…é—»å«ã€å¯»å®","è®­ç»ƒåŠ å…¥å˜åŒ–ï¼Œä¸ç„¶ä¼šæ— èŠ","ç”¨å¥–åŠ±å»ºç«‹â€œæ„¿æ„é…åˆâ€çš„åŠ¨åŠ›"] },
    "INTJ": { name:"é«˜æ™ºå•†ç­–ç•¥å®¶", line:"ä¸åµä¸é—¹ï¼Œä½†å¿ƒé‡Œé—¨å„¿æ¸…ã€‚", tags:["å†·é™","ç­–ç•¥","è‡ªæ§å¼º"],
      tips:["è§„åˆ™æ˜ç¡®ã€è¾¹ç•Œæ¸…æ™°ï¼Œå°‘åå¤","è®­ç»ƒåâ€œä»»åŠ¡å‹â€ï¼šå®šç‚¹/éšè¡Œ","ç¤¾äº¤å…ˆè§‚å¯Ÿï¼Œåˆ«å‚¬ï¼Œç»™å®ƒé€‰æ‹©æƒ"] },

    "ISFP": { name:"æ¸©æŸ”æ•æ„Ÿå°è‰ºæœ¯å®¶", line:"æ¸©æŸ”åˆæŒ‘å‰”ï¼Œå–œæ¬¢èˆ’æœçš„èŠ‚å¥ã€‚", tags:["æ¸©æŸ”","æ…¢çƒ­","äº«å—å‹"],
      tips:["ç¯å¢ƒèˆ’é€‚æœ€é‡è¦ï¼šæ¸©åº¦ã€å«å­ã€å™ªéŸ³","è®­ç»ƒç”¨é¼“åŠ±æ›¿ä»£å‹åŠ›","å¤–å‡ºåˆ«å¤ªä¹…ï¼Œç»™è¶³ä¼‘æ¯"] },
    "ISFJ": { name:"æš–å¿ƒè´´è´´ä¿å§†å‹", line:"ä¸äº‰ä¸æŠ¢ï¼Œå°±æƒ³å®ˆç€ä½ ã€‚", tags:["è´´å¿ƒ","ç¨³å®š","é¡¾å®¶"],
      tips:["é€‚åˆè§„å¾‹é™ªä¼´ï¼šå›ºå®šæ•£æ­¥æ—¶é—´","åšåˆ†ç¦»è®­ç»ƒé¿å…ä¾èµ–è¿‡å¼º","ç”¨è½»æ¾äº’åŠ¨ï¼ˆæŠšæ‘¸/èˆ”é£Ÿï¼‰å®‰æŠš"] },
    "ISTP": { name:"å†·é™ç‹¬è¡Œè§‚å¯Ÿå‘˜", line:"ç‹¬ç«‹ã€è‡ªæ´½ï¼Œä¸çˆ±è¢«æ‰“æ‰°ã€‚", tags:["ç‹¬ç«‹","å†·é™","è§‚å¯Ÿ"],
      tips:["ç»™ç©ºé—´ï¼šåˆ«ä¸€ç›´æŠ±ã€åˆ«å¼ºäº’åŠ¨","è®­ç»ƒç”¨â€œå°‘è¯´å¤šåšâ€ï¼šåŠ¨ä½œæ˜ç¡®","ç¤¾äº¤å°‘è€Œç²¾ï¼Œé¿å…è¿‡åº¦æ¶ˆè€—"] },
    "ISTJ": { name:"ç¨³å®šå¯é è€å¹²éƒ¨", line:"ç¨³ã€å‡†ã€ç‹ ï¼šæŒ‰è§„çŸ©æ¥æœ€èˆ’æœã€‚", tags:["ç¨³é‡","å®ˆè§„åˆ™","ä½æ³¢åŠ¨"],
      tips:["å›ºå®šè§„åˆ™+å›ºå®šè·¯çº¿ï¼Œæœ€çœå¿ƒ","è®­ç»ƒé‡â€œé‡å¤ä¸ä¸€è‡´æ€§â€","é€‚åˆåšåŸºç¡€æœä»ï¼šç­‰å¾…/éšè¡Œ/å›å«"] }
  };

  let idx = -1;
  let score = {E:0,I:0,S:0,N:0,T:0,F:0,J:0,P:0};
  let finalType = "";

  // è¿™é‡Œçš„ YOUR_TEST_LINK é»˜è®¤ç›´æ¥ç”¨å½“å‰é¡µé¢åœ°å€
  const getTestLink = () => location.href.split('?')[0];

  function start(){
    idx = 0;
    score = {E:0,I:0,S:0,N:0,T:0,F:0,J:0,P:0};
    document.getElementById("hero").style.display = "none";
    document.getElementById("panel").style.display = "block";
    document.getElementById("statusTag").innerText = "æµ‹è¯•è¿›è¡Œä¸­";
    renderQuestion();
  }

  function showDemo(){
    start(); // å…ˆåˆ‡æ¢æ˜¾ç¤º
    idx = 16; // æ¨¡æ‹Ÿç»“æŸ
    renderResult("ENFP");
  }

  function renderQuestion(){

    const q = questions[idx];
    const panel = document.getElementById("panel");
    if(panel) panel.classList.remove("panel-result");
    document.getElementById("step").innerText = "é¢˜ç›®è¿›åº¦";
    document.getElementById("progress").innerText = `${idx+1}/${questions.length}`;
    setBar((idx)/questions.length);

    document.getElementById("content").innerHTML = `
      <div class="q">${q.q}</div>
      <button class="opt" onclick="choose('A')">A. ${q.A}</button>
      <button class="opt" onclick="choose('B')">B. ${q.B}</button>
      <div class="muted" style="text-align:center;margin-top:10px;font-size:12px;">å®Œæˆåå¯åŠ å…¥ã€åŒå“ç§Ã—åŒæ€§æ ¼ã€‘æ¯›å­©å­é™ªä¼´ç¤¾ç¾¤</div>
    `;

  }

  function choose(which){
    const q = questions[idx];
    const s = (which === "A") ? q.scoreA : q.scoreB;
    Object.keys(s).forEach(k => score[k] += s[k]);

    idx += 1;
    if(idx >= questions.length){
      finalType = calcType();
      renderResult(finalType);
    }else{
      renderQuestion();
    }
  }

  function calcType(){
    const EI = (score.E >= score.I) ? "E" : "I";
    const SN = (score.S >= score.N) ? "S" : "N";
    const TF = (score.T >= score.F) ? "T" : "F";
    const JP = (score.J >= score.P) ? "J" : "P";
    return EI+SN+TF+JP;
  }

  const subTitles = {
    E: "æ®è¯´è¿™ç§æ¯›å­©å­åœ¨ç¾¤é‡Œæœ€å—æ¬¢è¿ğŸ˜†",
    I: "å¤–å†·å†…çƒ­çš„å°ç”œå¿ƒå°±æ˜¯å®ƒå§âœ¨",
    S: "ç¨³é‡å¯é çš„å®¶åº­å°å«å£«ğŸ¶",
    N: "è„‘å›è·¯æ¸…å¥‡çš„æœºçµé¬¼æœ¬é¬¼ğŸ§ "
  };

  const AVATAR_KEY = "dog_mbti_avatar";
  const DEFAULT_AVATAR = "touxiang.png.jpg";
  const dimensionMeta = [
    { id: "EI", left: "E", right: "I", leftLabel: "å¤–å‘", rightLabel: "å†…å‘" },
    { id: "SN", left: "S", right: "N", leftLabel: "ç°å®", rightLabel: "ç›´è§‰" },
    { id: "TF", left: "T", right: "F", leftLabel: "ç†æ€§", rightLabel: "æ„Ÿæ€§" },
    { id: "JP", left: "J", right: "P", leftLabel: "è§„å¾‹", rightLabel: "çµæ´»" }
  ];
  const letterEmotionWords = {
    E: ["çƒ­æƒ…", "æ´»åŠ›"],
    I: ["ç»†è…»", "æ…¢çƒ­"],
    S: ["è¸å®", "ç¨³å®š"],
    N: ["å¥½å¥‡", "çµåŠ¨"],
    T: ["æœæ–­", "è¾¹ç•Œæ„Ÿ"],
    F: ["ä¾æ‹", "å…±æƒ…"],
    J: ["å¯é ", "è‡ªå¾‹"],
    P: ["æ¾å¼›", "ç©å¿ƒ"]
  };
  const letterInsight = {
    E: {
      title: "çƒ­æƒ…äº’åŠ¨å‹",
      feature: "äº’åŠ¨å›åº”å¿«ï¼Œå–œæ¬¢å‚ä¸å®¶åº­æ´»åŠ¨",
      behavior: "è§åˆ°ç†Ÿæ‚‰çš„äººä¼šä¸»åŠ¨é è¿‘",
      outer: "çœ‹èµ·æ¥æ€»æ˜¯å¾ˆå…´å¥‹",
      inner: "å®ƒåœ¨ç¡®è®¤â€œä½ ä¹Ÿå–œæ¬¢æˆ‘â€"
    },
    I: {
      title: "å®‰é™è§‚å¯Ÿå‹",
      feature: "å…ˆè§‚å¯Ÿåé è¿‘ï¼Œä¿¡ä»»åä¼šéå¸¸ç¨³å®š",
      behavior: "åœ¨ç†Ÿæ‚‰è§’è½ä¼šæ›´æ”¾æ¾",
      outer: "è¡¨é¢æœ‰ç‚¹æ…¢çƒ­",
      inner: "ä¸€æ—¦è®¤å®šä½ å°±ä¼šéå¸¸é»"
    },
    S: {
      title: "ç»†èŠ‚è¸å®å‹",
      feature: "å¯¹ç»†èŠ‚å˜åŒ–æ•æ„Ÿï¼Œå–œæ¬¢å¯é¢„æœŸæµç¨‹",
      behavior: "å›ºå®šè·¯çº¿å’Œè§„åˆ™ä¼šæ›´å®‰å¿ƒ",
      outer: "è¡¨ç°å¾—ç¨³ç¨³å½“å½“",
      inner: "å®ƒæœ€æ€•çªç„¶æ‰“ä¹±èŠ‚å¥"
    },
    N: {
      title: "çµæ„Ÿæ¢ç´¢å‹",
      feature: "å¥½å¥‡å¿ƒå¼ºï¼Œå–œæ¬¢æ–°é²œç©æ³•",
      behavior: "é‡åˆ°æ–°ç©å…·ä¼šé©¬ä¸Šè¿›å…¥çŠ¶æ€",
      outer: "å¶å°”åƒåœ¨æ•´æ´»",
      inner: "å®ƒéœ€è¦æ–°åˆºæ¿€æ¥ä¿æŒå¿«ä¹"
    },
    T: {
      title: "è¾¹ç•Œé€»è¾‘å‹",
      feature: "è§„åˆ™æ¸…æ™°æ—¶æ‰§è¡ŒåŠ›é«˜",
      behavior: "å£ä»¤æ˜ç¡®æ—¶é…åˆæ›´å¿«",
      outer: "çœ‹èµ·æ¥å¾ˆæœ‰ä¸»è§",
      inner: "å®ƒåœ¨å¯»æ‰¾ç¨³å®šå¯æ‰§è¡Œçš„è§„åˆ™"
    },
    F: {
      title: "æƒ…æ„Ÿå…±é¸£å‹",
      feature: "ä¼šä¼˜å…ˆæ„Ÿå—äººçš„æƒ…ç»ªå˜åŒ–",
      behavior: "ä½ ä½è½æ—¶ä¼šä¸»åŠ¨è´´è¿‘é™ªä¼´",
      outer: "çœ‹èµ·æ¥æ›´ä¾èµ–ä½ ",
      inner: "å®ƒåœ¨é€šè¿‡é™ªä¼´ç¡®è®¤å…³ç³»å®‰å…¨"
    },
    J: {
      title: "è§„å¾‹ç§©åºå‹",
      feature: "å›ºå®šèŠ‚å¥ä¼šè®©çŠ¶æ€æ›´ç¨³å®š",
      behavior: "åˆ°ç‚¹ä¼šä¸»åŠ¨æé†’åƒé¥­æ•£æ­¥",
      outer: "åƒä¸ªå°ç®¡å®¶",
      inner: "å®ƒå¸Œæœ›ç”Ÿæ´»æœ‰ç¡®å®šæ€§"
    },
    P: {
      title: "æ¾å¼›å¼¹æ€§å‹",
      feature: "åœ¨è‡ªç”±èŠ‚å¥é‡Œæ›´å®¹æ˜“å¼€å¿ƒ",
      behavior: "ä¼šæ ¹æ®å¿ƒæƒ…ä¸´æ—¶è°ƒæ•´ç©æ³•",
      outer: "çœ‹èµ·æ¥éšæ€§å¯çˆ±",
      inner: "å®ƒéœ€è¦è¢«å…è®¸æ¢ç´¢å’Œå˜åŒ–"
    }
  };
  const guideByPair = {
    EI: {
      E: {
        how: "æ¯å¤©å®‰æ’ 1 æ¬¡é«˜è´¨é‡äº’åŠ¨æ—¶æ®µï¼ˆ15~20 åˆ†é’Ÿï¼‰ï¼Œå›åº”é€Ÿåº¦è¦å¿«ã€‚",
        play: "ä¼˜å…ˆç¤¾äº¤æ•£æ­¥ + å—…é—»æ¢ç´¢çš„ç»„åˆï¼Œå…ˆåŠ¨å†ç»ƒæ›´ç¨³å®šã€‚"
      },
      I: {
        how: "å…ˆç»™è§‚å¯Ÿç©ºé—´ï¼Œå†æ…¢æ…¢é‚€è¯·äº’åŠ¨ï¼Œä¿¡ä»»å»ºç«‹ä¼šæ›´ç‰¢ã€‚",
        play: "å…ˆåšä½åˆºæ¿€çš„å®‰é™äº’åŠ¨ï¼Œå†é€æ­¥å¢åŠ æ–°ç¯å¢ƒæŒ‘æˆ˜ã€‚"
      }
    },
    SN: {
      S: {
        feed: "å–‚å…»å’Œä½œæ¯å°½é‡å›ºå®šï¼Œç¨³å®šä¼šç›´æ¥æå‡å®‰å…¨æ„Ÿã€‚",
        play: "æ›´é€‚åˆâ€œæœ‰è§„åˆ™å¯é‡å¤â€çš„æ¸¸æˆï¼ŒæŒæ§æ„Ÿä¼šæ›´å¼ºã€‚"
      },
      N: {
        feed: "å–‚å…»ä¸­ä¿ç•™ä¸€ç‚¹å˜åŒ–ï¼ˆæ…¢é£Ÿå«/å¯»é£Ÿä»»åŠ¡ï¼‰ï¼Œæ›´æœ‰å‚ä¸æ„Ÿã€‚",
        play: "å®šæœŸè½®æ¢ç©å…·å’Œè·¯çº¿ï¼Œèƒ½æŒç»­æ¿€å‘æ¢ç´¢æ¬²ã€‚"
      }
    },
    TF: {
      T: {
        how: "æ²Ÿé€šæ—¶å£ä»¤è¦çŸ­ã€è§„åˆ™è¦ä¸€è‡´ï¼Œè¾¹ç•Œæ¸…æ¥šå®ƒæ›´å®‰å¿ƒã€‚",
        emotion: "å‡ºç°å†²çªå…ˆç«‹è§„åˆ™å†å®‰æŠšï¼Œæƒ…ç»ªå’Œç§©åºéƒ½èƒ½ç¨³ä½ã€‚"
      },
      F: {
        how: "å…ˆå…±æƒ…å†è®­ç»ƒï¼Œæ¸©æŸ”è¯­æ°” + å¥–åŠ±åé¦ˆæ›´æœ‰æ•ˆã€‚",
        emotion: "ç´§å¼ æ—¶å…ˆé™ªä¼´æŠšè§¦ï¼Œå†å¼•å¯¼åŠ¨ä½œä¼šæ›´å®¹æ˜“é…åˆã€‚"
      }
    },
    JP: {
      J: {
        feed: "å›ºå®šé›å¼¯å’Œä¼‘æ¯æ—¶é—´ï¼Œè§„å¾‹æ„Ÿä¼šæ˜æ˜¾é™ä½ç„¦è™‘ã€‚",
        emotion: "ç”Ÿæ´»å˜åŒ–å°½é‡æå‰é¢„å‘Šï¼Œç»™å®ƒè¿‡æ¸¡æ—¶é—´ã€‚"
      },
      P: {
        feed: "ä¿æŒå¼¹æ€§æ—¶é—´çª—å£ï¼Œå‡å°‘è¿‡åº¦åˆ»æ¿å¸¦æ¥çš„å‹æŠ‘ã€‚",
        emotion: "é€šè¿‡å¤šæ ·äº’åŠ¨é‡Šæ”¾å‹åŠ›ï¼Œè®©æƒ…ç»ªè‡ªç„¶æµåŠ¨ã€‚"
      }
    }
  };
  const fallbackEmotionWords = ["äº²äºº", "æ²»æ„ˆ", "æœºçµ", "å¿ è¯š", "è½¯èŒ", "è´´å¿ƒ"];

  function formatDate(dateObj){
    const y = dateObj.getFullYear();
    const m = String(dateObj.getMonth() + 1).padStart(2, "0");
    const d = String(dateObj.getDate()).padStart(2, "0");
    return `${y}-${m}-${d}`;
  }

  function buildDimensionData(){
    return dimensionMeta.map((meta) => {
      const leftValue = score[meta.left] || 0;
      const rightValue = score[meta.right] || 0;
      const total = Math.max(1, leftValue + rightValue);
      const leftPct = Math.round((leftValue / total) * 100);
      const rightPct = 100 - leftPct;
      const winLeft = leftPct >= rightPct;
      return {
        ...meta,
        leftPct,
        rightPct,
        winLabel: winLeft ? meta.leftLabel : meta.rightLabel,
        winPct: winLeft ? leftPct : rightPct
      };
    });
  }

  function buildDimensionRows(dimensionData){
    return dimensionData.map((dim) => `
      <div class="dim-row">
        <div class="dim-row-top">
          <span class="dim-code">${dim.left} / ${dim.right}</span>
          <span class="dim-win">${dim.winLabel} ${dim.winPct}%</span>
        </div>
        <div class="dim-track">
          <span class="dim-fill dim-fill-${dim.id}" style="width:${dim.leftPct}%"></span>
          <span class="dim-rest"></span>
        </div>
        <div class="dim-row-bottom">
          <span class="${dim.leftPct >= dim.rightPct ? "is-win" : ""}">${dim.leftLabel} ${dim.leftPct}%</span>
          <span class="${dim.rightPct > dim.leftPct ? "is-win" : ""}">${dim.rightLabel} ${dim.rightPct}%</span>
        </div>
      </div>
    `).join("");
  }

  function buildEmotionBubbles(type, r){
    const letterStrength = {
      E: score.E * 25, I: score.I * 25, S: score.S * 25, N: score.N * 25,
      T: score.T * 25, F: score.F * 25, J: score.J * 25, P: score.P * 25
    };
    const candidates = [];
    const bubblePalette = ["#FFDABF", "#FFC9B9", "#FFE5AE", "#D5EFDC", "#D5E9FF", "#E8DAFF"];

    r.tags.forEach((tag, idx) => {
      candidates.push({ word: tag, weight: 96 - idx * 10 });
    });

    type.split("").forEach((letter, letterIndex) => {
      const words = letterEmotionWords[letter] || [];
      words.forEach((word, wordIndex) => {
        const boost = Math.round((letterStrength[letter] || 50) * 0.22);
        candidates.push({
          word,
          weight: 60 + boost - letterIndex * 3 - wordIndex * 2
        });
      });
    });

    const bestByWord = {};
    candidates.forEach((item) => {
      if(!bestByWord[item.word] || item.weight > bestByWord[item.word]){
        bestByWord[item.word] = item.weight;
      }
    });

    const bubbles = Object.entries(bestByWord)
      .sort((a, b) => b[1] - a[1])
      .map(([word, weight]) => ({ word, weight }));

    for(let i = 0; bubbles.length < 6 && i < fallbackEmotionWords.length; i++){
      const word = fallbackEmotionWords[i];
      if(!bubbles.some((item) => item.word === word)){
        bubbles.push({ word, weight: 56 - i * 3 });
      }
    }

    return bubbles.slice(0, 6).map((item, index) => {
      const size = Math.max(72, Math.min(124, Math.round(52 + item.weight * 0.72)));
      return `<span class="emotion-bubble" style="--size:${size}px;--bubble:${bubblePalette[index % bubblePalette.length]};">${item.word}</span>`;
    }).join("");
  }

  function buildPersonaSections(type, r){
    const [l1, l2, l3, l4] = type.split("");
    const A = letterInsight[l1];
    const B = letterInsight[l2];
    const C = letterInsight[l3];
    const D = letterInsight[l4];
    return {
      highlights: [
        `${r.name}é€šå¸¸æ˜¯ã€Œ${A.title} + ${B.title}ã€çš„ç»„åˆã€‚`,
        `${C.feature}ï¼ŒåŒæ—¶${D.feature}ã€‚`
      ],
      behavior: [
        `${A.behavior}ï¼Œ${B.behavior}ã€‚`,
        `${C.behavior}ï¼Œ${D.behavior}ã€‚`
      ],
      contrast: [
        `å¤–è¡¨ï¼š${A.outer}ï¼Œä¹Ÿä¼š${D.outer}ã€‚`,
        `å†…å¿ƒï¼š${A.inner}ï¼›åŒæ—¶${C.inner}ã€‚`
      ]
    };
  }

  function buildGuideSections(type){
    const [ei, sn, tf, jp] = type.split("");
    return {
      getAlong: [guideByPair.EI[ei].how, guideByPair.TF[tf].how],
      feeding: [guideByPair.SN[sn].feed, guideByPair.JP[jp].feed],
      play: [guideByPair.EI[ei].play, guideByPair.SN[sn].play],
      emotion: [guideByPair.TF[tf].emotion, guideByPair.JP[jp].emotion]
    };
  }

  function buildCoreSummary(dimensionData){
    const sorted = [...dimensionData].sort((a, b) => b.winPct - a.winPct);
    const top1 = sorted[0];
    const top2 = sorted[1];
    return `æ ¸å¿ƒå€¾å‘ï¼š${top1.winLabel}${top1.winPct}% Â· ${top2.winLabel}${top2.winPct}%`;
  }

  function getAvatar(){
    try{ return localStorage.getItem(AVATAR_KEY) || DEFAULT_AVATAR; }
    catch(e){ return DEFAULT_AVATAR; }
  }

  function applyAvatar(){
    const avatarUrl = getAvatar();
    const img = document.getElementById("avatarImg");
    const imgPoster = document.getElementById("avatarImgPoster");
    if(img) img.src = avatarUrl;
    if(imgPoster) imgPoster.src = avatarUrl;
  }

  function openAvatarPicker(){
    const input = document.getElementById("avatarInput");
    if(input){ input.value = ""; input.click(); }
  }
  
  function clickAvatar(){
    openAvatarPicker();
  }

  function handleAvatarChange(e){
    const file = e.target.files && e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = function(ev){
      const dataUrl = ev.target.result;
      if(typeof dataUrl === "string"){
        try{ localStorage.setItem(AVATAR_KEY, dataUrl); }catch(err){}
        applyAvatar();
        const preview = document.getElementById("posterPreview");
        if(preview && preview.classList.contains("is-show")){
          savePoster({
            autoDownload: false,
            showLoadingToast: false,
            showSuccessToast: true,
            scrollToPreview: false,
            refreshOnly: true
          });
        }
      }
    };
    reader.readAsDataURL(file);
  }

  function renderResult(type){

    const r = results[type] || results["ENFP"];
    document.getElementById("statusTag").innerText = "å·²å‡ºç»“æœ";
    document.getElementById("step").innerText = "æµ‹è¯•å®Œæˆ";
    document.getElementById("progress").innerText = "";
    setBar(1);


    const tagsHtml = r.tags.map(t=>`<span class="tag">${t}</span>`).join("");
    const posterPillsHtml = r.tags.slice(0, 3).map(t=>`<span class="poster-pill-item">${t}</span>`).join("");
    const dimensionData = buildDimensionData();
    const dimensionRowsHtml = buildDimensionRows(dimensionData);
    const emotionBubblesHtml = buildEmotionBubbles(type, r);
    const personaSections = buildPersonaSections(type, r);
    const guideSections = buildGuideSections(type);
    const coreSummary = buildCoreSummary(dimensionData);
    const todayDate = formatDate(new Date());
    const toListHtml = (arr) => arr.map((item) => `<li>${item}</li>`).join("");
    const personaHighlightsHtml = toListHtml(personaSections.highlights);
    const personaBehaviorsHtml = toListHtml(personaSections.behavior);
    const personaContrastsHtml = toListHtml(personaSections.contrast);
    const guideGetAlongHtml = toListHtml(guideSections.getAlong);
    const guideFeedingHtml = toListHtml(guideSections.feeding);
    const guidePlayHtml = toListHtml(guideSections.play);
    const guideEmotionHtml = toListHtml(guideSections.emotion);
    const guideFocusText = r.tips[0] || "å…ˆç¨³å…³ç³»ï¼Œå†è°ˆè®­ç»ƒï¼Œæ¯›å­©å­ä¼šæ›´æ„¿æ„é…åˆã€‚";

    const panel = document.getElementById("panel");
    if(panel) panel.classList.add("panel-result");

    document.getElementById("content").innerHTML = `
      <div class="page page-report">
        <div class="result-card result-overview">
          <div class="result-top-meta">
            <span class="result-app">èŒå® è”èŒ Â· æ¯›å­©å­MBTI</span>
            <span class="result-date">${todayDate}</span>
          </div>
          <div class="avatar-wrap">
              <div class="avatar-circle" onclick="clickAvatar()">
                  <img id="avatarImg" alt="å¤´åƒ" />
              </div>
              <input id="avatarInput" type="file" accept="image/*" style="display:none" onchange="handleAvatarChange(event)" />
          </div>
          <div class="result-type">${type}</div>
          <div class="result-name">${r.name}</div>
          <div class="result-line">"${r.line}"</div>
          <div class="result-tags">${tagsHtml}</div>
          <div class="overview-mini">${coreSummary}</div>
        </div>

        <section class="report-card">
          <h3 class="report-title">å®ƒçš„æƒ…ç»ªæ³¡æ³¡</h3>
          <p class="report-sub">è¶Šå¤§çš„æ³¡æ³¡ï¼Œä»£è¡¨è¿™ä¸ªç‰¹è´¨åœ¨ä½ å®¶æ¯›å­©å­èº«ä¸Šè¶Šæ˜æ˜¾ã€‚</p>
          <div class="emotion-cloud">${emotionBubblesHtml}</div>
        </section>

        <section class="report-card">
          <h3 class="report-title">ç»´åº¦æ¡å½¢å›¾è¯¦æƒ…</h3>
          <div class="dimension-list">${dimensionRowsHtml}</div>
        </section>

        <section class="report-card">
          <h3 class="report-title">æ¯›å­©å­æ€§æ ¼ç”»åƒ</h3>
          <div class="persona-grid">
            <div class="persona-block">
              <h4 class="persona-label">ä»£è¡¨ç‰¹ç‚¹</h4>
              <ul class="report-list">${personaHighlightsHtml}</ul>
            </div>
            <div class="persona-block">
              <h4 class="persona-label">è¡Œä¸ºè¡¨ç°</h4>
              <ul class="report-list">${personaBehaviorsHtml}</ul>
            </div>
            <div class="persona-block">
              <h4 class="persona-label">å¿ƒé‡Œæƒ³çš„ vs å¤–è¡¨è¡¨ç°</h4>
              <ul class="report-list">${personaContrastsHtml}</ul>
            </div>
          </div>
        </section>

        <section class="report-card">
          <h3 class="report-title">ä¸»äººç›¸å¤„æŒ‡å—</h3>
          <div class="guide-focus">ä»Šæ—¥é‡ç‚¹ï¼š${guideFocusText}</div>
          <div class="guide-grid">
            <div class="guide-block">
              <h4 class="guide-label">å¦‚ä½•ç›¸å¤„</h4>
              <ul class="report-list">${guideGetAlongHtml}</ul>
            </div>
            <div class="guide-block">
              <h4 class="guide-label">å–‚å…»æŒ‡å—</h4>
              <ul class="report-list">${guideFeedingHtml}</ul>
            </div>
            <div class="guide-block">
              <h4 class="guide-label">ç©å…·ä¸äº’åŠ¨</h4>
              <ul class="report-list">${guidePlayHtml}</ul>
            </div>
            <div class="guide-block">
              <h4 class="guide-label">æƒ…ç»ªä¸å¿ƒç†</h4>
              <ul class="report-list">${guideEmotionHtml}</ul>
            </div>
          </div>
        </section>

        <section class="report-card share-card">
          <h3 class="report-title">åˆ†äº«æµ·æŠ¥</h3>
          <p class="report-sub">è½»è§¦å¤´åƒå¯æ›´æ¢ï¼Œé•¿æŒ‰æµ·æŠ¥å³å¯åˆ†äº«ç»™æœ‹å‹ã€‚</p>

          <!-- æµ·æŠ¥å¡ï¼šç”¨äºç”Ÿæˆå›¾ç‰‡ (åœ¨å±å¹•å¤–æ¸²æŸ“) -->
          <div id="resultCard" class="poster">
            <div class="poster-brand">èŒå® è”èŒ Â· æ¯›å­©å­MBTI</div>
            
            <div class="avatar-wrap">
                <div class="avatar-circle">
                    <img id="avatarImgPoster" alt="å¤´åƒ" />
                </div>
            </div>

            <div class="poster-center">
                <div class="poster-type-badge">${type}</div>
                <div class="poster-header">
                    <div class="poster-title-main">${r.name}</div>
                </div>
                <div class="poster-gold-phrase">"${r.line}"</div>
                <div class="poster-pill-group">
                    ${posterPillsHtml}
                </div>
            </div>

            <div class="poster-footer">
                <div class="poster-cta-card">
                  <div class="poster-cta-title">æ‰«ç æµ‹æµ‹ä½ å®¶æ¯›å­©å­</div>
                  <div class="poster-cta-subtitle">1åˆ†é’Ÿå‡ºç»“æœ Â· 16ç§æ€§æ ¼</div>
                  <div class="poster-cta-hint">ç”Ÿæˆä¸“å±æ€§æ ¼æµ·æŠ¥ï¼Œå‘æœ‹å‹åœˆ/ç¾¤</div>
                </div>
                
                <div class="qr-sticker-card">
                  <div class="qr-img-box">
                    <img src="test_site_qr.png" alt="æµ‹è¯•äºŒç»´ç " />
                  </div>
                  <div class="qr-text-mini">æ‰«ç æµ‹è¯•</div>
                </div>
            </div>
          </div>

          <div class="btns">
            <button class="btn-primary" onclick="savePoster()">ç”Ÿæˆåˆ†äº«æµ·æŠ¥</button>
          </div>

          <div id="posterPreview" class="poster-preview">
            <div class="poster-preview-title">å·²ç”Ÿæˆåˆ†äº«æµ·æŠ¥</div>
            <div class="poster-preview-sub">é•¿æŒ‰ä¿å­˜åå¯åˆ†äº«åˆ°æœ‹å‹åœˆ/ç¾¤</div>
            <div class="poster-image-wrap">
              <img id="posterImg" />
              <button id="posterAvatarHotspot" class="poster-avatar-hotspot" type="button" aria-label="ç‚¹å‡»æ›´æ¢å¤´åƒ" onclick="openAvatarPicker()"></button>
            </div>
            <div id="saveTip" class="save-tip">
              ğŸ‘† <b>é•¿æŒ‰ä¿å­˜å¹¶åˆ†äº«</b>
            </div>
          </div>
        </section>

        <div class="community-card">
          <div style="font-weight:900; color:var(--pri); font-size:15px; margin-bottom:4px;">åŒç±»æ¯›å­©å­äº¤æµç¾¤</div>
          <div class="muted" style="font-size:12px; margin-bottom:12px;">æ‰«ç åŠ ä¼å¾®ï¼Œå‘é€â€œ${type}â€å¯é¢†å–åŒç±»äº¤æµå»ºè®®ã€‚</div>
          <button class="btn-primary small" style="width:100%; padding:10px;" onclick="showWecomModal()">åŠ ä¼å¾®é¢†å–å…¥ç¾¤ç </button>
        </div>

        <div class="btns" style="margin-top:12px;">
          <button class="btn-ghost" onclick="start()">é‡æ–°æµ‹è¯•</button>
        </div>
      </div>
    `;





    // å¤´åƒæ¸²æŸ“
    applyAvatar();

    // æ¸²æŸ“äºŒç»´ç 
    renderQRCode(getTestLink());
  }


  let hasShownWecomModal = false;

  function showWecomModal() {
    const typeLabel = document.getElementById("wecomTypeLabel");
    if(typeLabel) typeLabel.innerText = finalType || "æ¯›å­©å­æ€§æ ¼";
    document.getElementById("wecomModal").style.display = "flex";
  }

  function closeWecomModal() {
    document.getElementById("wecomModal").style.display = "none";
  }

  document.addEventListener("click", function(e){
    const mask = document.getElementById("wecomModal");
    if(mask && e.target === mask) closeWecomModal();
  });

  function renderQRCode(url){
    // ç¡®ä¿ url æ˜¯å¯è®¿é—®çš„ http/https åœ°å€ï¼Œfile:// åè®®ä¼šå½±å“éƒ¨åˆ†æ‰«ç å™¨
    const validUrl = url.startsWith('http') ? url : 'https://dog-mbti-test.pages.dev'; // å…œåº•çº¿ä¸Šåœ°å€
    
    const container = document.getElementById("qrcode");

    if(!container) return;
    container.innerHTML = "";
    new QRCode(container, {
      text: validUrl,
      width: 96,
      height: 110,
      colorDark : "#1a1a1a",
      colorLight : "#ffffff",
      correctLevel : QRCode.Level ? QRCode.Level.H : 3 // QRCode.Level å¯èƒ½ä¸å­˜åœ¨ï¼ŒLevel.H å¯¹åº” 3
    });
  }

  async function savePoster(options = {}){
    try{
      const opts = {
        autoDownload: true,
        showLoadingToast: true,
        showSuccessToast: true,
        scrollToPreview: true,
        refreshOnly: false,
        ...options
      };

      const el = document.getElementById("resultCard");
      if(!el){ toast("æ²¡æ‰¾åˆ°ç»“æœå¡"); return; }
      
      if(opts.showLoadingToast){
        toast(opts.refreshOnly ? "æ­£åœ¨æ›´æ–°æµ·æŠ¥..." : "æµ·æŠ¥ç”Ÿæˆä¸­...");
      }
      // å»¶è¿Ÿç¡®ä¿äºŒç»´ç æ¸²æŸ“å®Œæˆ
      await new Promise(resolve => setTimeout(resolve, 150));
      
      const canvas = await html2canvas(el, { 
        scale: 2, 
        useCORS: true, 
        backgroundColor: "#ffffff",
        width: 450,
        height: 800
      });


      const dataUrl = canvas.toDataURL("image/png");

      const img = document.getElementById("posterImg");
      const preview = document.getElementById("posterPreview");
      const saveTip = document.getElementById("saveTip");
      img.src = dataUrl;
      img.style.display = "block";
      if(preview) preview.classList.add("is-show");
      if(saveTip) saveTip.style.display = "flex";

      // è‡ªåŠ¨æ»šåŠ¨åˆ°å›¾ç‰‡ä½ç½®
      if(opts.scrollToPreview){
        (preview || img).scrollIntoView({ behavior: 'smooth', block: 'start' });
      }

      // PC å°è¯•ä¸‹è½½
      if(opts.autoDownload && !/MicroMessenger/i.test(navigator.userAgent)){
        const a = document.createElement("a");
        a.href = dataUrl;
        a.download = `æ¯›å­©å­MBTI-${finalType || "RESULT"}.png`;
        a.click();
      }

      if(opts.showSuccessToast){
        toast(opts.refreshOnly ? "å¤´åƒå·²æ›´æ–°ï¼Œæµ·æŠ¥å·²åˆ·æ–°" : "å·²ç”Ÿæˆå›¾ç‰‡ï¼Œé•¿æŒ‰å¯ä¿å­˜");
      }

      // äºŒæ¬¡è½¬åŒ–ï¼šç”Ÿæˆæµ·æŠ¥åå¼¹å‡ºä¼å¾®å¼¹çª—ï¼ˆä»…é™ä¸€æ¬¡ï¼‰
      if (!hasShownWecomModal) {
        setTimeout(() => {
          showWecomModal();
          hasShownWecomModal = true;
        }, 1500);
      }
    }catch(e){

      console.error(e);
      toast("ç”Ÿæˆå¤±è´¥ï¼Œè¯·æˆªå›¾ä¿å­˜");
    }
  }

  function setBar(p){


    const w = Math.max(0, Math.min(1, p)) * 100;
    const bar = document.getElementById("bar");
    if(bar) bar.style.width = w.toFixed(0) + "%";
  }

  function toast(msg){
    const el = document.getElementById("toast");
    el.innerText = msg;
    el.style.display = "block";
    clearTimeout(window.__t);
    window.__t = setTimeout(()=> el.style.display="none", 2000);
  }

</script>
</body>
</html>
