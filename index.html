<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>èŒå® è”èŒ Â· ç‹—ç‹—MBTIæ€§æ ¼æµ‹è¯•</title>
  <style>
    :root{
      --bg:#f6f7fb; --card:#fff; --text:#111; --muted:#666;
      --pri:#2b6aff; --pri2:#eef2ff; --shadow:0 10px 26px rgba(0,0,0,.08);
      --xhs-red: #ff2442;
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",Arial;color:var(--text);background:var(--bg); overflow-x: hidden;}
    .wrap{max-width:780px;margin:0 auto;padding:18px 16px 60px;}
    .card{background:var(--card);border-radius:16px;padding:20px;box-shadow:var(--shadow);margin:12px 0;}
    .title{font-size:24px;font-weight:900;margin:0 0 8px;letter-spacing:.2px; line-height: 1.3;}
    .sub{margin:0;color:var(--muted);line-height:1.6; font-size: 15px;}
    .row{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;}
    .tag{font-size:12px;color:var(--muted); background: #eee; padding: 2px 8px; border-radius: 4px;}
    .hr{height:1px;background:#eee;margin:16px 0;}
    .q{font-size:19px;font-weight:900;margin:0 0 16px; line-height: 1.4;}
    .opt{width:100%;text-align:left;border:2px solid transparent;border-radius:14px;padding:16px;margin:10px 0;font-size:16px;font-weight:700;cursor:pointer;background:#f7f8ff; transition: all 0.2s;}
    .opt:active{background: var(--pri2); border-color: var(--pri); transform: scale(0.98);}
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:15px;}
    button{border:0;border-radius:12px;padding:12px 18px;font-size:16px;font-weight:800;cursor:pointer; transition: opacity 0.2s;}
    button:active{opacity: 0.8;}
    .primary{background:var(--pri);color:#fff; flex: 1; min-width: 120px;}
    .ghost{background:var(--pri2);color:var(--pri); flex: 1; min-width: 120px;}
    .small{padding:10px 12px;border-radius:10px;font-size:14px;font-weight:800; flex: initial;}
    .muted{color:var(--muted);font-size:13px;line-height:1.7;}
    
    #panel { display: none; }
    
    .resultType{font-size:38px;font-weight:1000;letter-spacing:1px;margin:0; color: var(--pri);}

    .resultName{font-size:22px;font-weight:1000;margin:4px 0 6px;}
    .oneLine{font-size:15px;color:#444;line-height:1.7;margin:0; font-style: italic;}
    ul{padding-left:18px;margin:12px 0 0;}
    li{margin:6px 0;}
    .toast{position:fixed;left:50%;top:50%;transform:translate(-50%, -50%);background:rgba(0,0,0,.8);color:#fff;padding:12px 24px;border-radius:12px;font-size:15px;display:none;z-index:999; text-align: center; width: 80%; max-width: 300px;}
    .progressBar{height:6px;background:#eef0ff;border-radius:999px;overflow:hidden;margin-top:15px;}
    .progressBar>div{height:100%;background:var(--pri);width:0%; transition: width 0.3s;}
    
    /* æœ‹å‹åœˆ/å°çº¢ä¹¦é£æ ¼æµ·æŠ¥é‡æ„ */
    .poster {
      width: 450px; height: 800px; /* è¿˜åŸä¸ºæ ‡å‡†æ¯”ä¾‹ */
      background: #ffffff; border-radius: 24px; padding: 40px;
      display: flex; flex-direction: column; align-items: center;
      color: #111827; box-shadow: 0 20px 50px rgba(0,0,0,0.08);
      position: absolute; left: -9999px; top: 0;
    }
    
    .poster-brand { align-self: flex-start; font-size: 14px; color: #9CA3AF; letter-spacing: 1px; margin-bottom: 40px; font-weight: 600; }
    
    .poster-header { text-align: center; width: 100%; margin-bottom: 20px; }
    .poster-title-main { font-size: 22px; font-weight: 800; color: #111827; }
    
    .poster-center { flex: 1; text-align: center; width: 100%; display: flex; flex-direction: column; justify-content: center; }
    .poster-type-xl { 
      font-size: 110px; font-weight: 1000; color: var(--pri); 
      line-height: 0.9; margin: 0; letter-spacing: -4px;
    }
    .poster-name-sub { font-size: 24px; font-weight: 800; color: #111827; margin: 16px 0 10px; }
    .poster-gold-phrase { font-size: 18px; color: #4B5563; font-style: italic; margin-bottom: 30px; }
    
    .poster-pill-group { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-top: 10px; }
    .poster-pill-item { 
      background: #f0f4ff; color: var(--pri); padding: 6px 16px; 
      border-radius: 99px; font-size: 14px; font-weight: 700;
    }
    
    .poster-footer { 
      width: 100%; border-top: 1px solid #F3F4F6; padding-top: 30px;
      display: flex; justify-content: space-between; align-items: center;
    }
    
    .footer-left { flex: 1; }
    .test-cta-title { font-size: 16px; font-weight: 800; color: #111827; margin-bottom: 4px; }
    .test-cta-sub { font-size: 13px; color: #6B7280; }
    
    .qr-box { text-align: center; }
    .qr-container { width: 90px; height: 90px; padding: 5px; border: 1px solid #E5E7EB; border-radius: 12px; background: #fff; margin-bottom: 4px; }
    .qr-label { font-size: 11px; color: #9CA3AF; }

    /* å¼¹çª—æ ·å¼ */
    .modal-mask { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
    .modal { background: #fff; border-radius: 20px; padding: 24px; width: 100%; max-width: 320px; position: relative; text-align: center; }
    .modal-close { position: absolute; right: 15px; top: 10px; font-size: 24px; color: #999; cursor: pointer; }
    .modal-title { font-size: 18px; font-weight: 900; margin-bottom: 12px; }
    .wecom-qr-box { background: #f5f6f9; border-radius: 12px; padding: 20px; margin: 15px 0; border: 1px dashed #ddd; font-size: 14px; color: #666; }
    .pillRow { display: flex; gap: 8px; flex-wrap: wrap; margin: 12px 0; }
    .pill { background: var(--pri2); color: var(--pri); padding: 4px 12px; border-radius: 8px; font-size: 13px; font-weight: 700; }
    .community-card { background: #f8faff; border: 1px solid #eef2ff; border-radius: 14px; padding: 16px; margin-top: 20px; }

    .page { max-width: 420px; margin: 0 auto; padding: 20px 16px; background: #F6F7FB; }
    .panel-result { background: transparent; box-shadow: none; padding: 0; }
    .result-card { background: #fff; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,.06); padding: 22px; }
    .result-title { font-size: 20px; font-weight: 700; line-height: 1.2; margin: 0 0 12px; text-align: left; }
    .result-type { font-size: 64px; font-weight: 800; letter-spacing: -1px; text-align: center; margin: 12px 0 4px; }
    .result-name { font-size: 22px; font-weight: 700; text-align: center; margin: 0 0 4px; }
    .result-line { font-size: 14px; color: #6B7280; text-align: center; max-width: 260px; margin: 6px auto 12px; line-height: 1.6; }
    .result-tags { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin: 12px 0 16px; }
    .result-card .tag { height: 30px; padding: 0 12px; border-radius: 999px; background: #EEF2FF; color: #1D4ED8; font-size: 13px; display: inline-flex; align-items: center; font-weight: 600; }
    .section-title { font-weight: 700; margin-bottom: 8px; font-size: 15px; }

    .avatar-wrap { display: flex; align-items: center; gap: 12px; margin: 8px 0 14px; }
    .avatar-circle { width: 64px; height: 64px; border-radius: 50%; overflow: hidden; border: 2px solid #3B82F6; background: #f3f5ff; flex-shrink: 0; }
    .avatar-circle img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .avatar-btn { height: 36px; border-radius: 18px; border: 1px solid #3B82F6; color: #1D4ED8; background: transparent; padding: 0 12px; font-size: 12px; font-weight: 700; cursor: pointer; }

    .btn-primary, .primary { height: 44px; border-radius: 14px; background: linear-gradient(90deg,#2563EB,#1D4ED8); color: #fff; }
    .btn-ghost, .ghost { height: 44px; border-radius: 14px; background: transparent; color: #1D4ED8; border: 1px solid #3B82F6; }

    .qr-card { background: #fff; border-radius: 16px; padding: 16px; display: flex; align-items: center; justify-content: space-between; gap: 12px; border: 1px solid #F3F4F6; }
    .qr-text .test-cta-title { font-size: 16px; font-weight: 800; color: #111827; margin-bottom: 4px; }
    .qr-text .test-cta-sub { font-size: 13px; color: #6B7280; }
    .qr-code { width: 110px; height: 110px; flex-shrink: 0; }
    .qr-code #qrcode, .qr-code canvas, .qr-code img { width: 100% !important; height: 100% !important; display: block; }

    img#posterImg { display:none; width:100%; border-radius:24px; margin-top:20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid #eee; }




  </style>

</head>
<body>
  <div class="wrap">
    <div class="card" id="hero">
      <div class="row">
        <div>
          <h1 class="title">èŒå® è”èŒ Â· ç‹—ç‹—MBTIæ€§æ ¼æµ‹è¯•</h1>
          <p class="sub">16 é¢˜ï¼Œ1 åˆ†é’Ÿææ‡‚ä½ å®¶æ¯›å­©å­çš„â€œé™ªä¼´å‹äººæ ¼â€ï¼Œé¡ºä¾¿ç”Ÿæˆä¸€å¼ èƒ½æ™’çš„ç»“æœå¡ã€‚</p>
        </div>
        <div class="tag" id="statusTag">æœªå¼€å§‹</div>
      </div>
      <div class="progressBar"><div id="bar"></div></div>
      <div class="btns">
        <button class="primary" onclick="start()">å¼€å§‹æµ‹è¯•</button>
        <button class="ghost" onclick="showDemo()">çœ‹çœ‹ç¤ºä¾‹</button>
      </div>
      <p class="muted" style="margin-top:10px;">å®Œæˆåå¯è§£é”ã€åŒå“ç§Ã—åŒäººæ ¼ã€‘åŒç±»ç¾¤</p>
      <p class="muted" style="margin-top:4px;">å°æç¤ºï¼šæŒ‰ä½ å®¶ç‹—ç‹—â€œæ—¥å¸¸æœ€å¸¸è§çŠ¶æ€â€é€‰ï¼Œä¸ç”¨çº ç»“ä¸ªåˆ«ç‰¹ä¾‹ã€‚</p>
    </div>


    <div class="card" id="panel">
      <div class="row">
        <div class="tag" id="step">å‡†å¤‡ä¸­</div>
        <div class="tag" id="progress"></div>
      </div>
      <div class="hr"></div>
      <div id="content">
        <p class="muted">ç‚¹å‡»ã€Œå¼€å§‹æµ‹è¯•ã€è¿›å…¥ç¬¬ 1 é¢˜ã€‚</p>
      </div>
    </div>

    <div class="toast" id="toast">æµ‹è¯•ç»“æœå·²ç”Ÿæˆ</div>


  </div>

  <div class="modal-mask" id="wecomModal">
    <div class="modal">
      <span class="modal-close" onclick="closeWecomModal()">&times;</span>
      <div class="modal-title">åŠ ä¼å¾®è¿›ç¾¤</div>
      <div class="muted" style="font-size:13px;">å¾®ä¿¡å†…é•¿æŒ‰è¯†åˆ«äºŒç»´ç <br/>å‘é€â€œ<b id="wecomTypeLabel">ç‹—ç‹—äººæ ¼</b>â€æ‹‰ä½ è¿›ç¾¤</div>
      <div class="wecom-qr-box">
        <img src="wecom_qr.png" alt="ä¼ä¸šå¾®ä¿¡äºŒç»´ç " style="width: 200px; height: 200px; display: block; margin: 0 auto;" />
      </div>
      <div class="muted" style="font-size:12px; color:#999;">ç§ä¿¡æˆ‘ï¼Œå¸¦ä½ æ‰¾åŒå“ç§çš„å°ä¼™ä¼´ ğŸ¾</div>
    </div>

  </div>

  <!-- æµ·æŠ¥ç”Ÿæˆä¾èµ– -->

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>


<script>
  // 16é¢˜ï¼šæ¯ä¸ªç»´åº¦4é¢˜ï¼ˆç‹—ç‹—å‘ï¼‰

  // ç»´åº¦ï¼šE/I, S/N, T/F, J/P
  const questions = [
    // E/I
    { id:"E1", dim:"EI", q:"å®¶é‡Œæ¥äº†æ–°å®¢äººï¼ŒTAæ›´å¸¸ï¼š", A:"çƒ­æƒ…å‡‘è¿‘é—»ä¸€é—»ï¼Œæƒ³ç¤¾äº¤", B:"å…ˆé€€åè§‚å¯Ÿï¼Œç¡®è®¤å®‰å…¨å†é è¿‘", scoreA:{E:1}, scoreB:{I:1}},
    { id:"E2", dim:"EI", q:"æ•£æ­¥è·¯ä¸Šé‡åˆ°åˆ«çš„ç‹—ï¼ŒTAæ›´åƒï¼š", A:"ä¸»åŠ¨æ¥è¿‘ï¼Œæƒ³æ‰“æ‹›å‘¼", B:"æ›´æ„¿æ„è´´ç€ä½ èµ°ï¼Œä¸å¤ªæ­ç†", scoreA:{E:1}, scoreB:{I:1}},
    { id:"E3", dim:"EI", q:"ä½ å›å®¶å¼€é—¨é‚£ä¸€åˆ»ï¼ŒTAé€šå¸¸ï¼š", A:"å†²æ¥è¿æ¥ï¼Œæƒ…ç»ªæ‹‰æ»¡", B:"å…ˆçœ‹å‡ ç§’ï¼Œç­‰ä½ æ‹›å‘¼å†é è¿‘", scoreA:{E:1}, scoreB:{I:1}},
    { id:"E4", dim:"EI", q:"åœ¨é™Œç”Ÿç¯å¢ƒé‡Œï¼ŒTAæ›´å¯èƒ½ï¼š", A:"è¶Šçƒ­é—¹è¶Šå…´å¥‹ï¼Œåˆ°å¤„æ¢ç´¢", B:"æ‰¾ä¸ªå®‰å…¨ç‚¹çš„ä½ç½®æ…¢æ…¢é€‚åº”", scoreA:{E:1}, scoreB:{I:1}},
    // S/N
    { id:"S1", dim:"SN", q:"åˆ°æ–°åœ°æ–¹ï¼ŒTAæœ€å…ˆæ²‰è¿·çš„æ˜¯ï¼š", A:"åœ°ä¸Šå„ç§å‘³é“ä¸ç»†èŠ‚çº¿ç´¢", B:"æ•´ä½“æ°›å›´ï¼Œå“ªé‡Œå¯èƒ½æœ‰æ–°ç©æ³•", scoreA:{S:1}, scoreB:{N:1}},
    { id:"S2", dim:"SN", q:"ç»™TAæ–°ç©å…·ï¼ŒTAæ›´åƒï¼š", A:"ç ”ç©¶ç»“æ„ï¼šå’¬å“ªå„¿ã€æ€ä¹ˆç©æœ€é¡ºæ‰‹", B:"ç©æ³•å‘æ•£ï¼šå®ƒè¿˜èƒ½æ€ä¹ˆâ€œæ•´æ´»â€", scoreA:{S:1}, scoreB:{N:1}},
    { id:"S3", dim:"SN", q:"å­¦æ–°æŒ‡ä»¤æ—¶ï¼ŒTAæ›´å®¹æ˜“ï¼š", A:"é é‡å¤ç»ƒä¹ ç¨³ç¨³å­¦ä¼š", B:"å­¦ä¼šåä¼šä¸¾ä¸€åä¸‰è‡ªå·±å‘æŒ¥", scoreA:{S:1}, scoreB:{N:1}},
    { id:"S4", dim:"SN", q:"ä½ æŠŠé£Ÿç›†/çªä½ç½®æ¢äº†ï¼ŒTAä¼šï¼š", A:"ç«‹åˆ»å‘ç°ï¼šå’¦æ€ä¹ˆä¸åœ¨è€åœ°æ–¹", B:"æ— æ‰€è°“ï¼šåæ­£æœ€åéƒ½èƒ½æ‰¾åˆ°", scoreA:{S:1}, scoreB:{N:1}},
    // T/F
    { id:"T1", dim:"TF", q:"TAçŠ¯é”™è¢«ä½ åˆ¶æ­¢åï¼ŒTAæ›´åƒï¼š", A:"å…ˆåˆ¤æ–­è§„åˆ™ï¼šè¿™äº‹åˆ°åº•èƒ½ä¸èƒ½åš", B:"å…ˆçœ‹ä½ æƒ…ç»ªï¼šä½ æ˜¯ä¸æ˜¯ç”Ÿæ°”äº†", scoreA:{T:1}, scoreB:{F:1}},
    { id:"T2", dim:"TF", q:"è®­ç»ƒæ—¶TAæ›´åƒå“ªå¥—ï¼š", A:"æŒ‡ä»¤æ¸…æ™°+è§„åˆ™ä¸€è‡´ï¼Œå­¦å¾—æ›´å¿«", B:"å¤šå¤¸å¤šå“„å¤šå¥–åŠ±ï¼ŒçŠ¶æ€æ›´å¥½", scoreA:{T:1}, scoreB:{F:1}},
    { id:"T3", dim:"TF", q:"ä½ å¿ƒæƒ…ä¸å¤ªå¥½æ—¶ï¼ŒTAæ›´å¸¸ï¼š", A:"ç”¨è¡ŒåŠ¨è§£å†³ï¼šå¼ç©å…·/æ‹‰ä½ å»ç©", B:"æƒ…ç»ªé™ªä¼´ï¼šè´´è´´/å®ˆåœ¨ä½ æ—è¾¹", scoreA:{T:1}, scoreB:{F:1}},
    { id:"T4", dim:"TF", q:"é‡åˆ°åˆ«çš„ç‹—æŠ¢ç©å…·ï¼ŒTAæ›´å¯èƒ½ï¼š", A:"äº‰å¤º/åšæŒï¼šæˆ‘çš„å°±æ˜¯æˆ‘çš„", B:"é€€ä¸€æ­¥/æ±‚åŠ©ä½ ï¼šåˆ«åµåˆ«åµ", scoreA:{T:1}, scoreB:{F:1}},
    // J/P
    { id:"J1", dim:"JP", q:"æ—¥å¸¸ä½œæ¯ä¸Šï¼ŒTAæ›´åƒï¼š", A:"è§„å¾‹æ´¾ï¼šåˆ°ç‚¹åƒåˆ°ç‚¹ç¡", B:"éšç¼˜æ´¾ï¼šçœ‹å¿ƒæƒ…å†³å®šä»Šå¤©èŠ‚å¥", scoreA:{J:1}, scoreB:{P:1}},
    { id:"J2", dim:"JP", q:"ä½ æ‹¿å‡ºç‰µå¼•ç»³è¦å‡ºé—¨ï¼ŒTAé€šå¸¸ï¼š", A:"ç«‹åˆ»è¿›å…¥çŠ¶æ€ï¼Œå‡†å¤‡å‡ºå‘", B:"çœ‹å¿ƒæƒ…ï¼šæœ‰æ—¶å…´å¥‹æœ‰æ—¶è£…æ­»", scoreA:{J:1}, scoreB:{P:1}},
    { id:"J3", dim:"JP", q:"ç©â€œå¼å›â€ä¹‹ç±»çš„æ¸¸æˆï¼ŒTAæ›´åƒï¼š", A:"æŒ‰æµç¨‹ï¼šå¼æ¥-æ”¾ä¸‹-å†æ¥", B:"éšæ—¶æ”¹è§„åˆ™ï¼šçªç„¶è·‘å/æ•´æ´»", scoreA:{J:1}, scoreB:{P:1}},
    { id:"J4", dim:"JP", q:"å‡ºé—¨è·¯çº¿æ¢äº†ï¼ŒTAæ›´åƒï¼š", A:"æœ‰ç‚¹ä¸çˆ½ï¼šæ€ä¹ˆä¸èµ°è€è·¯ï¼Ÿ", B:"æ›´å¼€å¿ƒï¼šæ¢è·¯=æ–°çš„ä¸–ç•Œï¼", scoreA:{J:1}, scoreB:{P:1}}
  ];

  // 16å‹ç»“æœåº“ï¼ˆä¸­æ–‡å+é‡‘å¥+å»ºè®®+æ ‡ç­¾ï¼‰
  const results = {
    "ENFP": { name:"å¿«ä¹ç¤¾äº¤å°æ—‹é£", line:"äººè§äººçˆ±ï¼Œä½†ç²¾åŠ›åƒæ°¸åŠ¨æœºã€‚", tags:["ç¤¾äº¤è¾¾äºº","é«˜å…´å¥‹","éœ€è¦æ”¾ç”µ"],
      tips:["æ¯å¤©ä¸¤æ¬¡é«˜è´¨é‡æ”¾ç”µï¼ˆå—…é—»+è¿½é€ï¼‰","ç¤¾äº¤è¦â€œæœ‰è¾¹ç•Œâ€ï¼Œé¿å…è¿‡åº¦åˆºæ¿€","è®­ç»ƒçŸ­é¢‘å¿«ï¼Œå¤šç”¨å¥–åŠ±"] },
    "ENFJ": { name:"è´´å¿ƒå›¢å® å“„å“„å®˜", line:"ä¼šè¯»ç©ºæ°”ï¼Œè¿˜ç‰¹åˆ«ä¼šå“„äººã€‚", tags:["æƒ…ç»ªæ„ŸçŸ¥","ç²˜äººæš–å¿ƒ","é…åˆåº¦é«˜"],
      tips:["å¤šç”¨å¤¸å¥–ä¸æŠšæ‘¸å»ºç«‹å®‰å…¨æ„Ÿ","å®‰æ’ç¨³å®šç¤¾äº¤ï¼šç†Ÿäºº+å›ºå®šåœºåœ°","ç»™å®ƒä¸€ä¸ªâ€œé™ªä¼´å²—ä½â€ï¼ˆå¦‚é—¨å£è¿æ¥ï¼‰"] },
    "ENTP": { name:"ç‚¹å­ç‹æ‹†å®¶å¤§å¸ˆ", line:"èªæ˜åˆ°å¯æ€•ï¼Œé—²ç€å°±æƒ³æ•´æ´»ã€‚", tags:["é«˜æ™ºå•†","å¥½å¥‡å¿ƒ","çˆ±æŒ‘æˆ˜"],
      tips:["ç”¨ç›Šæ™ºç©å…·/å¯»å®æ¸¸æˆæ¶ˆè€—è„‘åŠ›","è®­ç»ƒå¢åŠ éš¾åº¦ï¼šå˜æ¢åœºæ™¯/å¹²æ‰°","å®¶é‡Œåšå¥½é˜²å’¬ä¸æ›¿ä»£ç‰©ï¼ˆå’¬èƒ¶ï¼‰"] },
    "ENTJ": { name:"è§„åˆ™æ‰§è¡Œé˜Ÿé•¿", line:"æœ‰ä¸»è§ã€æœ‰ç§©åºï¼Œæƒ³å½“è€å¤§ã€‚", tags:["å¼ºç›®æ ‡","æ‰§è¡ŒåŠ›","ä¸»å¯¼å‹"],
      tips:["è§„åˆ™ä¸€è‡´ï¼Œå£ä»¤ç»Ÿä¸€ï¼ˆå®¶é‡Œæ‰€æœ‰äººï¼‰","ç”¨ä»»åŠ¡é©±åŠ¨ï¼šåä¸‹â†’ç­‰å¾…â†’å¥–åŠ±","æ—©æœŸç¤¾äº¤è®­ç»ƒé¿å…å†²çªå‡çº§"] },

    "ESFP": { name:"æ´¾å¯¹æ°”æ°›ç»„ç»„é•¿", line:"å“ªé‡Œçƒ­é—¹å»å“ªï¼Œå¿«ä¹ä¸è®¾é˜²ã€‚", tags:["å¤–å‘","çˆ±ç©","é«˜äº’åŠ¨"],
      tips:["å¤šå®‰æ’äº’åŠ¨æ¸¸æˆï¼šé£ç›˜/æ‹”æ²³ï¼ˆæœ‰è§„åˆ™ï¼‰","é¿å…è¿‡åº¦å…´å¥‹ï¼šç©å‰å…ˆåä¸‹ç­‰å¾…","ç¤¾äº¤åç»™å®‰é™ä¼‘æ¯æ—¶é—´"] },
    "ESFJ": { name:"å®¶åº­æ°›å›´å®ˆæŠ¤è€…", line:"å°±çˆ±è·Ÿç€ä½ ï¼Œå®¶é‡Œè°éƒ½è¦ç®¡ã€‚", tags:["é»äºº","æŠ¤å®¶","å¥½é…åˆ"],
      tips:["ç»™ç¨³å®šä½œæ¯ä¸å›ºå®šä»ªå¼æ„Ÿ","åˆ†ç¦»è®­ç»ƒè¦å¾ªåºæ¸è¿›ï¼ˆçŸ­æ—¶ç¦»å¼€ï¼‰","å¤šåšâ€œé™ªä¼´å‹ä»»åŠ¡â€æå‡æ»¡è¶³æ„Ÿ"] },
    "ESTP": { name:"å†²é”‹æ¢ç´¢è¡ŒåŠ¨æ´¾", line:"å…ˆå¹²å†è¯´ï¼Œè¡ŒåŠ¨æ°¸è¿œå¿«ä¸€æ­¥ã€‚", tags:["è¡ŒåŠ¨æ´¾","èƒ†å­å¤§","çˆ±æ¢ç´¢"],
      tips:["å¤–å‡ºä¼˜å…ˆâ€œå—…é—»+æ¢ç´¢â€å†è®­ç»ƒ","ç”¨ç»³æ§ä¸å›å«å»ºç«‹è¾¹ç•Œ","ç»™å†²åˆºå‹è¿åŠ¨ï¼ˆçŸ­è·‘/è¿½é€ï¼‰"] },
    "ESTJ": { name:"çºªå¾‹å§”å‘˜å°è­¦é•¿", line:"æœ€æ‡‚è§„çŸ©ï¼Œä¹Ÿæœ€ä¼šâ€œç›¯äººâ€ã€‚", tags:["ç¨³å®š","è®²è§„åˆ™","è¾¹ç•Œæ¸…æ™°"],
      tips:["è®­ç»ƒè¦æ ‡å‡†åŒ–ï¼šå£ä»¤+æ‰‹åŠ¿å›ºå®š","é€‚åˆå­¦ä¹ æŠ€å·§ï¼šå®šç‚¹ã€ç­‰å¾…ã€éšè¡Œ","ç¤¾äº¤å†²çªæ—¶å…ˆè®©å®ƒâ€œåä¸‹å†·é™â€"] },

    "INFP": { name:"ç»ç’ƒå¿ƒæµªæ¼«é™ªä¼´è€…", line:"æ•æ„Ÿåˆæ·±æƒ…ï¼Œåªè®¤è‡ªå·±äººã€‚", tags:["æ•æ„Ÿ","ä¾æ‹","æ…¢çƒ­"],
      tips:["å‡å°‘å¼ºè¡Œç¤¾äº¤ï¼Œç”¨â€œè·ç¦»+å¥–åŠ±â€å»ºç«‹ä¿¡ä»»","ç»™å®‰å…¨åŒºï¼šçª/ç¬¼/è§’è½","ç”¨æ¸©å’Œè®­ç»ƒæ–¹å¼ï¼Œé¿å…å¤§å£°å‘µæ–¥"] },
    "INFJ": { name:"ç¥ç§˜æ²»æ„ˆç³»å®ˆæŠ¤è€…", line:"å®‰é™è§‚å¯Ÿï¼Œä½†å…³é”®æ—¶åˆ»å¾ˆé è°±ã€‚", tags:["è§‚å¯Ÿå‹","ç²˜ä½ ","æœ‰åˆ†å¯¸"],
      tips:["å›ºå®šä½œæ¯ä¸åœºæ™¯ï¼Œå®‰å…¨æ„Ÿæ›´å¼º","è®­ç»ƒç”¨â€œæç¤ºâ†’æˆåŠŸâ†’å¥–åŠ±â€ã€‘ã€ç¤¾äº¤ä»¥ç†Ÿäººå±€ä¸ºä¸»ï¼Œæ…¢æ…¢æ‰©åœˆ"] },
    "INTP": { name:"ç ”ç©¶å‹å¥½å¥‡å®å®", line:"çˆ±ç ”ç©¶ï¼Œåƒä¸ªå°ç§‘å­¦å®¶ã€‚", tags:["ç‹¬ç«‹","å¥½å¥‡","è„‘åŠ›å‹"],
      tips:["å¤šç»™ç›Šæ™ºç©å…·ã€å—…é—»å«ã€å¯»å®","è®­ç»ƒåŠ å…¥å˜åŒ–ï¼Œä¸ç„¶ä¼šæ— èŠ","ç”¨å¥–åŠ±å»ºç«‹â€œæ„¿æ„é…åˆâ€çš„åŠ¨åŠ›"] },
    "INTJ": { name:"é«˜æ™ºå•†ç­–ç•¥å®¶", line:"ä¸åµä¸é—¹ï¼Œä½†å¿ƒé‡Œé—¨å„¿æ¸…ã€‚", tags:["å†·é™","ç­–ç•¥","è‡ªæ§å¼º"],
      tips:["è§„åˆ™æ˜ç¡®ã€è¾¹ç•Œæ¸…æ™°ï¼Œå°‘åå¤","è®­ç»ƒåâ€œä»»åŠ¡å‹â€ï¼šå®šç‚¹/éšè¡Œ","ç¤¾äº¤å…ˆè§‚å¯Ÿï¼Œåˆ«å‚¬ï¼Œç»™å®ƒé€‰æ‹©æƒ"] },

    "ISFP": { name:"æ¸©æŸ”æ•æ„Ÿå°è‰ºæœ¯å®¶", line:"æ¸©æŸ”åˆæŒ‘å‰”ï¼Œå–œæ¬¢èˆ’æœçš„èŠ‚å¥ã€‚", tags:["æ¸©æŸ”","æ…¢çƒ­","äº«å—å‹"],
      tips:["ç¯å¢ƒèˆ’é€‚æœ€é‡è¦ï¼šæ¸©åº¦ã€å«å­ã€å™ªéŸ³","è®­ç»ƒç”¨é¼“åŠ±æ›¿ä»£å‹åŠ›","å¤–å‡ºåˆ«å¤ªä¹…ï¼Œç»™è¶³ä¼‘æ¯"] },
    "ISFJ": { name:"æš–å¿ƒè´´è´´ä¿å§†å‹", line:"ä¸äº‰ä¸æŠ¢ï¼Œå°±æƒ³å®ˆç€ä½ ã€‚", tags:["è´´å¿ƒ","ç¨³å®š","é¡¾å®¶"],
      tips:["é€‚åˆè§„å¾‹é™ªä¼´ï¼šå›ºå®šæ•£æ­¥æ—¶é—´","åšåˆ†ç¦»è®­ç»ƒé¿å…ä¾èµ–è¿‡å¼º","ç”¨è½»æ¾äº’åŠ¨ï¼ˆæŠšæ‘¸/èˆ”é£Ÿï¼‰å®‰æŠš"] },
    "ISTP": { name:"å†·é™ç‹¬è¡Œè§‚å¯Ÿå‘˜", line:"ç‹¬ç«‹ã€è‡ªæ´½ï¼Œä¸çˆ±è¢«æ‰“æ‰°ã€‚", tags:["ç‹¬ç«‹","å†·é™","è§‚å¯Ÿ"],
      tips:["ç»™ç©ºé—´ï¼šåˆ«ä¸€ç›´æŠ±ã€åˆ«å¼ºäº’åŠ¨","è®­ç»ƒç”¨â€œå°‘è¯´å¤šåšâ€ï¼šåŠ¨ä½œæ˜ç¡®","ç¤¾äº¤å°‘è€Œç²¾ï¼Œé¿å…è¿‡åº¦æ¶ˆè€—"] },
    "ISTJ": { name:"ç¨³å®šå¯é è€å¹²éƒ¨", line:"ç¨³ã€å‡†ã€ç‹ ï¼šæŒ‰è§„çŸ©æ¥æœ€èˆ’æœã€‚", tags:["ç¨³é‡","å®ˆè§„åˆ™","ä½æ³¢åŠ¨"],
      tips:["å›ºå®šè§„åˆ™+å›ºå®šè·¯çº¿ï¼Œæœ€çœå¿ƒ","è®­ç»ƒé‡â€œé‡å¤ä¸ä¸€è‡´æ€§â€","é€‚åˆåšåŸºç¡€æœä»ï¼šç­‰å¾…/éšè¡Œ/å›å«"] }
  };

  let idx = -1;
  let score = {E:0,I:0,S:0,N:0,T:0,F:0,J:0,P:0};
  let finalType = "";

  // è¿™é‡Œçš„ YOUR_TEST_LINK é»˜è®¤ç›´æ¥ç”¨å½“å‰é¡µé¢åœ°å€
  const getTestLink = () => location.href.split('?')[0];

  function start(){
    idx = 0;
    score = {E:0,I:0,S:0,N:0,T:0,F:0,J:0,P:0};
    document.getElementById("hero").style.display = "none";
    document.getElementById("panel").style.display = "block";
    document.getElementById("statusTag").innerText = "æµ‹è¯•è¿›è¡Œä¸­";
    renderQuestion();
  }

  function showDemo(){
    start(); // å…ˆåˆ‡æ¢æ˜¾ç¤º
    idx = 16; // æ¨¡æ‹Ÿç»“æŸ
    renderResult("ENFP");
  }

  function renderQuestion(){

    const q = questions[idx];
    const panel = document.getElementById("panel");
    if(panel) panel.classList.remove("panel-result");
    document.getElementById("step").innerText = "é¢˜ç›®è¿›åº¦";
    document.getElementById("progress").innerText = `${idx+1}/${questions.length}`;
    setBar((idx)/questions.length);

    document.getElementById("content").innerHTML = `
      <div class="q">${q.q}</div>
      <button class="opt" onclick="choose('A')">A. ${q.A}</button>
      <button class="opt" onclick="choose('B')">B. ${q.B}</button>
      <div class="muted" style="text-align:center;margin-top:10px;font-size:12px;">åšå®Œå¯è§£é”ã€åŒå“ç§Ã—åŒäººæ ¼ã€‘åŒç±»ç¾¤</div>
    `;

  }

  function choose(which){
    const q = questions[idx];
    const s = (which === "A") ? q.scoreA : q.scoreB;
    Object.keys(s).forEach(k => score[k] += s[k]);

    idx += 1;
    if(idx >= questions.length){
      finalType = calcType();
      renderResult(finalType);
    }else{
      renderQuestion();
    }
  }

  function calcType(){
    const EI = (score.E >= score.I) ? "E" : "I";
    const SN = (score.S >= score.N) ? "S" : "N";
    const TF = (score.T >= score.F) ? "T" : "F";
    const JP = (score.J >= score.P) ? "J" : "P";
    return EI+SN+TF+JP;
  }

  const subTitles = {
    E: "æ®è¯´è¿™ç§ç‹—åœ¨ç¾¤é‡Œæœ€å—æ¬¢è¿ğŸ˜†",
    I: "å¤–å†·å†…çƒ­çš„å°ç”œå¿ƒå°±æ˜¯å®ƒå§âœ¨",
    S: "ç¨³é‡å¯é çš„å®¶åº­å°å«å£«ğŸ¶",
    N: "è„‘å›è·¯æ¸…å¥‡çš„æœºçµé¬¼æœ¬é¬¼ğŸ§ "
  };

  const AVATAR_KEY = "dog_mbti_avatar";
  const DEFAULT_AVATAR = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 200 200'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop stop-color='%23a5b4ff' offset='0'/%3E%3Cstop stop-color='%232b6aff' offset='1'/%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='100' cy='100' r='96' fill='url(%23g)'/%3E%3Ctext x='100' y='120' text-anchor='middle' font-size='64' font-family='Arial' fill='white'%3EğŸ¶%3C/text%3E%3C/svg%3E";

  function getAvatar(){
    try{ return localStorage.getItem(AVATAR_KEY) || DEFAULT_AVATAR; }
    catch(e){ return DEFAULT_AVATAR; }
  }

  function applyAvatar(){
    const img = document.getElementById("avatarImg");
    if(img) img.src = getAvatar();
  }

  function openAvatarPicker(){
    const input = document.getElementById("avatarInput");
    if(input){ input.value = ""; input.click(); }
  }

  function handleAvatarChange(e){
    const file = e.target.files && e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = function(ev){
      const dataUrl = ev.target.result;
      if(typeof dataUrl === "string"){
        try{ localStorage.setItem(AVATAR_KEY, dataUrl); }catch(err){}
        applyAvatar();
      }
    };
    reader.readAsDataURL(file);
  }

  function renderResult(type){

    const r = results[type] || results["ENFP"];
    document.getElementById("statusTag").innerText = "å·²å‡ºç»“æœ";
    document.getElementById("step").innerText = "æµ‹è¯•å®Œæˆ";
    document.getElementById("progress").innerText = "";
    setBar(1);


    const tipsHtml = r.tips.slice(0, 3).map(t=>`<li>${t}</li>`).join("");
    const tagsHtml = r.tags.map(t=>`<span class="tag">${t}</span>`).join("");
    const posterPillsHtml = r.tags.slice(0, 3).map(t=>`<span class="poster-pill-item">${t}</span>`).join("");

    const panel = document.getElementById("panel");
    if(panel) panel.classList.add("panel-result");

    document.getElementById("content").innerHTML = `
      <div class="page">
        <div class="result-card">
          <div class="result-title">æµ‹è¯•ç»“æœï¼š${r.name}</div>

          <div class="avatar-wrap">
              <div class="avatar-circle">
                  <img id="avatarImg" alt="å¤´åƒ" />
              </div>
              <button class="avatar-btn" type="button" onclick="openAvatarPicker()">æ¢å¤´åƒ</button>
              <input id="avatarInput" type="file" accept="image/*" style="display:none" onchange="handleAvatarChange(event)" />
          </div>

          <div class="result-type">${type}</div>
          <div class="result-name">${r.name}</div>
          <div class="result-line">â€œ${r.line}â€</div>

          <div class="result-tags">${tagsHtml}</div>
          <div class="hr"></div>
          <div class="section-title">ä¸“å±å…»å® å»ºè®®</div>
          <ul class="muted">${tipsHtml}</ul>

          <div class="hr"></div>

          <!-- æµ·æŠ¥å¡ï¼šç”¨äºç”Ÿæˆå›¾ç‰‡ (åœ¨å±å¹•å¤–æ¸²æŸ“) -->
          <div id="resultCard" class="poster">
            <div class="poster-brand">ç‹—ç‹— MBTI æ€§æ ¼æµ‹è¯•æŠ¥å‘Š</div>
            
            <div class="poster-header">
                <div class="poster-title-main">æµ‹è¯•ç»“æœï¼š${r.name}</div>
            </div>

            <div class="avatar-wrap">
                <div class="avatar-circle">
                    <img id="avatarImg" alt="å¤´åƒ" />
                </div>
                <button class="avatar-btn" type="button" onclick="openAvatarPicker()">æ¢å¤´åƒ</button>
                <input id="avatarInput" type="file" accept="image/*" style="display:none" onchange="handleAvatarChange(event)" />
            </div>

            <div class="poster-center">
                <div class="poster-type-xl">${type}</div>
                <div class="poster-name-sub">${r.name}</div>
                <div class="poster-gold-phrase">â€œ${r.line}â€</div>
                <div class="poster-pill-group">
                    ${posterPillsHtml}
                </div>
            </div>

            <div class="qr-card">
                <div class="qr-text">
                  <div class="test-cta-title">æ‰«ç æµ‹æµ‹ä½ å®¶ç‹—ç‹—</div>
                  <div class="test-cta-sub">æ‰“å¼€é“¾æ¥ï¼Œä¸€åˆ†é’Ÿè§£é”æ€§æ ¼å¯†ç </div>
                </div>
                <div class="qr-code">
                  <div id="qrcode"></div>
                </div>
            </div>
          </div>

          <div class="btns">
            <button class="btn-primary" onclick="savePoster()">ç”Ÿæˆç»“æœå›¾</button>
          </div>

          <div class="btns">
            <button class="btn-ghost" style="flex:none; width: 100%;" onclick="start()">é‡æ–°æµ‹è¯•</button>
          </div>

          <img id="posterImg" />
          <div id="saveTip" class="muted" style="margin-top:15px; display:none; text-align:center; padding: 10px; background: #fff; border-radius: 12px; border: 1px dashed var(--pri);">
            ğŸ‘† <b>é•¿æŒ‰ä¿å­˜å›¾ç‰‡ï¼Œå‘æœ‹å‹åœˆ/ç¾¤</b>
          </div>

          <div class="community-card">
            <div style="font-weight:900; color:var(--pri); font-size:15px; margin-bottom:4px;">è§£é”åŒç±»åœˆå­</div>
            <div class="muted" style="font-size:12px; margin-bottom:12px;">æ‰«ç åŠ ä¼å¾®ï¼Œå‘æˆ‘â€œäººæ ¼ç»“æœâ€æ‹‰ä½ è¿›ç¾¤</div>
            <button class="btn-primary small" style="width:100%; padding:10px;" onclick="showWecomModal()">åŠ ä¼å¾®é¢†å–å…¥ç¾¤ç </button>
          </div>
        </div>
      </div>
    `;





    // å¤´åƒæ¸²æŸ“
    applyAvatar();

    // æ¸²æŸ“äºŒç»´ç 
    renderQRCode(getTestLink());
  }


  let hasShownWecomModal = false;

  function showWecomModal() {
    const typeLabel = document.getElementById("wecomTypeLabel");
    if(typeLabel) typeLabel.innerText = finalType || "ç‹—ç‹—äººæ ¼";
    document.getElementById("wecomModal").style.display = "flex";
  }

  function closeWecomModal() {
    document.getElementById("wecomModal").style.display = "none";
  }

  function renderQRCode(url){
    // ç¡®ä¿ url æ˜¯å¯è®¿é—®çš„ http/https åœ°å€ï¼Œfile:// åè®®ä¼šå½±å“éƒ¨åˆ†æ‰«ç å™¨
    const validUrl = url.startsWith('http') ? url : 'https://dog-mbti-test.pages.dev'; // å…œåº•çº¿ä¸Šåœ°å€
    
    const container = document.getElementById("qrcode");

    if(!container) return;
    container.innerHTML = "";
    new QRCode(container, {
      text: validUrl,
      width: 96,
      height: 110,
      colorDark : "#1a1a1a",
      colorLight : "#ffffff",
      correctLevel : QRCode.Level ? QRCode.Level.H : 3 // QRCode.Level å¯èƒ½ä¸å­˜åœ¨ï¼ŒLevel.H å¯¹åº” 3
    });
  }

  async function savePoster(){
    try{
      const el = document.getElementById("resultCard");
      if(!el){ toast("æ²¡æ‰¾åˆ°ç»“æœå¡"); return; }
      
      toast("æµ·æŠ¥ç”Ÿæˆä¸­...");
      // å»¶è¿Ÿç¡®ä¿äºŒç»´ç æ¸²æŸ“å®Œæˆ
      await new Promise(resolve => setTimeout(resolve, 150));
      
      const canvas = await html2canvas(el, { 
        scale: 2, 
        useCORS: true, 
        backgroundColor: "#ffffff",
        width: 450,
        height: 800
      });


      const dataUrl = canvas.toDataURL("image/png");

      const img = document.getElementById("posterImg");
      img.src = dataUrl;
      img.style.display = "block";
      document.getElementById("saveTip").style.display = "block";

      // è‡ªåŠ¨æ»šåŠ¨åˆ°å›¾ç‰‡ä½ç½®
      img.scrollIntoView({ behavior: 'smooth', block: 'start' });

      // PC å°è¯•ä¸‹è½½
      if(!/MicroMessenger/i.test(navigator.userAgent)){
        const a = document.createElement("a");
        a.href = dataUrl;
        a.download = `ç‹—ç‹—MBTI-${finalType || "RESULT"}.png`;
        a.click();
      }

      toast("å·²ç”Ÿæˆå›¾ç‰‡ï¼Œé•¿æŒ‰å¯ä¿å­˜");

      // äºŒæ¬¡è½¬åŒ–ï¼šç”Ÿæˆæµ·æŠ¥åå¼¹å‡ºä¼å¾®å¼¹çª—ï¼ˆä»…é™ä¸€æ¬¡ï¼‰
      if (!hasShownWecomModal) {
        setTimeout(() => {
          showWecomModal();
          hasShownWecomModal = true;
        }, 1500);
      }
    }catch(e){

      console.error(e);
      toast("ç”Ÿæˆå¤±è´¥ï¼Œè¯·æˆªå›¾ä¿å­˜");
    }
  }

  function setBar(p){


    const w = Math.max(0, Math.min(1, p)) * 100;
    const bar = document.getElementById("bar");
    if(bar) bar.style.width = w.toFixed(0) + "%";
  }

  function toast(msg){
    const el = document.getElementById("toast");
    el.innerText = msg;
    el.style.display = "block";
    clearTimeout(window.__t);
    window.__t = setTimeout(()=> el.style.display="none", 2000);
  }

</script>
</body>
</html>
