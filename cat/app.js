function loadScript(src, fallbackSrc) {
  return new Promise(function(resolve, reject) {
    var s = document.createElement('script');
    s.src = src;
    s.onload = resolve;
    s.onerror = function() {
      if (fallbackSrc) {
        console.warn('CDN failed: ' + src + ', trying fallback...');
        var fb = document.createElement('script');
        fb.src = fallbackSrc;
        fb.onload = resolve;
        fb.onerror = reject;
        document.head.appendChild(fb);
      } else { reject(new Error('Failed to load: ' + src)); }
    };
    document.head.appendChild(s);
  });
}
// qrcode.js ç«‹å³åŠ è½½ï¼ˆç»“æœé¡µæ¸²æŸ“éœ€è¦ï¼‰
loadScript(
  'https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js',
  'https://unpkg.com/qrcodejs@1.0.0/qrcode.min.js'
).then(function(){ console.log('qrcode.js loaded'); })
 .catch(function(e){ console.error('qrcode.js load failed:', e); });

// html2canvas æ‡’åŠ è½½ï¼šç‚¹å‡»ç”Ÿæˆæµ·æŠ¥æ—¶æ‰åŠ è½½ï¼ˆ~500KBï¼‰
var _html2canvasLoading = null;
function ensureHtml2Canvas() {
  if (typeof html2canvas !== 'undefined') return Promise.resolve();
  if (_html2canvasLoading) return _html2canvasLoading;
  _html2canvasLoading = loadScript(
    'https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js',
    'https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js'
  ).then(function(){ console.log('html2canvas lazy-loaded'); });
  return _html2canvasLoading;
}

/* ==========================================
 * äº‹ä»¶è¿½è¸ªæ¡†æ¶ï¼ˆå·²æ¥å…¥CloudBaseæ•°æ®åº“ï¼‰
 * ========================================== */
let _cbDb = null;
function trackEvent(category, action, label, value) {
  try {
    console.log('[Track]', category, action, label || '', value || '');
    if (_cbDb) {
      _cbDb.collection('events').add({
        c: category,
        a: action,
        l: label || '',
        v: value || 0,
        pet: 'cat',
        t: new Date(),
        ts: Date.now()
      });
    }
  } catch(e) { /* é™é»˜å¿½ç•¥è¿½è¸ªé”™è¯¯ */ }
}
/* ==========================================
 * CloudBase åˆå§‹åŒ–ï¼ˆåŸ‹ç‚¹æ•°æ®å†™å…¥äº‘æ•°æ®åº“ï¼‰
 * ========================================== */
(async function initCloudBase() {
  try {
    const app = cloudbase.init({
      env: 'mengchong-dev-6g4qar062ad266bc'
    });
    const auth = app.auth({ persistence: 'local' });
    await auth.signInAnonymously();
    _cbDb = app.database();
    console.log('[CloudBase] åˆå§‹åŒ–æˆåŠŸï¼ŒåŒ¿åç™»å½•å®Œæˆ');
    // åˆå§‹åŒ–å®Œæˆåå†è®°å½• page_viewï¼Œç¡®ä¿äº‹ä»¶ä¸ä¸¢å¤±
    trackEvent('funnel', 'page_view', document.title);
  } catch(e) {
    console.warn('[CloudBase] åˆå§‹åŒ–å¤±è´¥ï¼ŒåŸ‹ç‚¹å°†ä»…æ‰“å°åˆ°æ§åˆ¶å°', e);
  }
})();

/* è°ƒè¯•ç”¨ï¼šURLå¸¦ ?reset=1 æ—¶è‡ªåŠ¨æ¸…é™¤æ‰€æœ‰æœ¬åœ°ç¼“å­˜ï¼ˆæ¨¡æ‹Ÿæ–°ç”¨æˆ·ï¼‰ */
if (new URLSearchParams(window.location.search).get('reset') === '1') {
  localStorage.clear();
  window.history.replaceState({}, '', window.location.pathname);
  console.log('[Debug] localStorage å·²æ¸…é™¤ï¼Œæ¨¡æ‹Ÿæ–°ç”¨æˆ·');
}

/* ==========================================
 * å…¨å±€çŠ¶æ€
 * ========================================== */
let idx = -1;                                       // å½“å‰é¢˜ç›®ç´¢å¼•ï¼ˆ-1=æœªå¼€å§‹ï¼‰
let score = {E:0,I:0,S:0,N:0,T:0,F:0,J:0,P:0};   // ç»´åº¦åˆ†æ•°
let finalType = "";                                  // è®¡ç®—å‡ºçš„ MBTI ç±»å‹
let isTransitioning = false;                         // é˜²æ­¢åˆ‡é¢˜åŠ¨ç”»æœŸé—´é‡å¤ç‚¹å‡»
let hasShownWecomModal = false;                      // ç¡®ä¿ä¼å¾®å¼¹çª—åªå¼¹ä¸€æ¬¡
let avatarUploaded = false;                           // æœ¬æ¬¡ä¼šè¯æ˜¯å¦å·²ä¸Šä¼ å¤´åƒ
const AVATAR_KEY = "cat_mbti_avatar";
const DEFAULT_AVATAR = "touxiang.png.jpg";
const UNLOCK_KEY = "cat_mbti_unlocked";              // è§£é”çŠ¶æ€å­˜å‚¨é”®
let unlockCountdownTimer = null;                     // å€’è®¡æ—¶å®šæ—¶å™¨

// 16ç§ç±»å‹ä¸“å±ä¸»é¢˜è‰²ï¼ˆè½»é‡ç‚¹ç¼€ï¼šç±»å‹å¤§å­—+å¤´åƒè¾¹æ¡†ï¼‰
const typeColors = {
  ENFP:'#FF8C42', ENFJ:'#FF6B8A', ENTP:'#5CB8FF', ENTJ:'#C94040',
  ESFP:'#FFB627', ESFJ:'#FF7EB3', ESTP:'#FF6542', ESTJ:'#4A7C59',
  INFP:'#B088F9', INFJ:'#6C8EBF', INTP:'#5B9A8B', INTJ:'#4A5568',
  ISFP:'#E88DB4', ISFJ:'#F4A460', ISTP:'#708090', ISTJ:'#8B7355',
};

// 20é¢˜ï¼šæ¯ä¸ªç»´åº¦5é¢˜ï¼ˆçŒ«å’ªå‘ï¼‰â€” çŒ«å’ªä¸“å±åœºæ™¯+é«˜å…±æƒ…

// ç»´åº¦ï¼šE/I, S/N, T/F, J/P
const questions = [
  // === E/Iï¼ˆç¤¾äº¤èƒ½é‡ï¼‰===
  { id:"E1", dim:"EI", q:"å®¶é‡Œæ¥äº†é™Œç”Ÿå®¢äººï¼ŒTAé€šå¸¸ï¼š", A:"å¤§æ‘‡å¤§æ‘†èµ°å‡ºæ¥å·¡è§†ä¸€åœˆï¼Œç”šè‡³è·³åˆ°å®¢äººè…¿ä¸Šã€Œæ¥å¾…ã€", B:"å—–ä¸€ä¸‹é’»è¿›åºŠåº•/æŸœé¡¶ï¼Œå®¢äººèµ°äº†æ‰æ…¢æ…¢æ¢å¤´", scoreA:{E:1}, scoreB:{I:1}},
  { id:"E2", dim:"EI", q:"ä½ åŒæ—¶æ’¸TAå’Œå¦ä¸€åªçŒ«ï¼ˆæˆ–ç»™åˆ«çš„å® ç‰©æ³¨æ„åŠ›ï¼‰ï¼ŒTAï¼š", A:"æŒ¤è¿‡æ¥è¹­ä½ çš„æ‰‹ï¼Œã€Œæˆ‘ä¹Ÿè¦ï¼æˆ‘å…ˆï¼ã€", B:"é»˜é»˜èµ°å¼€ï¼Œæ‰¾ä¸ªè§’è½è‡ªå·±å¾…ç€ï¼Œå›å¤´å·å·çœ‹ä½ ä¸€çœ¼", scoreA:{E:1}, scoreB:{I:1}},
  { id:"E3", dim:"EI", q:"ä½ å‡ºé—¨å›æ¥æ¨å¼€é—¨çš„é‚£ä¸€åˆ»ï¼ŒTAï¼š", A:"å·²ç»è¹²åœ¨é—¨å£ç­‰äº†ï¼Œå–µå–µå«ç€ç»•ä½ è„šè¾¹è½¬åœˆ", B:"ä»æŸä¸ªè§’è½æŠ¬å¤´çœ‹ä½ ä¸€çœ¼ï¼Œç„¶åç»§ç»­è¶´ç€â€”â€”ã€Œå“¦ï¼Œä½ å›æ¥äº†ã€", scoreA:{E:1}, scoreB:{I:1}},
  { id:"E4", dim:"EI", q:"å®¶é‡Œæ¥äº†æ–°çš„çŒ«/ç‹—ï¼ˆæˆ–ä½ å¸¦TAå»æœ‹å‹å®¶ï¼‰ï¼ŒTAæ›´åƒï¼š", A:"ä¸»åŠ¨èµ°è¿‡å»é—»é—»å¯¹æ–¹ï¼Œè¯•å›¾ç¤¾äº¤", B:"ç‚¸æ¯›/èº²è¿œï¼Œéœ€è¦å¥½å‡ å¤©æ‰æ…¢æ…¢æ¥å—", scoreA:{E:1}, scoreB:{I:1}},
  { id:"E5", dim:"EI", q:"å¹³æ—¶åœ¨å®¶ï¼ŒTAæ›´å¤šæ—¶å€™ï¼š", A:"è·Ÿç€ä½ ä»å®¢å…åˆ°å¨æˆ¿åˆ°å§å®¤ï¼Œä½ åœ¨å“ªå®ƒåœ¨å“ª", B:"æœ‰è‡ªå·±å›ºå®šçš„ã€Œé¢†åœ°ã€ï¼Œä½ æ¥æ‰¾å®ƒå¯ä»¥ï¼Œå®ƒä¸ä¸»åŠ¨æ‰¾ä½ ", scoreA:{E:1}, scoreB:{I:1}},
  // === S/Nï¼ˆæ„ŸçŸ¥æ–¹å¼ï¼‰===
  { id:"S1", dim:"SN", q:"ä½ ä¹°äº†ä¸€ä¸ªæ–°çº¸ç®±æ”¾åœ¨åœ°ä¸Šï¼ŒTAï¼š", A:"å…ˆç»•ç€é—»ä¸€åœˆï¼Œå°å¿ƒç¿¼ç¿¼ä¼¸çˆªè¯•æ¢ï¼Œç¡®è®¤å®‰å…¨æ‰é’»è¿›å»", B:"çœ‹äº†ä¸€ç§’ç›´æ¥è·³è¿›å»ï¼Œç®¡å®ƒæ˜¯ä»€ä¹ˆå…ˆå äº†å†è¯´", scoreA:{S:1}, scoreB:{N:1}},
  { id:"S2", dim:"SN", q:"ä½ æ‹¿é€—çŒ«æ£’é€—TAç©ï¼ŒTAæ›´åƒï¼š", A:"çœ¼ç›ç´§ç›¯çŒç‰©ï¼Œç²¾å‡†è®¡ç®—è·ç¦»ï¼Œä¸€æ‰‘ä¸€ä¸ªå‡†", B:"è·³èµ·æ¥æ‰‘ç©ºäº†ä¹Ÿä¸åœ¨æ„ï¼Œä¸­é€”çªç„¶å»è¿½è‡ªå·±å°¾å·´", scoreA:{S:1}, scoreB:{N:1}},
  { id:"S3", dim:"SN", q:"ä½ æŠŠTAçš„çŒ«ç ‚ç›†/é¥­ç¢—æ¢äº†ä¸ªä½ç½®ï¼ŒTAï¼š", A:"ç«™åœ¨åŸæ¥çš„ä½ç½®ä¸€è„¸å›°æƒ‘ï¼Œç»•äº†å¥½å‡ åœˆæ‰æ‰¾åˆ°", B:"éšä¾¿å—…ä¸¤ä¸‹å°±æ‰¾åˆ°äº†ï¼Œé€‚åº”å¾—å¾ˆå¿«", scoreA:{S:1}, scoreB:{N:1}},
  { id:"S4", dim:"SN", q:"çª—å¤–é£è¿‡ä¸€åªé¸Ÿ/é£è™«ï¼ŒTAï¼š", A:"ç›¯ç€ç›®æ ‡ä¸€åŠ¨ä¸åŠ¨ï¼Œå˜´å·´å‘å‡ºã€Œå’”å’”å’”ã€çš„å£°éŸ³ï¼Œå…¨ç¥è´¯æ³¨", B:"çœ‹äº†ä¸¤çœ¼å°±æ²¡å…´è¶£äº†ï¼Œé™¤éé‚£ä¸œè¥¿çš„é£è¡Œè½¨è¿¹ç‰¹åˆ«å¥‡æ€ª", scoreA:{S:1}, scoreB:{N:1}},
  { id:"S5", dim:"SN", q:"ä½ åœ¨TAé¢å‰å±•ç¤ºä¸€ä¸ªæ–°ç©å…·/æ–°ç‰©ä»¶ï¼ŒTAæ›´åƒï¼š", A:"å…ˆé—»ã€å†æ‹ã€å†å’¬ï¼ŒæŒ‰éƒ¨å°±ç­åœ°ç ”ç©¶", B:"ç›´æ¥ä¸€æŒæ‹é£ï¼Œæˆ–è€…å¯¹ç€ç©ºæ°”å‘èµ·è¿›æ”»â€”â€”è‡ªå·±è„‘è¡¥äº†ä¸€åœºæˆ˜äº‰", scoreA:{S:1}, scoreB:{N:1}},
  // === T/Fï¼ˆå†³ç­–åå¥½ï¼‰===
  { id:"T1", dim:"TF", q:"ä½ ä¸¥å‰åœ°å¯¹TAè¯´ã€Œä¸è¡Œï¼ã€ï¼ˆæ¯”å¦‚å®ƒè·³ä¸Šé¤æ¡Œï¼‰ï¼ŒTAï¼š", A:"çœ‹ä½ ä¸€çœ¼ï¼Œè·³ä¸‹å»äº†â€”â€”ä½†ç­‰ä½ è½¬èº«ï¼Œå®ƒåˆè·³ä¸Šæ¥äº†", B:"è€³æœµå¾€åå‹ï¼Œå§”å±ˆåœ°ç„ä½ ä¸€çœ¼ï¼Œæ…¢æ…¢èµ°å¼€", scoreA:{T:1}, scoreB:{F:1}},
  { id:"T2", dim:"TF", q:"è¦è®©TAé…åˆåšä¸å–œæ¬¢çš„äº‹ï¼ˆæ¯”å¦‚å‰ªæŒ‡ç”²/åƒè¯ï¼‰ï¼Œæ›´ç®¡ç”¨çš„æ˜¯ï¼š", A:"å¿«å‡†ç‹ +äº‹åç»™é›¶é£Ÿï¼ŒTAè®¤ç»“æœ", B:"å…ˆæŠ±ç€å“„åŠå¤©+æ¸©æŸ”è¯´è¯ï¼ŒTAåƒæ°›å›´", scoreA:{T:1}, scoreB:{F:1}},
  { id:"T3", dim:"TF", q:"ä½ å¿ƒæƒ…å¾ˆä½è½ï¼Œçªåœ¨æ²™å‘ä¸Šä¸åŠ¨ï¼ŒTAï¼š", A:"è¯¥åƒåƒè¯¥ç¡ç¡ï¼Œå¶å°”è·¯è¿‡çœ‹ä½ ä¸€çœ¼â€”â€”ã€Œä½ è‡ªå·±ä¼šå¥½çš„ã€", B:"è·³ä¸Šæ²™å‘é ç€ä½ åä¸‹ï¼Œç”¨å¤´è¹­è¹­ä½ çš„æ‰‹â€”â€”è™½ç„¶å¹³æ—¶ä¸è¿™æ ·", scoreA:{T:1}, scoreB:{F:1}},
  { id:"T4", dim:"TF", q:"å®¶é‡Œå¦ä¸€åªçŒ«/å® ç‰©æŠ¢äº†TAçš„çª/ç©å…·ï¼ŒTAæ›´å¯èƒ½ï¼š", A:"ä¸€å·´æŒå‘¼è¿‡å»æˆ–è€…å¼ºåŠ¿å¤ºå›â€”â€”ã€Œæˆ‘çš„åœ°ç›˜æˆ‘åšä¸»ã€", B:"å§”å±ˆåœ°çœ‹çœ‹ä½ ï¼Œå–µäº†ä¸€å£°ï¼Œå¥½åƒåœ¨è¯´ã€Œä½ ç®¡ç®¡å•Šã€", scoreA:{T:1}, scoreB:{F:1}},
  { id:"T5", dim:"TF", q:"TAæ‰“ç¢äº†ä½ çš„æ¯å­/èŠ±ç“¶è¢«ä½ å½“åœºæŠ“ä½ï¼ŒTAæ›´åƒï¼š", A:"é¢ä¸æ”¹è‰²ç»§ç»­èˆ”çˆªå­ï¼Œä¸€å‰¯ã€Œå—¯æ˜¯æˆ‘å¹²çš„ï¼Œæ€ä¹ˆäº†ã€", B:"ç¼©èµ·èº«å­ï¼Œè€³æœµå‹å¹³ï¼Œç”¨å¤§çœ¼ç›å¯æ€œå·´å·´åœ°çœ‹ç€ä½ ", scoreA:{T:1}, scoreB:{F:1}},
  // === J/Pï¼ˆç”Ÿæ´»æ–¹å¼ï¼‰===
  { id:"J1", dim:"JP", q:"æ¯å¤©æ—©ä¸Šï¼ŒTAï¼š", A:"æ¯”é—¹é’Ÿè¿˜å‡†â€”â€”åˆ°ç‚¹å°±è·³ä¸ŠåºŠ/è¹²åœ¨é¥­ç¢—å‰å‚¬ä½ èµ·åºŠ", B:"æœ‰æ—¶å››ç‚¹å°±é—¹ï¼Œæœ‰æ—¶ç¡åˆ°ä¸­åˆï¼Œå®Œå…¨çœ‹å¿ƒæƒ…", scoreA:{J:1}, scoreB:{P:1}},
  { id:"J2", dim:"JP", q:"TAç¡è§‰çš„ä½ç½®ï¼š", A:"åŸºæœ¬å›ºå®šåœ¨é‚£ä¸€ä¸¤ä¸ªåœ°æ–¹ï¼Œæ¢äº†å°±ä¸å¤ªè‡ªåœ¨", B:"ä»Šå¤©åºŠä¸Šï¼Œæ˜å¤©çº¸ç®±ï¼Œåå¤©æ´—è¡£æœºä¸Šé¢â€”â€”éšç¼˜", scoreA:{J:1}, scoreB:{P:1}},
  { id:"J3", dim:"JP", q:"TAçš„ã€Œå‘ç–¯æ—¶åˆ»ã€ï¼ˆçŒ«å’ªè·‘é…·ï¼‰ï¼š", A:"åŸºæœ¬å¯ä»¥é¢„æµ‹ï¼Œæ¯å¤©å·®ä¸å¤šé‚£ä¸ªæ—¶é—´æ®µå¼€å§‹", B:"å®Œå…¨éšæœºâ€”â€”å¯èƒ½å‡Œæ™¨ä¸‰ç‚¹ï¼Œä¹Ÿå¯èƒ½åˆé¥­åï¼Œæ¯«æ— è§„å¾‹", scoreA:{J:1}, scoreB:{P:1}},
  { id:"J4", dim:"JP", q:"ä½ æ”¹å˜äº†TAçš„å–‚é£Ÿæ—¶é—´æˆ–è€…æ¢äº†çŒ«ç²®å“ç‰Œï¼ŒTAï¼š", A:"æ˜æ˜¾ä¸é€‚åº”ï¼Œæ‹’ç»è¿›é£Ÿæˆ–è€…åå¤é—»äº†åˆèµ°å¼€", B:"æ— æ‰€è°“ï¼Œæœ‰å¾—åƒå°±è¡Œï¼Œé€‚åº”å¾—å¾ˆå¿«", scoreA:{J:1}, scoreB:{P:1}},
  { id:"J5", dim:"JP", q:"ç©é€—çŒ«æ£’/è¿½é€æ¸¸æˆæ—¶ï¼ŒTAçš„é£æ ¼ï¼š", A:"æœ‰ç« æ³•ï¼šè¹²ä¼â†’ç„å‡†â†’èµ·è·³ï¼Œæ¯æ¬¡å¥—è·¯å·®ä¸å¤š", B:"æ¯«æ— ç« æ³•ï¼šè¿½ä¸¤ä¸‹çªç„¶åœä½èˆ”æ¯›ï¼Œä¸‹ä¸€ç§’åˆç–¯äº†", scoreA:{J:1}, scoreB:{P:1}}
];

// 16å‹ç»“æœåº“ï¼ˆä¸­æ–‡å+é‡‘å¥+å»ºè®®+æ ‡ç­¾ï¼‰â€”â€”çŒ«å’ªç‰ˆ
const results = {
  "ENFP": { name:"å¥½å¥‡å¿ƒç‚¸å¼¹", rarity:8, line:"ä¸–ç•Œè¿™ä¹ˆå¤§ï¼Œæ¯ä¸ªè§’è½éƒ½è¦äº²è‡ªæ£€æŸ¥ä¸€éâ€”â€”ç­‰ä¸‹é‚£æ˜¯ä»€ä¹ˆï¼Ÿï¼", tags:["ç¤¾äº¤è¾¾äºº","å¥½å¥‡å¿ƒçˆ†æ£š","ä¸€ç§’å…¥æˆ"],
    monologue:"æˆ‘çŸ¥é“ä½ å«Œæˆ‘ä¸€å¤©åˆ°æ™šä¸Šè¹¿ä¸‹è·³ï¼Œä½†ä½ ä¸æ‡‚â€”â€”æˆ‘æ˜¯åœ¨å·¡è§†æˆ‘çš„ç‹å›½ï¼å¯¹äº†ï¼Œé‚£ä¸ªå¡‘æ–™è¢‹åˆšæ‰æ˜¯ä¸æ˜¯åŠ¨äº†ä¸€ä¸‹ï¼Ÿç­‰æˆ‘å»çœ‹çœ‹ã€‚ä½ åˆ«èµ°ï¼Œæˆ‘é©¬ä¸Šå›æ¥â€¦â€¦å¤§æ¦‚å§ã€‚",
    tips:["æ¯å¤©ä¿è¯ä¸¤æ¬¡é«˜è´¨é‡äº’åŠ¨ï¼ˆé€—çŒ«æ£’+è—é£Ÿæ¸¸æˆï¼‰","å®šæœŸæ¢æ–°ç©å…·ä¿æŒæ–°é²œæ„Ÿï¼Œä¸ç„¶å®ƒä¼šå»å¼€å‘ä½ çš„çº¸å·¾ç›’","é«˜å¤„ç©ºé—´ä¸€å®šè¦æœ‰ï¼Œå®ƒéœ€è¦ç™»é«˜æœ›è¿œ"],
    bubbles:["çƒ­æƒ…","å¥½å¥‡","æ´»åŠ›","è·³è„±","ä¹è§‚","ç¤¾ç‰›","è‡ªç”±"],
    profile:{
      traits:["å¤©ç”Ÿç¤¾ç‰›ï¼Œå¯¹æ‰€æœ‰æ–°é²œäº‹ç‰©å……æ»¡çƒ­æƒ…","ç²¾åŠ›æ—ºç››åˆ°è®©ä½ æ€€ç–‘å®ƒå……äº†ç”µ","æƒ…ç»ªå…¨å†™åœ¨å°¾å·´ä¸Šâ€”â€”ç«–èµ·æ¥å°±æ˜¯å—¨ï¼Œç‚¸èµ·æ¥å°±æ˜¯å…´å¥‹è¿‡å¤´"],
      behaviors:["å®¶é‡Œä»»ä½•æ–°ä¸œè¥¿éƒ½è¦ç¬¬ä¸€æ—¶é—´æ‰‘ä¸Šå»æ£€æŸ¥","ç©å…·ç©ä¸¤åˆ†é’Ÿå°±ä¸¢ï¼Œè½¬å¤´å»ç ”ç©¶çª—å¸˜ç»³","å¿«é€’åˆšæ‹†å¼€çº¸ç®±ï¼Œå®ƒå·²ç»ååœ¨é‡Œé¢äº†"],
      innerVsOuter:{inner:["é‚£ä¸ªå¡‘æ–™è¢‹åŠ¨äº†ï¼ä¸€å®šæ˜¯çŒç‰©ï¼å†²å•Šï¼","æ–°æ¥çš„å®¢äººï¼è®©æˆ‘å±•ç¤ºä¸€ä¸‹æˆ‘çš„é­…åŠ›ï¼","å¥½ç´¯â€¦ä½†é‚£è¾¹å¥½åƒåˆæœ‰åŠ¨é™ï¼Ÿ"],outer:["ä¸€å¤´æ‰è¿›å¡‘æ–™è¢‹é‡Œå‡ºä¸æ¥äº†","è·³åˆ°å®¢äººè‚©ä¸ŠæŠŠäººå“ä¸€è·³","æ‰“ç€å“ˆæ¬ è¿˜åœ¨è¿½é€—çŒ«æ£’"]}
    },
    guide:{
      relationship:["æ¯å¤©ç»™å®ƒ'æ¢ç´¢æ—¶é—´'ï¼Œè®©å®ƒé—»æ–°ä¸œè¥¿ã€çœ‹æ–°è§†é¢‘ï¼›å¥½å¥‡å¿ƒè¢«æ»¡è¶³äº†å°±ä¸æç ´å","ç»™äºˆæ­£é¢åé¦ˆï¼Œå®ƒé è®¤å¯é©±åŠ¨"],
      feeding:["å°‘é‡å¤šé¤ï¼Œé…åˆæ¼é£Ÿçƒå¢åŠ è¿›é£Ÿè¶£å‘³ï¼›ç›´æ¥æ”¾é¥­ç¢—å¤ªæ— èŠ","æ³¨æ„ä½“é‡ç®¡ç†ï¼Œå…´å¥‹çŠ¶æ€ä¸‹åˆ«å–‚é›¶é£Ÿ"],
      toys:["é€—çŒ«æ£’ã€å¼¹åŠ›çƒã€çº¸è¢‹çº¸ç®±æ˜¯æ ‡é…ï¼›ä¸‰å¤©æ¢ä¸€æ‰¹æ‰å¤Ÿ","ç›Šæ™ºç±»ç©å…·è½®æ¢ä½¿ç”¨ä¿æŒæ–°é²œæ„Ÿ","è—é£Ÿæ¸¸æˆæ¶ˆè€—è„‘åŠ›"],
      emotion:["å®ƒçš„'ç–¯è·‘'ä¸æ˜¯å‘ç–¯ï¼Œæ˜¯åœ¨é‡Šæ”¾èƒ½é‡","å†·è½å®ƒä¼šè®©å®ƒæ‰¾åˆ«çš„ç›®æ ‡ï¼ˆæ¯”å¦‚ä½ çš„æ²™å‘ï¼‰"]
    }},
  "ENFJ": { name:"æ¸©æŸ”ç®¡å®¶å–µ", rarity:5, line:"ä½ è¿˜æ²¡å›æ¥ï¼Œæˆ‘å°±å·²ç»åœ¨é—¨å£ç­‰äº†â€”â€”å› ä¸ºæˆ‘çŸ¥é“ä½ ä»Šå¤©å¾ˆç´¯ã€‚", tags:["æƒ…ç»ªæ„ŸçŸ¥","æ²»æ„ˆç³»","æ“å¿ƒå‘½"],
    monologue:"ä½ ä»¥ä¸ºæˆ‘è¹­ä½ æ˜¯åœ¨æ’’å¨‡ï¼Œå…¶å®æˆ‘åœ¨ç¡®è®¤ä½ å¼€ä¸å¼€å¿ƒã€‚ä½ å¹äº†å£æ°”ï¼Œæˆ‘å¬åˆ°äº†ã€‚ä½ æŠŠè„¸åŸ‹è¿›æ‰‹é‡Œï¼Œæˆ‘ä¹Ÿçœ‹åˆ°äº†ã€‚æˆ‘ä¸ä¼šè¯´è¯ï¼Œä½†æˆ‘å¯ä»¥ååœ¨ä½ æ—è¾¹ï¼Œç”¨ä½“æ¸©å‘Šè¯‰ä½ ï¼šæˆ‘åœ¨ã€‚",
    tips:["å¤šç”¨è¯­è¨€å’ŒæŠšæ‘¸ç»™äºˆå›åº”ï¼Œå®ƒéœ€è¦'è¢«è®¤å¯'","å®¶é‡Œæœ‰äº‰åµæ—¶æ³¨æ„å®‰æŠšå®ƒï¼Œå®ƒä¼šå†…åŒ–è´Ÿé¢æƒ…ç»ª","ç¤¾äº¤å®‰æ’ä»¥ç†Ÿæ‚‰çš„äººä¸ºä¸»ï¼Œå®ƒä¸å–œæ¬¢å¤ªæ··ä¹±çš„åœºé¢"],
    bubbles:["å…±æƒ…","æ¸©æš–","å¿ è¯š","ä½“è´´","æ•é”","å®ˆæŠ¤"],
    profile:{
      traits:["å¤©ç”Ÿçš„æƒ…ç»ªæ¢æµ‹å™¨ï¼Œä½ éš¾è¿‡å®ƒä¸€å®šçŸ¥é“","å–œæ¬¢åœ¨å®¶é‡Œ'å·¡é€»'ï¼Œç¡®è®¤æ¯ä¸ªè§’è½éƒ½å®‰å…¨","å¯¹å®¶é‡Œæ‰€æœ‰æˆå‘˜ä¸€è§†åŒä»åœ°å…³å¿ƒ"],
      behaviors:["ä½ å“­çš„æ—¶å€™å®ƒä¼šè·³åˆ°ä½ è…¿ä¸Šè¹­ä½ ","å®¶é‡Œæœ‰äººå…³é—¨å£°å¤§äº†å®ƒä¼šç´§å¼ åœ°è¿‡æ¥çœ‹çœ‹","æ¯å¤©æ—©ä¸Šä¾æ¬¡å»æ¯ä¸ªæˆ¿é—´'æŸ¥å²—'"],
      innerVsOuter:{inner:["ä½ å¹æ°”äº†â€¦ä½ æ˜¯ä¸æ˜¯ä¸å¼€å¿ƒï¼Ÿæˆ‘è¿‡å»é™ªä½ ","é‚£ä¸ªäººå…³é—¨å¥½å¤§å£°â€¦æ˜¯ä¸æ˜¯å‡ºäº‹äº†ï¼Ÿ","ä½ ä»Šå¤©å¤¸æˆ‘äº†ï¼æˆ‘å¯ä»¥å¼€å¿ƒä¸€æ•´å¤©ï¼"],outer:["é»˜é»˜è·³ä¸Šæ²™å‘é ç€ä½ åä¸‹","è·‘å»é—¨å£æ¢å¤´æ¢è„‘åœ°ç¡®è®¤","å’•å™œå£°å¤§åˆ°æ•´æ¡è¡—éƒ½å¬å¾—è§"]}
    },
    guide:{
      relationship:["å¤šè·Ÿå®ƒè¯´è¯ï¼Œå®ƒå¬å¾—æ‡‚ä½ çš„è¯­æ°”ï¼›ç»™å®ƒä¸€ä¸ª'é™ªä¼´å²—ä½'ï¼ˆæ¯”å¦‚å›ºå®šåä½ æ—è¾¹çš„ä½ç½®ï¼‰","å¤šå¤¸å¥–å¤šæŠšæ‘¸ï¼Œå®ƒéœ€è¦æŒç»­çš„æ­£é¢åé¦ˆ"],
      feeding:["å®šæ—¶å®šé‡ï¼Œå®ƒå–œæ¬¢æœ‰è§„å¾‹çš„ç”Ÿæ´»ï¼›åƒé¥­æ—¶å¯ä»¥è½»å£°è·Ÿå®ƒè¯´è¯","å¯ä»¥ç”¨å–‚é£Ÿæ—¶é—´åšç®€å•äº’åŠ¨"],
      toys:["å–œæ¬¢å’Œä½ ä¸€èµ·ç©çš„äº’åŠ¨ç©å…·ï¼›ç‹¬è‡ªç©çš„å…´è¶£ä¸å¤§","é€‚åˆæŸ”è½¯çš„é™ªä¼´å‹ç©å¶"],
      emotion:["é¿å…åœ¨å®ƒé¢å‰æ¿€çƒˆäº‰åµï¼›åˆ†ç¦»æ—¶é—´ä¸å®œå¤ªé•¿ï¼Œå®ƒä¼šç„¦è™‘","ç»™å®ƒç¨³å®šçš„æ—¥å¸¸èŠ‚å¥å°±æ˜¯æœ€å¥½çš„å®‰å…¨æ„Ÿ"]
    }},
  "ENTP": { name:"æŸœé¡¶æ‹†è¿åŠ", rarity:6, line:"ä½ è¯´æ¡Œä¸Šçš„æ¯å­ä¸èƒ½ç¢°ï¼Ÿé‚£æˆ‘è¯•è¯•æ¨åˆ°ä»€ä¹ˆç¨‹åº¦ä½ æ‰ä¼šæ¥ç®¡ã€‚", tags:["é«˜æ™ºå•†","çˆ±æäº‹","è¯•æ¢è¾¹ç•Œ"],
    monologue:"ä½ è¯´æˆ‘åœ¨æç ´åï¼Ÿä¸ä¸ä¸ï¼Œæˆ‘åœ¨åšå®éªŒã€‚æ¯”å¦‚è¿™ä¸ªæ¯å­ï¼Œæˆ‘å·²ç»éªŒè¯äº†â€”â€”æ¨åˆ°æ¡Œå­è¾¹ç¼˜2å˜ç±³ä½ å°±ä¼šå¤§å«ã€‚è¿™æ˜¯éå¸¸æœ‰ä»·å€¼çš„ç§‘å­¦æ•°æ®ã€‚",
    tips:["å¿…é¡»ç»™è¶³å¤Ÿçš„è„‘åŠ›æŒ‘æˆ˜ï¼šç›Šæ™ºå–‚é£Ÿå™¨ã€è—é£Ÿæ¸¸æˆ","å®¶é‡Œæ˜“ç¢å“æ”¶å¥½ï¼Œä¸æ˜¯å®ƒåï¼Œæ˜¯å®ƒå¤ªèªæ˜","è®­ç»ƒä¸èƒ½å¤ªé‡å¤ï¼Œå˜ç€èŠ±æ ·æ¥å®ƒæ‰é…åˆ"],
    bubbles:["èªæ˜","è°ƒçš®","æ¢ç´¢","æœºçµ","æŒ‘æˆ˜","åˆ›é€ ","å¤§èƒ†"],
    profile:{
      traits:["æ™ºå•†åœ¨çº¿ï¼Œå­¦å¼€é—¨ã€å¼€æŠ½å±‰éƒ½æ˜¯åŸºæœ¬æ“ä½œ","å¥½å¥‡å¿ƒçˆ†æ£šï¼Œä»€ä¹ˆéƒ½è¦äº²è‡ªéªŒè¯ä¸€ä¸‹","æ— èŠæ˜¯å®ƒæç ´åçš„å”¯ä¸€åŸå› "],
      behaviors:["æŠŠæ¡Œä¸Šçš„ä¸œè¥¿ä¸€æ ·ä¸€æ ·æ¨ä¸‹å»ï¼Œæ¨å®Œçœ‹ä½ çš„ååº”","è‡ªå·±å­¦ä¼šäº†å¼€æŸœé—¨ï¼Œä»æ­¤ä½ å®¶æ²¡æœ‰ç§˜å¯†","è®­ç»ƒæ—¶å®ƒé…åˆå¾—å¾ˆå¥½â€”â€”ä½†åªåšä¸‰éï¼Œç¬¬å››éå®ƒå°±å¼€å§‹è‡ªç”±å‘æŒ¥"],
      innerVsOuter:{inner:["è¿™ä¸ªæ¯å­å¦‚æœä»è¿™ä¸ªè§’åº¦æ¨ä¼šæ€æ ·ï¼Ÿ","ä½ è¯´ä¸è¡Œï¼Ÿé‚£æ¢ä¸ªæ–¹å¼è¯•è¯•","æ–°ç©å…·ï¼Ÿæˆ‘èµŒæˆ‘äº”åˆ†é’Ÿèƒ½ç ´è§£"],outer:["ä¼˜é›…åœ°ä¸€çˆªæŠŠæ¯å­æ¨ä¸‹æ¡Œ","è¢«èµ¶ä¸‹æ¡Œåä»å¦ä¸€è¾¹è·³ä¸Šæ¥","å¼ç€ä»ç›Šæ™ºç©å…·é‡ŒæŠ å‡ºæ¥çš„é›¶é£Ÿç‚«è€€"]}
    },
    guide:{
      relationship:["ç»™å®ƒè¶³å¤Ÿçš„è„‘åŠ›æŒ‘æˆ˜ï¼Œæ— èŠæ˜¯ä¸€åˆ‡é—®é¢˜çš„æ ¹æº","è·Ÿå®ƒç©è¦æœ‰ç­–ç•¥ï¼Œåˆ«å¤ªå®¹æ˜“è®©å®ƒèµ¢"],
      feeding:["ç”¨æ¼é£Ÿçƒã€è—é£Ÿæ‹¼å›¾å¢åŠ è¿›é£Ÿéš¾åº¦","ç›´æ¥æ”¾ç¢—é‡Œå¤ªæ²¡æŒ‘æˆ˜äº†"],
      toys:["ç›Šæ™ºç©å…·è¶Šéš¾è¶Šå¥½","å®šæœŸæ›´æ¢ï¼Œå®ƒç ´è§£é€Ÿåº¦æ¯”ä½ ä¹°æ–°çš„å¿«","éœ€è¦æŒç»­å‡çº§éš¾åº¦"],
      emotion:["å®ƒæ¨ä¸œè¥¿ä¸æ˜¯åœ¨æŠ¥å¤ä½ ï¼Œæ˜¯åœ¨'åšå®éªŒ'","ç»™å¤Ÿåˆºæ¿€ï¼Œé—®é¢˜è¡Œä¸ºè‡ªç„¶æ¶ˆå¤±"]
    }},
  "ENTJ": { name:"éœ¸é“æ€»è£å–µ", rarity:4, line:"è¿™ä¸ªå®¶ï¼Ÿè°è¯´äº†ç®—ï¼Ÿä½ çœ‹çœ‹å‡Œæ™¨äº”ç‚¹è°å«è°èµ·åºŠå°±çŸ¥é“äº†ã€‚", tags:["å¼ºåŠ¿","æŒæ§","é¢†åœ°æ„è¯†"],
    monologue:"æˆ‘ä¸æ˜¯éœ¸é“ï¼Œæˆ‘åªæ˜¯æ¯”ä½ æ›´æ‡‚è¿™ä¸ªå®¶è¯¥æ€ä¹ˆè¿è½¬ã€‚æ¯å¤©äº”ç‚¹åŠå«ä½ èµ·åºŠæ˜¯ä¸ºä½ å¥½ï¼Œä¸ƒç‚¹åƒæ—©é¥­æ˜¯ç§‘å­¦ä½œæ¯ã€‚ä½ åº”è¯¥æ„Ÿè°¢æˆ‘æ‰å¯¹ã€‚",
    tips:["å°Šé‡å®ƒçš„é¢†åœ°æ„è¯†ï¼Œåˆ«éšæ„æ”¹å˜å®¶é‡Œå¸ƒå±€","å¤šçŒ«å®¶åº­æ³¨æ„èµ„æºåˆ†é…ï¼ˆé£Ÿç›†ã€çŒ«ç ‚ç›†è¦å¤Ÿï¼‰","ç»™å®ƒ'ç®¡ç†æƒ'â€”â€”æ¯”å¦‚å›ºå®šçš„å·¡é€»è·¯çº¿å’Œé«˜å¤„è§‚å¯Ÿç‚¹"],
    bubbles:["è‡ªä¿¡","æœæ–­","é¢†å¯¼","å¼ºåŠ¿","å¿ è¯š","æŒæ§"],
    profile:{
      traits:["å¤©ç”Ÿçš„é¢†å¯¼è€…ï¼Œå¤šçŒ«å®¶åº­é‡Œç»å¯¹çš„è€å¤§","å¯¹é¢†åœ°æœ‰å¾ˆå¼ºçš„æŒæ§æ¬²ï¼Œæ¯å¤©ä¾‹è¡Œå·¡é€»","ç›®æ ‡æ„Ÿæå¼ºï¼Œæƒ³è¦çš„ä¸œè¥¿ä¸€å®šä¼šå¾—åˆ°"],
      behaviors:["å‡Œæ™¨å‡†æ—¶è·³åˆ°ä½ è„¸ä¸Šå«ä½ èµ·åºŠï¼Œåˆ†ç§’ä¸å·®","å æ®å®¶é‡Œæœ€é«˜çš„ä½ç½®ä¿¯ç°ä¸€åˆ‡","æ–°æ¥çš„çŒ«/äººå¿…é¡»ç»è¿‡å®ƒçš„'å®¡æ ¸'"],
      innerVsOuter:{inner:["äº”ç‚¹åŠäº†ï¼Œèµ·æ¥ã€‚è¿™æ˜¯è§„çŸ©ã€‚","è¿™ä¸ªæ–°æ¥çš„å¿…é¡»çŸ¥é“è°æ˜¯è€å¤§","å…¶å®â€¦æˆ‘å°±æ˜¯æƒ³è®©ä½ è§‰å¾—æˆ‘é å¾—ä½"],outer:["ååœ¨ä½ æ•å¤´ä¸Šç”¨çˆªå­æ‹ä½ çš„è„¸","å µåœ¨èµ°å»Šä¸­é—´ä¸è®©æ–°çŒ«è¿‡","æ¯å¤©å·¡é€»å®Œæ¯•å›åˆ°ä½ èº«è¾¹è¶´ä¸‹"]}
    },
    guide:{
      relationship:["ç»™å®ƒ'ç®¡ç†æƒ'â€”â€”çŒ«çˆ¬æ¶æœ€é«˜å±‚ã€å›ºå®šå·¡é€»è·¯çº¿","åˆ«è·Ÿå®ƒç¡¬åˆšï¼Œç”¨é£Ÿç‰©å¼•å¯¼"],
      feeding:["å›ºå®šæ—¶é—´å›ºå®šåœ°ç‚¹ï¼Œå®ƒå–œæ¬¢å¯é¢„æµ‹çš„ç§©åº","å¤šçŒ«å®¶åº­åˆ†å¼€å–‚"],
      toys:["éœ€è¦æœ‰'ç›®æ ‡'çš„æ¸¸æˆâ€”â€”æ•çŒæ¨¡æ‹Ÿã€è¿½é€èµ›","æ— ç›®çš„çš„é€—å¼„å®ƒä¸æ„Ÿå…´è¶£","ç­–ç•¥å‹äº’åŠ¨æœ€åˆé€‚"],
      emotion:["å°Šé‡å®ƒçš„é¢†åœ°æ„è¯†","æ¥æ–°çŒ«æ—¶ç»™è¶³éš”ç¦»é€‚åº”æœŸ"]
    }},
  "ESFP": { name:"æ°”æ°›å—¨ç‹å–µ", rarity:9, line:"æœ‰ä½ ã€æœ‰å°é±¼å¹²ã€æœ‰é€—çŒ«æ£’â€”â€”å–µç”Ÿå¦‚æ­¤ï¼Œå¤«å¤ä½•æ±‚ã€‚", tags:["å¤–å‘","çˆ±ç©","å¿«ä¹è‡³ä¸Š"],
    monologue:"ç”Ÿæ´»å°±åº”è¯¥æ˜¯å¼€å¿ƒçš„å•Šï¼ä½ å›æ¥äº†ï¼Œå¼€å¿ƒï¼æœ‰å°é±¼å¹²ï¼Œå¼€å¿ƒï¼é€—çŒ«æ£’åœ¨åŠ¨ï¼Œå¼€å¿ƒï¼ä½ çœ‹æˆ‘ç¿»äº†ä¸ªè‚šçš®â€”â€”ä½ ä¹Ÿå¼€å¿ƒäº†å¯¹ä¸å¯¹ï¼Ÿ",
    tips:["æ¯å¤©è‡³å°‘ä¸¤æ¬¡äº’åŠ¨æ¸¸æˆï¼Œå®ƒæ˜¯å¿«ä¹çš„æ°¸åŠ¨æœº","æ³¨æ„æ§åˆ¶ä½“é‡â€”â€”å®ƒå¤ªçˆ±åƒé›¶é£Ÿäº†","å…´å¥‹è¿‡å¤´æ—¶å¸®å®ƒ'åˆ¹è½¦'ï¼Œæ¯”å¦‚ç”¨é£Ÿç‰©å¼•å¯¼å®ƒå®‰é™ä¸‹æ¥"],
    bubbles:["å¿«ä¹","æ´»æ³¼","çƒ­é—¹","å‹å–„","å³å…´","äº«ä¹"],
    profile:{
      traits:["å¿«ä¹æ˜¯å®ƒçš„å‡ºå‚è®¾ç½®","å¯¹æ‰€æœ‰äººéƒ½å‹å–„ï¼Œæ²¡æœ‰æ”»å‡»æ€§","æ´»åœ¨å½“ä¸‹ï¼Œä»ä¸ä¸ºæ˜å¤©çš„çŒ«ç²®å‘æ„"],
      behaviors:["ä½ æ‹¿å‡ºé€—çŒ«æ£’çš„å£°éŸ³å®ƒåœ¨ä¸‰ä¸ªæˆ¿é—´å¤–éƒ½èƒ½å¬åˆ°","ç¿»è‚šçš®æ˜¯å®ƒçš„æ—¥å¸¸ï¼Œè°æ¥éƒ½ç¿»","ç©åˆ°å–˜ç²—æ°”ä¹Ÿä¸è‚¯åœ"],
      innerVsOuter:{inner:["é€—çŒ«æ£’ï¼é€—çŒ«æ£’ï¼æˆ‘çš„æœ€çˆ±ï¼","ä½ å¥½ä½ å¥½ä½ æ˜¯æ–°æœ‹å‹å—ï¼","å¥½ç´¯â€¦ä½†ä½ è¿˜åœ¨é™ªæˆ‘ç©â€¦å†æ¥ä¸€è½®ï¼"],outer:["ä»æŸœå­é¡¶ä¸Šé£èº«æ‰‘ä¸‹æ¥","å¯¹ç€ç¬¬ä¸€æ¬¡æ¥çš„å®¢äººç¿»è‚šçš®","å–˜ç€æ°”è¿˜åœ¨è¿½é€—çŒ«æ£’"]}
    },
    guide:{
      relationship:["ç”¨äº’åŠ¨æ¸¸æˆæ»¡è¶³å®ƒæ—ºç››çš„ç©è€æ¬²","æ¯å¤©ç»™'å®‰é™æ—¶é—´'è®©å®ƒå­¦ä¼šä¼‘æ¯"],
      feeding:["ä¸¥æ ¼æ§åˆ¶é›¶é£Ÿé‡ï¼Œå®ƒä¼šç”¨å–èŒè®©ä½ åŠ é¤","å®šæ—¶å®šé‡æ˜¯å…³é”®"],
      toys:["é€—çŒ«æ£’ã€å¼¹åŠ›çƒã€çº¸å›¢éƒ½æ˜¯å¥½é€‰æ‹©","å®ƒä¸æŒ‘ï¼Œæœ‰å¾—ç©å°±è¡Œ","è¿½é€å‹ç©å…·æœ€åˆé€‚"],
      emotion:["å…´å¥‹è¿‡å¤´æ—¶ç”¨é›¶é£Ÿå¼•å¯¼å®‰é™ä¸‹æ¥","ç¤¾äº¤è¿‡åç»™ç‹¬å¤„æ—¶é—´æ¢å¤"]
    }},
  "ESFJ": { name:"ç”œèœœå°è·Ÿç­", rarity:10, line:"ä½ ä¸Šå•æ‰€å…³é—¨çš„é‚£ä¸€åˆ»ï¼Œæˆ‘çš„ä¸–ç•Œå´©å¡Œäº†â€”â€”å¿«å¼€é—¨è®©æˆ‘çœ‹çœ‹ä½ ã€‚", tags:["é»äºº","åˆ†ç¦»ç„¦è™‘","è´´èº«é›·è¾¾"],
    monologue:"ä½ å‡ºé—¨çš„æ—¶å€™æˆ‘æ²¡å«ï¼Œä¸æ˜¯å› ä¸ºä¸åœ¨æ„ï¼Œæ˜¯å› ä¸ºæ€•ä½ å¿ƒç–¼ã€‚ä½†é—¨å…³ä¸Šä»¥åï¼Œæˆ‘å°±è¶´åœ¨é—¨å£äº†ã€‚ä½ é‹å­ä¸Šçš„å‘³é“ï¼Œæ˜¯æˆ‘ç­‰ä½ å›æ¥æ—¶å”¯ä¸€çš„å®‰æ…°ã€‚",
    tips:["ç»™ç¨³å®šçš„ç”Ÿæ´»èŠ‚å¥å’Œå›ºå®šä»ªå¼æ„Ÿ","åˆ†ç¦»è®­ç»ƒè¦å¾ªåºæ¸è¿›ï¼Œä»çŸ­æ—¶é—´å¼€å§‹","å‡ºé—¨å‰ä¸è¦å¤§å¼ æ——é¼“å‘Šåˆ«ï¼Œä½è°ƒç¦»å¼€åè€Œæ›´å¥½"],
    bubbles:["å¿ è¯š","é»äºº","æ¸©æš–","å®ˆæŠ¤","ç¨³å®š","é™ªä¼´"],
    profile:{
      traits:["ä½ åœ¨å“ªå®ƒåœ¨å“ªï¼Œå ªç§°çŒ«ç•ŒGPS","è´£ä»»æ„Ÿè¶…å¼ºï¼Œå…¨å®¶æ¯ä¸ªäººå®ƒéƒ½è¦ç…§é¡¾åˆ°","å–œæ¬¢ç¨³å®šçš„ç”Ÿæ´»èŠ‚å¥ï¼Œè®¨åŒå˜åŒ–"],
      behaviors:["ä½ å»å¨æˆ¿å®ƒè·Ÿå»å¨æˆ¿ï¼Œä½ å»å«ç”Ÿé—´å®ƒè¹²é—¨å£","ä½ å‡ºé—¨å®ƒè¶´åœ¨é—¨å£ç­‰ï¼Œä½ å›æ¥å®ƒå·²ç»è¹²åœ¨ç„å…³äº†","å…¨å®¶äººéƒ½åˆ°é½äº†æ‰å®‰å¿ƒå»ç¡è§‰"],
      innerVsOuter:{inner:["ä½ è¦å‡ºé—¨äº†â€¦æˆ‘å‡è£…ä¸åœ¨æ„ä½†æˆ‘å¿ƒå·²ç»ç¢äº†","é—¨é”å“äº†ï¼æ˜¯ä½ å—ï¼æ˜¯ä½ å—ï¼","å¤§å®¶éƒ½åœ¨ï¼Œå¥½çš„ï¼Œæˆ‘å¯ä»¥å®‰å¿ƒäº†"],outer:["é»˜é»˜èµ°åˆ°é—¨å£è¶´ä¸‹çœ‹ç€ä½ ç©¿é‹","å†²åˆ°é—¨å£å–µå–µå«ç€è¿æ¥","ç¡®è®¤å…¨å®¶äººåˆ°é½åæ‰å»è‡ªå·±çš„çªè¶´ä¸‹"]}
    },
    guide:{
      relationship:["ç»™ç¨³å®šçš„æ—¥å¸¸ä»ªå¼æ„Ÿï¼ˆå›ºå®šå–‚é£Ÿã€å›ºå®šç¡è§‰ä½ç½®ï¼‰","åˆ†ç¦»è®­ç»ƒå¾ªåºæ¸è¿›ï¼Œä»çŸ­æ—¶é—´å¼€å§‹"],
      feeding:["å®šæ—¶å®šé‡æœ€é‡è¦ï¼Œæ‰“ä¹±èŠ‚å¥å®ƒä¼šç„¦è™‘","å¯ä»¥ç”¨å–‚é£Ÿä»ªå¼å¢å¼ºå®‰å…¨æ„Ÿ"],
      toys:["é™ªä¼´å‹äº’åŠ¨ä¸ºä¸»â€”â€”æŠšæ‘¸ã€ä¸€èµ·çœ‹çª—å¤–å°±å¥½","ä¸éœ€è¦å¤ªå¤æ‚çš„ç©å…·","äº’åŠ¨ç±»ç©å…·å¢è¿›æ„Ÿæƒ…"],
      emotion:["å‡ºé—¨å‰ä½è°ƒï¼Œå›å®¶åå…ˆå†·é™å†äº’åŠ¨","ç»™å®ƒä½ çš„æ—§è¡£æœæ”¾çªé‡Œå¢åŠ å®‰å…¨æ„Ÿ"]
    }},
  "ESTP": { name:"é£æªèµ°å£ä¾ ", rarity:7, line:"é‚£ä¸ªæŸœå­é¡¶ä¸Šæˆ‘è¿˜æ²¡å»è¿‡â€”â€”ç­‰ä¸‹ï¼Œå·²ç»å»è¿‡äº†ã€‚", tags:["å†’é™©ç‹","è¡ŒåŠ¨æ´¾","çˆ¬é…·é«˜æ‰‹"],
    monologue:"ä½ é—®æˆ‘ä¸ºä»€ä¹ˆè¦è·³åˆ°å†°ç®±ä¸Šé¢ï¼Ÿå› ä¸ºå®ƒåœ¨é‚£é‡Œå•Šã€‚ä½ é—®æˆ‘ä¸ºä»€ä¹ˆä»å†°ç®±ä¸Šè·³åˆ°ä¹¦æ¶ä¸Šï¼Ÿå› ä¸ºæˆ‘èƒ½å•Šã€‚äººç”Ÿâ€”â€”ä¸å¯¹ï¼ŒçŒ«ç”Ÿå°±æ˜¯è¦ä¸æ–­æŒ‘æˆ˜è‡ªå·±ã€‚",
    tips:["å®¶é‡Œå¿…é¡»æœ‰è¶³å¤Ÿçš„å‚ç›´ç©ºé—´ï¼ˆçŒ«çˆ¬æ¶ã€è·³å°ï¼‰","å±é™©åŒºåŸŸè¦åšå¥½é˜²æŠ¤ï¼ˆé«˜çª—ã€é˜³å°ï¼‰","å……è¶³çš„è¿åŠ¨é‡æ˜¯å®ƒæƒ…ç»ªç¨³å®šçš„å…³é”®"],
    bubbles:["å†’é™©","å‹‡æ•¢","æ´»åŠ›","æ•æ·","è‡ªç”±","è¡ŒåŠ¨"],
    profile:{
      traits:["è¡ŒåŠ¨åŠ›è¶…å¼ºï¼Œæƒ³åˆ°å°±åš","èƒ†å­å¤§ï¼Œæ²¡æœ‰ä¸æ•¢å»çš„åœ°æ–¹","å¯¹æ–°ç¯å¢ƒé€‚åº”åŠ›æå¼ºï¼Œåˆ°å“ªéƒ½è‡ªæ¥ç†Ÿ"],
      behaviors:["èƒ½ä¸Šçš„åœ°æ–¹å…¨è¦ä¸Šå»ä¸€éâ€”â€”å†°ç®±é¡¶ã€æŸœå­é¡¶ã€ç©ºè°ƒä¸Š","å¬åˆ°å¼‚å“ç¬¬ä¸€ä¸ªå†²è¿‡å»æŸ¥çœ‹","ç¬¬ä¸€æ¬¡å»æ–°åœ°æ–¹é›¶ææƒ§ï¼Œåˆ°å¤„å·¡è§†"],
      innerVsOuter:{inner:["é‚£ä¸ªæ¶å­çœ‹ç€ä¸å¤ªç¨³â€¦ç®—äº†å…ˆè·³äº†å†è¯´ï¼","å¤–é¢æœ‰å£°éŸ³ï¼æ•Œæƒ…ï¼å†²å•Šï¼","è¿™ä¸ªæ°´é¾™å¤´æ€ä¹ˆå›äº‹ï¼Ÿè®©æˆ‘ç ”ç©¶ç ”ç©¶"],outer:["ä¸€ä¸ªèµ·è·³ä¸Šäº†ä¹¦æ¶ï¼Œä¹¦å…¨æ‰äº†","ç®­ä¸€æ ·å°„å‘é˜³å°è¶´åœ¨çª—å°ä¾¦æŸ¥","ä¼¸çˆªæ‹¨å¼„æ°´é¾™å¤´æŠŠè‡ªå·±æµ‡äº†ä¸€èº«"]}
    },
    guide:{
      relationship:["ç»™è¶³å‚ç›´ç©ºé—´ï¼ˆçŒ«çˆ¬æ¶å¿…å¤‡ï¼‰","é˜³å°å’Œé«˜çª—åšå¥½å®‰å…¨é˜²æŠ¤"],
      feeding:["è¿åŠ¨é‡å¤§éœ€è¦å……è¶³è¥å…»","å¯ä»¥æŠŠé£Ÿç‰©æ”¾åœ¨ä¸åŒé«˜åº¦å¢åŠ æ¢ç´¢ä¹è¶£"],
      toys:["è¿½é€å‹ç©å…·æœ€åˆé€‚â€”â€”å¼¹åŠ›çƒã€æ¿€å…‰ç¬”","é€‚åˆæ•æ·è®­ç»ƒ","é«˜å¤„è·³å°æ˜¯æœ€å¥½çš„æ¸¸ä¹åœº"],
      emotion:["é™åˆ¶æ´»åŠ¨ç©ºé—´ä¼šè®©å®ƒç„¦èº","ç»™è¶³è¿åŠ¨é‡ï¼Œæ‹†å®¶è¡Œä¸ºè‡ªç„¶å‡å°‘"]
    }},
  "ESTJ": { name:"å·¡é€»å°é˜Ÿé•¿", rarity:9, line:"è¯´å¥½ä¸ƒç‚¹åƒé¥­å°±ä¸ƒç‚¹ã€‚è¿Ÿåˆ°ä¸€åˆ†é’Ÿï¼Œæˆ‘å°±ç”¨çœ¼ç¥æé†’ä½ ã€‚", tags:["å®ˆæ—¶","è®²è§„çŸ©","ç§©åºç»´æŠ¤è€…"],
    monologue:"ä¸ƒç‚¹é›¶ä¸€åˆ†äº†ä½ æ€ä¹ˆè¿˜ä¸å–‚é¥­ï¼Ÿä½ æ‰“ä¹±äº†æµç¨‹ä½ çŸ¥é“å—ï¼Ÿæˆ‘æ¯å¤©çš„æ—¥ç¨‹è¡¨å¾ˆç´§çš„â€”â€”ä¸ƒç‚¹åƒé¥­ï¼Œä¸ƒç‚¹åŠå·¡é€»ï¼Œå…«ç‚¹å çª—å°ï¼Œå…«ç‚¹åŠæ´—è„¸ã€‚ä½ åˆ«è€½è¯¯æˆ‘ã€‚",
    tips:["å›ºå®šä½œæ¯æ˜¯å®ƒæœ€å¤§çš„å®‰å…¨æ„Ÿâ€”â€”å–‚é£Ÿã€ç©è€æ—¶é—´å°½é‡åˆ«å˜","ç¯å¢ƒå˜åŒ–è¦ç»™é€‚åº”æœŸï¼Œåˆ«çªç„¶å¤§æ”¹","å®ƒçš„'ç›¯ç€ä½ çœ‹'ä¸æ˜¯æ§åˆ¶ï¼Œæ˜¯åœ¨æé†’ä½ 'è¯¥åšæŸäº‹äº†'"],
    bubbles:["çºªå¾‹","å¯é ","ä¸¥è°¨","å¿ è¯š","ç§©åº","æ‰§è¡Œ"],
    profile:{
      traits:["å¤©ç”Ÿçš„è§„åˆ™æ‰§è¡Œè€…ï¼Œç”Ÿæ´»æœ‰æ¡æœ‰ç†","å¯é ç¨³å®šï¼Œæ˜¯å®¶é‡Œæœ€è®©ä½ çœå¿ƒçš„","å¯¹'è¯¥åšä»€ä¹ˆä¸è¯¥åšä»€ä¹ˆ'æœ‰æ¸…æ™°è®¤çŸ¥"],
      behaviors:["æ¯å¤©å›ºå®šæ—¶é—´å‚¬é¥­ã€å›ºå®šæ—¶é—´å·¡é€»ã€å›ºå®šæ—¶é—´ç¡è§‰","ä½ åç¦»äº†æ—¥å¸¸æµç¨‹å®ƒä¼šç”¨çœ¼ç¥'çº æ­£'ä½ ","æ–°çŒ«æ¥äº†å®ƒè´Ÿè´£åˆ¶å®š'å®¶è§„'"],
      innerVsOuter:{inner:["ä¸ƒç‚¹é›¶äºŒåˆ†äº†ã€‚ä½ æ˜¯ä¸æ˜¯å¿˜äº†ä»€ä¹ˆï¼Ÿ","è§„çŸ©å°±æ˜¯è§„çŸ©ï¼Œè°è¿åæˆ‘éƒ½æœ‰æ„è§","æ—¥ç¨‹å®‰æ’å¥½äº†å°±ä¸è¦å˜ï¼Œå˜äº†æˆ‘ä¸å®‰å¿ƒ"],outer:["ååœ¨é¥­ç¢—å‰ç›´å‹¾å‹¾ç›¯ç€ä½ ","æ–°æ¥çš„çŒ«è¸©äº†å®ƒçš„çªè¢«å®ƒä¸€çˆªæ‹èµ°","ä½ æ¢äº†å–‚é£Ÿæ—¶é—´å®ƒåœ¨æ—§æ—¶é—´ç‚¹ç„¦èºåœ°èµ°æ¥èµ°å»"]}
    },
    guide:{
      relationship:["å°½é‡ä¿æŒæ—¥å¸¸èŠ‚å¥ç¨³å®š","å¦‚æœè¦æ”¹å˜ä»€ä¹ˆï¼Œå¾ªåºæ¸è¿›"],
      feeding:["å›ºå®šæ—¶é—´å›ºå®šåœ°ç‚¹å›ºå®šåˆ†é‡â€”â€”è¿™æ˜¯å®ƒçš„äººç”Ÿä¿¡æ¡","æ‰“ä¹±èŠ‚å¥å®ƒä¼šç„¦è™‘"],
      toys:["è§„åˆ™æ˜ç¡®çš„äº’åŠ¨æ¸¸æˆâ€”â€”å®šç‚¹ã€è¿½é€ã€å¯»å›","å®ƒè®¨åŒæ²¡è§„å¾‹çš„é€—å¼„","æœ‰ç« æ³•çš„ç©è€æœ€åˆé€‚"],
      emotion:["çªç„¶çš„ç¯å¢ƒå˜åŒ–ä¼šè®©å®ƒç„¦è™‘","æ¬å®¶/æ¢å®¶å…·å‰ç»™è¶³è¿‡æ¸¡æœŸ"]
    }},
  "INFP": { name:"çª—å°å°è¯—äºº", rarity:6, line:"å…¨ä¸–ç•Œåªè¦ä½ å°±å¤Ÿäº†â€”â€”å…¶ä»–äººï¼Ÿä¸ç†Ÿï¼Œè°¢è°¢ã€‚", tags:["æ•æ„Ÿ","æ…¢çƒ­","æ·±æƒ…"],
    monologue:"ä½ ä¸åœ¨çš„æ—¶å€™æˆ‘ä¼šè¶´åœ¨ä½ çš„æ•å¤´ä¸Šï¼Œä¸æ˜¯å› ä¸ºæ•å¤´èˆ’æœï¼Œæ˜¯å› ä¸ºä¸Šé¢æœ‰ä½ çš„å‘³é“ã€‚ä½ å°±æ˜¯æˆ‘å…¨éƒ¨çš„å®‰å…¨æ„Ÿï¼Œä½ çŸ¥é“å—ï¼Ÿå¤–é¢çš„ä¸–ç•Œå¤ªåµäº†ï¼Œæˆ‘åªè¦ä½ å°±å¥½ã€‚",
    tips:["ç»™å®ƒä¸€ä¸ªä¸“å±å®‰å…¨è§’ï¼ˆçª/åŠå°é—­ç©ºé—´ï¼‰ï¼Œé‚£æ˜¯å®ƒçš„å……ç”µç«™","ç¤¾äº¤ä¸è¦å‹‰å¼ºï¼Œè®©å®ƒæŒ‰è‡ªå·±çš„èŠ‚å¥æ¥","è®­ç»ƒè¦æ¸©æŸ”ï¼Œå¤§å£°è¯´è¯ä¼šå“åˆ°å®ƒ"],
    bubbles:["æ•æ„Ÿ","æ·±æƒ…","æµªæ¼«","ç»†è…»","å¿ è¯š","æ¸©æŸ”","å†…æ•›"],
    profile:{
      traits:["å†…å¿ƒä¸–ç•Œä¸°å¯Œï¼Œæƒ…æ„Ÿç»†è…»åˆ°ä»¤äººå¿ƒç–¼","åªå¯¹ä½ ï¼ˆæˆ–æå°‘æ•°äººï¼‰å®Œå…¨æ•å¼€å¿ƒæ‰‰","å¯¹ç¯å¢ƒå˜åŒ–å’Œæƒ…ç»ªæ°›å›´æåº¦æ•æ„Ÿ"],
      behaviors:["å¯ä»¥ä¸€ä¸‹åˆååœ¨çª—å°ä¸Šçœ‹å¤–é¢ï¼Œåƒåœ¨å†™è¯—","é™Œç”Ÿäººæ¥äº†å°±æ¶ˆå¤±ï¼Œä½†ä½ å«å®ƒåå­—å®ƒä¼šå·å·æ¢å¤´","å–œæ¬¢å®‰é™åœ°è¶´åœ¨ä½ æ—è¾¹ï¼Œåªè¦ä½ åœ¨å°±å¥½"],
      innerVsOuter:{inner:["ä½ çš„æ•å¤´ä¸Šæœ‰ä½ çš„å‘³é“ï¼Œè¶´ç€å°±å®‰å¿ƒäº†","é™Œç”Ÿäººå¥½å¯æ€•â€¦ä½ åœ¨å—â€¦æˆ‘è¦èº²èµ·æ¥","ä½ ä»Šå¤©å›æ¥å¾—æ™šäº†ï¼Œæˆ‘ç­‰äº†å¥½ä¹…å¥½ä¹…"],outer:["ä½ å‡ºé—¨åå®ƒå¼ç€ä½ çš„è¢œå­å›çª","å®¢äººè¿˜æ²¡è¿›é—¨å®ƒå·²ç»æ¶ˆå¤±äº†","ä½ å›æ¥åé»˜é»˜èµ°è¿‡æ¥è¹­äº†è¹­ä½ çš„è„šè¸"]}
    },
    guide:{
      relationship:["å‡å°‘å¼ºåˆ¶ç¤¾äº¤ï¼Œè®©å®ƒæœ‰å®‰å…¨çš„é€€è·¯","ç»™å®ƒä½ çš„æ—§è¡£æœæ”¾çªé‡Œ"],
      feeding:["å®‰é™ç¯å¢ƒä¸‹è¿›é£Ÿï¼Œåˆ«åœ¨æ—è¾¹å¤§å£°è¯´è¯","å¯ä»¥æ‰‹å–‚å¢è¿›ä¿¡ä»»"],
      toys:["è½»æŸ”çš„é€—çŒ«æ£’ã€å®‰é™çš„å—…é—»ç©å…·","ä¸é€‚åˆå¤ªæ¿€çƒˆçš„è¿½é€æ¸¸æˆ","æŸ”è½¯çš„é™ªä¼´å‹ç©å¶æœ€åˆé€‚"],
      emotion:["å¤§å£°å‘µæ–¥ä¼šè®©å®ƒå¾ˆä¹…æ‰æ¢å¤","å®ƒçš„èƒ†å°ä¸æ˜¯ç¼ºé™·ï¼Œå°Šé‡å®ƒçš„èŠ‚å¥"]
    }},
  "INFJ": { name:"æœˆå…‰å®ˆæŠ¤è€…", rarity:3, line:"å®ƒä»€ä¹ˆéƒ½ä¸è¯´ï¼Œå°±å®‰é™åœ°å¾…åœ¨ä½ èº«è¾¹â€”â€”ç„¶åä½ å°±å¥½äº†ã€‚", tags:["æ´å¯ŸåŠ›","å®‰é™æ²»æ„ˆ","æœ‰åˆ†å¯¸"],
    monologue:"æˆ‘ä¸æ˜¯ä¸çˆ±çƒ­é—¹ï¼Œæˆ‘åªæ˜¯æ›´å–œæ¬¢å®‰å®‰é™é™å¾…åœ¨ä½ èº«æ—ã€‚ä½ çœ‹ä¹¦æˆ‘è¶´ç€ï¼Œä½ å‘å‘†æˆ‘ä¹Ÿè¶´ç€ã€‚æˆ‘ä»¬ä¹‹é—´ä¸ç”¨è¯´ä»€ä¹ˆï¼Œåœ¨ä¸€èµ·å°±å¾ˆå¥½äº†ã€‚ä½†ä½ éš¾è¿‡çš„æ—¶å€™ï¼Œæˆ‘ä¼šå¤šé ä½ è¿‘ä¸€ç‚¹ã€‚",
    tips:["å›ºå®šçš„ä½œæ¯å’Œç¯å¢ƒç»™å®ƒæœ€å¤§çš„å®‰å…¨æ„Ÿ","ç¤¾äº¤ä»¥ç†Ÿäººä¸ºä¸»ï¼Œæ…¢æ…¢æ‰©åœˆ","å®ƒçš„æ²‰é»˜ä¸æ˜¯å†·æ¼ ï¼Œæ˜¯åœ¨ç”¨è‡ªå·±çš„æ–¹å¼è¡¨è¾¾çˆ±"],
    bubbles:["æ´å¯Ÿ","æ¸©æŸ”","å®ˆæŠ¤","ç¥ç§˜","ç›´è§‰","ä¸“æ³¨"],
    profile:{
      traits:["å®‰é™ä½†æ´å¯ŸåŠ›æå¼ºï¼Œæ€»èƒ½æ„ŸçŸ¥ä½ çš„çŠ¶æ€","æœ‰åˆ†å¯¸æ„Ÿâ€”â€”ä¸ä¼šè¿‡åº¦é»äººï¼Œä¹Ÿä¸ä¼šå¤ªç–è¿œ","å…³é”®æ—¶åˆ»ç‰¹åˆ«é è°±ï¼Œæ˜¯çœŸæ­£çš„æ²»æ„ˆç³»"],
      behaviors:["æ€»æ˜¯å®‰é™åœ°å¾…åœ¨ä½ é™„è¿‘ï¼Œä¸åµä¸é—¹ä½†ä¹Ÿä¸è¿œ","ä½ ä¸å¼€å¿ƒæ—¶å®ƒä¼šä¸»åŠ¨é è¿‡æ¥ï¼Œæ¯”å¹³æ—¶å¤šè¹­ä½ ä¸¤ä¸‹","å¯¹é™Œç”Ÿäººä¿æŒç¤¼è²Œä½†æœ‰è·ç¦»"],
      innerVsOuter:{inner:["ä½ éš¾è¿‡å§ï¼Ÿæˆ‘æ„Ÿè§‰åˆ°äº†ï¼Œæˆ‘æ¥é™ªä½ ","æˆ‘ä¸è¯´è¯ä¸ä»£è¡¨æ²¡åœ¨çˆ±ä½ ï¼Œæ¯ä¸€ç§’éƒ½åœ¨","ä½ ä»Šå¤©ç¬‘äº†ä¸‰æ¬¡ï¼Œæ¯”æ˜¨å¤©å¤šä¸€æ¬¡"],outer:["é»˜é»˜è·³ä¸Šæ²™å‘ç´§æŒ¨ç€ä½ è¶´ä¸‹","ä½ å·¥ä½œæ—¶å®ƒå®‰é™è¶´åœ¨æ¡Œè§’çœ‹ç€ä½ ","ä½ ç¬‘çš„æ—¶å€™å®ƒè½»è½»çœ¯äº†çœ¯çœ¼å›åº”ä½ "]}
    },
    guide:{
      relationship:["ç»™å®ƒå›ºå®šçš„'é™ªä¼´ä½'ï¼ˆä½ æ¡Œæ—ã€æ²™å‘æ—ï¼‰","ä¸éœ€è¦ç‰¹æ„é€—å®ƒï¼Œåœ¨ä¸€èµ·å°±å¥½"],
      feeding:["å®‰é™è§„å¾‹çš„å–‚é£Ÿç¯å¢ƒ","ä¸å–œæ¬¢è¢«æ‰“æ‰°è¿›é£Ÿ"],
      toys:["è½»æŸ”çš„äº’åŠ¨å°±å¥½â€”â€”ç¾½æ¯›é€—çŒ«æ£’æ…¢æ…¢æ™ƒ","ä¸é€‚åˆå¤ªå˜ˆæ‚çš„ç©æ³•","å®‰é™å‹å—…é—»ç©å…·"],
      emotion:["ç¤¾äº¤ä»¥ç†Ÿäººä¸ºä¸»","å®ƒçš„æ²‰é»˜æ˜¯åœ¨ç”¨å®ƒçš„æ–¹å¼çˆ±ä½ "]
    }},
  "INTP": { name:"çº¸ç®±å“²å­¦å®¶", rarity:5, line:"åˆ«æ‰“æ‰°å®ƒâ€”â€”å®ƒæ­£åœ¨æ€è€ƒä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜ï¼ˆå…¶å®æ˜¯åœ¨å‘å‘†ï¼‰ã€‚", tags:["ç‹¬ç«‹","ç ”ç©¶å‹","è‡ªæœ‰èŠ‚å¥"],
    monologue:"æˆ‘å¯¹ç€é‚£ä¸ªæ°´é¾™å¤´ç ”ç©¶äº†åŠå°æ—¶ä¸æ˜¯å‘å‘†ï¼Œæˆ‘åœ¨åˆ†ææ°´ä¸ºä»€ä¹ˆä»é‚£é‡Œå‡ºæ¥ã€‚ä½ ä»¬äººç±»ä¸æ‡‚ç‰©ç†å­¦çš„é­…åŠ›ï¼Œç®—äº†ä¸è§£é‡Šäº†ã€‚è®©æˆ‘å†çœ‹ä¸€ä¼šå„¿ã€‚",
    tips:["ç»™å®ƒç‹¬å¤„çš„ç©ºé—´å’Œæ—¶é—´ï¼Œåˆ«å¼ºè¡Œäº’åŠ¨","ç›Šæ™ºå–‚é£Ÿå™¨å’Œæ–°é²œäº‹ç‰©èƒ½æ»¡è¶³å®ƒçš„ç ”ç©¶æ¬²","å®ƒä¸ç†ä½ ä¸ä»£è¡¨ä¸çˆ±ä½ ï¼Œåªæ˜¯åœ¨'å·¥ä½œ'"],
    bubbles:["å¥½å¥‡","ç‹¬ç«‹","ä¸“æ³¨","èªæ…§","ç ”ç©¶","å®‰é™"],
    profile:{
      traits:["å¤©ç”Ÿçš„ç ”ç©¶è€…ï¼Œå¯¹ä¸€åˆ‡äº‹ç‰©ä¿æŒå¥½å¥‡","ç‹¬ç«‹æ€§å¼ºï¼Œäº«å—ç‹¬å¤„çš„æ—¶å…‰","å­¦ä¹ èƒ½åŠ›å¼ºä½†å®Œå…¨æŒ‰è‡ªå·±çš„èŠ‚å¥æ¥"],
      behaviors:["èƒ½å¯¹ç€ä¸€æ»´æ°´/ä¸€åªè™«å­è§‚å¯ŸåŠå¤©ä¸åŠ¨","è‡ªå·±ç©å¾—å¾ˆå¼€å¿ƒï¼Œä¸éœ€è¦ä½ é™ª","å«å®ƒåå­—è¦å«ä¸‰éæ‰æ…¢æ‚ æ‚ çœ‹ä½ ä¸€çœ¼"],
      innerVsOuter:{inner:["è¿™ä¸ªæ°´é¾™å¤´çš„å‡ºæ°´åŸç†åˆ°åº•æ˜¯ä»€ä¹ˆâ€¦","ä½ åœ¨å«æˆ‘ï¼Ÿå—¯â€¦ç­‰æˆ‘ç ”ç©¶å®Œè¿™ä¸ª","ä½ åæ—è¾¹å°±å¥½ï¼Œåˆ«è¯´è¯ï¼Œæˆ‘åœ¨æ€è€ƒ"],outer:["å¯¹ç€æ°´é¾™å¤´çœ‹äº†æ•´æ•´äºŒååˆ†é’Ÿ","å«ä¸‰éæ‰æ‡’æ´‹æ´‹æŠ¬å¤´çœ‹ä½ ä¸€çœ¼","ä½ å®‰é™åæ—è¾¹æ—¶å®ƒåè€Œä¸»åŠ¨è¹­ä½ "]}
    },
    guide:{
      relationship:["å°Šé‡å®ƒçš„ç‹¬å¤„æ—¶é—´","ç»™æ–°é²œäº‹ç‰©æ¿€å‘å¥½å¥‡å¿ƒâ€”â€”æ–°çº¸ç®±ã€æ–°æè´¨çš„ç©å…·"],
      feeding:["æ¼é£Ÿçƒå’Œè—é£Ÿæ‹¼å›¾æ¯”ç›´æ¥å–‚æ›´åˆé€‚","è®©åƒé¥­ä¹Ÿå˜æˆ'ç ”ç©¶'"],
      toys:["æ–°å¥‡çš„ä¸œè¥¿æ¯”è´µçš„ä¸œè¥¿å¥½ä½¿","éœ€è¦å®šæœŸæ¢æ–°","ç›Šæ™ºç©å…·ã€è§£è°œç±»æ˜¯é¦–é€‰"],
      emotion:["å®ƒä¸å›åº”ä½ ä¸ä»£è¡¨ä¸çˆ±ä½ ï¼Œç»™è¶³è‡ªä¸»ç©ºé—´","ä½ å®‰é™é™ªç€æ—¶å®ƒåè€Œä¼šä¸»åŠ¨é è¿‘"]
    }},
  "INTJ": { name:"é«˜å†·å®¡åˆ¤å®˜", rarity:4, line:"çœ‹ä¼¼ä¸éœ€è¦ä½ ï¼Œå…¶å®ä½ èµ°å“ªå®ƒçš„è§†çº¿å°±è·Ÿåˆ°å“ªã€‚", tags:["å†·é™","ç­–ç•¥å®¶","å®¡è§†ä¸€åˆ‡"],
    monologue:"æˆ‘ä¸æ˜¯ä¸ç†ä½ ï¼Œåªæ˜¯æˆ‘è§‰å¾—å¤§æƒŠå°æ€ªå¾ˆæ²¡å¿…è¦ã€‚ä½†ä½ æ™šä¸Šç¡ç€ä»¥åï¼Œæˆ‘ä¼šè·³ä¸ŠåºŠç¡®è®¤ä½ è¿˜åœ¨â€”â€”ç¡®è®¤äº†ï¼Œå°±å®‰å¿ƒäº†ã€‚è¿™ä»¶äº‹ä½ ä¸éœ€è¦çŸ¥é“ã€‚",
    tips:["è§„åˆ™æ˜ç¡®ã€è¾¹ç•Œæ¸…æ™°ï¼Œåˆ«æœä»¤å¤•æ”¹","ç¤¾äº¤åˆ«å‚¬å®ƒï¼Œç»™å®ƒé€‰æ‹©æƒ","çŒ«çˆ¬æ¶é«˜å¤„æ˜¯å®ƒçš„'ç‹åº§'ï¼Œå¿…é¡»ä¿ç•™"],
    bubbles:["ç†æ€§","å†·é™","ç­–ç•¥","ç‹¬ç«‹","è‡ªå¾‹","æ·±æ²‰"],
    profile:{
      traits:["å†·é™è‡ªæŒï¼Œå¾ˆå°‘æœ‰è¿‡åº¦å…´å¥‹çš„æ—¶å€™","å¯¹ç¯å¢ƒæœ‰æå¼ºçš„æŒæ§æ¬²ï¼Œä»€ä¹ˆéƒ½çœ‹åœ¨çœ¼é‡Œ","è‡ªæ§åŠ›å¼ºï¼Œä¸ä¼šä¸ºäº†é›¶é£Ÿä¸¢æ‰å°Šä¸¥"],
      behaviors:["æ–°ç¯å¢ƒå…ˆåœ¨é«˜å¤„è§‚å¯Ÿä¸€åœˆå†å†³å®šä¸‹ä¸ä¸‹æ¥","ä½ å›å®¶å®ƒåªæŠ¬çœ¼çœ‹ä¸€ä¸‹åˆé—­ä¸Šäº†ï¼Œä½†å…¶å®ä¸€ç›´åœ¨å¬","ä¸è½»æ˜“è®©é™Œç”Ÿäººæ‘¸ï¼Œå¯¹ä½ å¶å°”æ‰å±•ç¤ºæŸ”è½¯çš„ä¸€é¢"],
      innerVsOuter:{inner:["ä¸æ˜¯ä¸ç†ä½ ï¼Œæ˜¯ä½ å¤§æƒŠå°æ€ªæ²¡å¿…è¦","ä½ ç¡äº†å—ï¼Ÿæˆ‘å»ç¡®è®¤ä¸€ä¸‹","æˆ‘æ—©å°±çœ‹ç©¿ä¸€åˆ‡äº†ï¼Œåªæ˜¯æ‡’å¾—è¡¨æ€"],outer:["ä½ çƒ­æƒ…å«å®ƒå®ƒåªæ˜¯çœ‹äº†ä½ ä¸€çœ¼","åŠå¤œå·å·è·³ä¸ŠåºŠè¹­äº†ä½ ä¸€ä¸‹åˆè·³èµ°","æ–°æ¥çš„å®¢äººä¼¸æ‰‹æ‘¸å®ƒè¢«å®ƒä¸€ä¸ªä¾§èº«é—ªå¼€"]}
    },
    guide:{
      relationship:["è§„åˆ™æ˜ç¡®åˆ«å˜æ¥å˜å»","åˆ«å¼ºè¡ŒæŠ±å®ƒï¼Œç­‰å®ƒä¸»åŠ¨æ¥æ‰¾ä½ "],
      feeding:["ä¸è´ªé£Ÿä½†å¯¹å“è´¨æœ‰è¦æ±‚","å›ºå®šæ—¶é—´æ”¾å¥½å³å¯ï¼Œåˆ«ç›¯ç€å®ƒåƒ"],
      toys:["é«˜éš¾åº¦ç›Šæ™ºç©å…·æ‰é…å¾—ä¸Šå®ƒ","ç­–ç•¥å‹è—é£Ÿæ¸¸æˆ","ä¸å–œæ¬¢æ— æ„ä¹‰çš„é‡å¤"],
      emotion:["å®ƒçš„é«˜å†·æ˜¯æ€§æ ¼ä¸æ˜¯ä¸çˆ±ä½ ","åŠå¤œæ¥è¹­ä½ å°±æ˜¯å®ƒæœ€å¤§çš„è¡¨ç™½"]
    }},
  "ISFP": { name:"é˜³å…‰èººå¹³å–µ", rarity:7, line:"é˜³å…‰ã€è½¯å«ã€ä½ çš„è…¿â€”â€”è¿™æ˜¯æˆ‘çš„å®Œç¾ä¸‰ä»¶å¥—ã€‚", tags:["æ¸©æŸ”","äº«å—å‹","å®¡ç¾åœ¨çº¿"],
    monologue:"é˜³å…‰åˆšå¥½ç…§åˆ°é‚£å—å«å­ä¸Šï¼Œæ¸©åº¦ä¹Ÿåˆšåˆšå¥½ã€‚è¿™å°±æ˜¯å®Œç¾çš„åˆåã€‚ä½ è¦æ˜¯èƒ½æ¥æ‘¸æ‘¸æˆ‘çš„ä¸‹å·´é‚£å°±æ›´å®Œç¾äº†ã€‚å¯¹äº†ä½ æ–°æ¢çš„é‚£ä¸ªçŒ«ç ‚æˆ‘ä¸å¤ªå–œæ¬¢ï¼Œå°±è¿™æ ·ã€‚",
    tips:["ç¯å¢ƒèˆ’é€‚åº¦æ˜¯ç¬¬ä¸€è¦åŠ¡â€”â€”å«å­è¦è½¯ã€çªè¦æš–ã€å…‰çº¿è¦å¥½","è®­ç»ƒç”¨é¼“åŠ±æ›¿ä»£å‹åŠ›ï¼Œæ¸©æŸ”å¼•å¯¼","å°Šé‡å®ƒçš„æŒ‘å‰”ï¼Œé‚£æ˜¯åœ¨å‘Šè¯‰ä½ å®ƒçš„éœ€æ±‚"],
    bubbles:["æ¸©æŸ”","ç»†è…»","äº«å—","æƒ¬æ„","å®¡ç¾","å®‰é™","è‡ªåœ¨"],
    profile:{
      traits:["æ¸©æŸ”åˆ°éª¨å­é‡Œï¼Œå¯¹èˆ’é€‚åº¦æœ‰æé«˜è¦æ±‚","æ…¢çƒ­ä½†ä¸€æ—¦äº²è¿‘å°±ç‰¹åˆ«é»äºº","æœ‰è‡ªå·±çš„å®¡ç¾ï¼ŒæŒ‘å‰”ä½†å¯çˆ±"],
      behaviors:["ä¼šåœ¨å®¶é‡Œè¯•éæ¯ä¸ªè§’è½ï¼Œæ‰¾åˆ°æœ€èˆ’æœçš„é‚£ä¸€ä¸ª","é˜³å…‰å¥½çš„æ—¶å€™åœ¨çª—è¾¹ä¸€è¶´å°±æ˜¯ä¸€ä¸‹åˆ","ä½ æ‘¸å®ƒçš„å§¿åŠ¿ä¸å¯¹å®ƒä¼šæ‰­å¼€ï¼Œå§¿åŠ¿å¯¹äº†æ‰è‚¯å’•å™œ"],
      innerVsOuter:{inner:["è¿™ä¸ªå«å­ä¸å¤Ÿè½¯ï¼Œä¸‹ä¸€ä¸ª","é˜³å…‰åˆšå¥½ç…§åˆ°æˆ‘èº«ä¸Šâ€¦å®Œç¾ï¼Œåˆ«åŠ¨","ä½ æ‘¸çš„ä½ç½®ä¸å¯¹â€¦å¾€å·¦è¾¹ä¸€ç‚¹â€¦å¯¹äº†"],outer:["è¯•äº†ä¸‰ä¸ªä½ç½®æ‰é€‰å®šä»Šå¤©çš„çªç‚¹","åœ¨çª—è¾¹é˜³å…‰é‡Œè¶´äº†ä¸€æ•´ä¸ªä¸‹åˆ","ä½ æ‘¸å³è¾¹å®ƒæ‰­å¼€ï¼Œä½ æ‘¸å·¦è¾¹å®ƒå¼€å§‹å’•å™œ"]}
    },
    guide:{
      relationship:["ç¯å¢ƒèˆ’é€‚æ˜¯ä¸€åˆ‡çš„åŸºç¡€â€”â€”æ¸©åº¦ã€å«å­ã€å™ªéŸ³éƒ½ä¼šå½±å“å®ƒ","è®­ç»ƒç”¨é¼“åŠ±æ›¿ä»£å‹åŠ›ï¼Œæ¸©æŸ”å¼•å¯¼"],
      feeding:["å¯¹é£Ÿç‰©å“è´¨æŒ‘å‰”ï¼Œå¯èƒ½éœ€è¦æ¢å‡ ç§æ‰æ‰¾åˆ°æœ€çˆ±","è¿›é£Ÿç¯å¢ƒè¦å®‰é™"],
      toys:["è½»æŸ”çš„é€—çŒ«æ£’ã€ç¾½æ¯›ç©å…·","èŠ‚å¥æ…¢ä¸€ç‚¹ï¼Œåˆ«å¤ªæ¿€çƒˆ","æŸ”è½¯çš„å«å­å’Œç©å¶"],
      emotion:["å®ƒçš„æŒ‘å‰”æ˜¯åœ¨è¡¨è¾¾éœ€æ±‚","ç»™è¶³èˆ’é€‚æ„Ÿï¼Œå®ƒä¼šå›æŠ¥ä½ æœ€æ¸©æŸ”çš„å’•å™œ"]
    }},
  "ISFJ": { name:"å®‰é™å°å½±å­", rarity:10, line:"ä¸äº‰ä¸æŠ¢ï¼Œåªæƒ³å®ˆç€ä½ åˆ°æœ€åä¸€åˆ»ã€‚", tags:["å®‰é™","å¿ è¯š","å²æœˆé™å¥½"],
    monologue:"ä½ å…³é—¨å‡ºå»çš„æ—¶å€™æˆ‘æ²¡å«ï¼Œå› ä¸ºæ€•ä½ å¿ƒç–¼ã€‚ä½†é—¨å…³ä¸Šä»¥åæˆ‘å°±è¶´åœ¨ç„å…³äº†ã€‚ä½ çš„è„šæ­¥å£°ï¼Œæ˜¯æˆ‘æ¯å¤©æœ€æœŸå¾…çš„å£°éŸ³ã€‚ä½ ä¸çŸ¥é“è€Œå·²ã€‚",
    tips:["è§„å¾‹çš„é™ªä¼´æ˜¯å®ƒæœ€å¤§çš„å®‰å…¨æ„Ÿ","åˆ†ç¦»è®­ç»ƒè¦å¾ªåºæ¸è¿›ï¼Œåˆ«ä¸€ä¸‹å­ç¦»å¼€å¤ªä¹…","å¤šåšè½»æŸ”çš„è‚¢ä½“æ¥è§¦â€”â€”æŠšæ‘¸ã€æ¢³æ¯›å°±æ˜¯æœ€å¥½çš„äº’åŠ¨"],
    bubbles:["æ¸©æš–","è´´å¿ƒ","å¿ è¯š","ç¨³å®š","å®ˆæŠ¤","å®‰å¿ƒ"],
    profile:{
      traits:["å¤©ç”Ÿçš„æš–å¿ƒå°æ£‰è¢„ï¼Œæœ€ä¼š'å®‰é™åœ°çˆ±ä½ '","ä¸äº‰ä¸æŠ¢ï¼Œæ€§æ ¼ç¨³å®šè®©ä½ æ ¼å¤–å®‰å¿ƒ","å¯¹ä½ æœ‰ææ·±çš„ä¾æ‹ï¼Œä½†è¡¨è¾¾æ–¹å¼å¾ˆå…‹åˆ¶"],
      behaviors:["æ°¸è¿œåœ¨ä½ é™„è¿‘ä½†ä¸åµé—¹â€”â€”ä½ åœ¨ä¹¦æ¡Œå®ƒåœ¨è„šè¾¹","ä½ ç”Ÿç—…æ—¶å®ƒä¼šæ ¼å¤–å®‰é™åœ°é™ªç€ä½ ","å¤šçŒ«å®¶åº­é‡Œå®ƒä¸äº‰é£Ÿä¸äº‰ä½ï¼Œé»˜é»˜é€€è®©"],
      innerVsOuter:{inner:["ä½ è¦å‡ºé—¨äº†â€¦æ²¡å…³ç³»â€¦æˆ‘ç­‰ä½ ","ä½ å›æ¥äº†â€¦å¤ªå¥½äº†å¤ªå¥½äº†å¤ªå¥½äº†","åˆ«çš„çŒ«æŠ¢èµ°äº†æˆ‘çš„ä½ç½®â€¦ç®—äº†æˆ‘è®©ç»™å®ƒå§"],outer:["å®‰é™åœ°è¹²åœ¨é—¨å£çœ‹ä½ ç©¿é‹","æ…¢æ…¢èµ°è¿‡æ¥è¹­äº†è¹­ä½ çš„è„šè¸","é»˜é»˜è®©å‡ºçªå»è§’è½è¶´ä¸‹"]}
    },
    guide:{
      relationship:["è§„å¾‹çš„é™ªä¼´èŠ‚å¥â€”â€”æ¯å¤©å›ºå®šæŠšæ‘¸æ—¶é—´","å¤šçŒ«å®¶åº­è¦ç»™å®ƒä¸“å±ç©ºé—´"],
      feeding:["å®šæ—¶å®šé‡é…åˆæ¸©æŸ”è¯­æ°”","å¤šçŒ«å®¶åº­ç¡®ä¿å®ƒèƒ½å®‰å¿ƒåƒåˆ°é¥­"],
      toys:["è½»æŸ”äº’åŠ¨ä¸ºä¸»â€”â€”æŠšæ‘¸ã€æ¢³æ¯›ã€è½»è½»æ™ƒé€—çŒ«æ£’","ä¸éœ€è¦å¤ªå¤æ‚","é™ªä¼´å‹ç©å¶ç»™å®ƒå®‰å…¨æ„Ÿ"],
      emotion:["åˆ†ç¦»è®­ç»ƒå¾ªåºæ¸è¿›","ç»™å®ƒä½ çš„æ—§è¡£ç‰©å¢åŠ å®‰å…¨æ„Ÿ"]
    }},
  "ISTP": { name:"ç‹¬è¡Œä¾ å®¢å–µ", rarity:5, line:"ç‹¬æ¥ç‹¬å¾€ä¸æ˜¯ä¸çˆ±ä½ â€”â€”åªæ˜¯çˆ±å¾—å¾ˆé…·ã€‚", tags:["ç‹¬ç«‹","å†·é™","æ—è§‚è€…"],
    monologue:"æˆ‘çŸ¥é“ä½ è§‰å¾—æˆ‘ä¸å¤Ÿçƒ­æƒ…ã€‚ä½†ä½ æ·‹ç€é›¨å›æ¥é‚£å¤©ï¼Œæˆ‘è™½ç„¶åªæ˜¯çœ‹äº†ä½ ä¸€çœ¼ï¼Œå¿ƒé‡Œæƒ³çš„æ˜¯ï¼š'å›æ¥å°±å¥½ã€‚' ç„¶åæˆ‘åˆè¶´ä¸‹äº†â€”â€”å› ä¸ºæˆ‘ç¡®è®¤ä½ æ²¡äº‹äº†ã€‚",
    tips:["ç»™è¶³ç‹¬å¤„ç©ºé—´ï¼Œåˆ«ä¸€ç›´æŠ±ç€ä¸æ”¾","å®ƒä¸é»ä½ ä¸ä»£è¡¨ä¸çˆ±ä½ â€”â€”åŠå¤œå·å·é è¿‡æ¥å°±æ˜¯è¯æ®","ç¤¾äº¤å°‘è€Œç²¾ï¼Œä¸è¦å®‰æ’å¤ªå¤šåˆºæ¿€"],
    bubbles:["ç‹¬ç«‹","å†·é™","è‡ªåœ¨","è§‚å¯Ÿ","ç†æ€§","æ²‰ç¨³"],
    profile:{
      traits:["ç‹¬ç«‹æ€§æå¼ºï¼Œäº«å—è‡ªå·±çš„ç©ºé—´å’ŒèŠ‚å¥","å†·é™ç†æ€§ï¼Œä¸è½»æ˜“è¢«å¤–ç•Œå¹²æ‰°","è§‚å¯ŸåŠ›æ•é”ï¼Œä»€ä¹ˆéƒ½çœ‹åœ¨çœ¼é‡Œä½†ä¸è¯´"],
      behaviors:["å–œæ¬¢æ‰¾ä¸ªå®‰é™çš„è§’è½è‡ªå·±å¾…ç€","ä¸éœ€è¦ä½ ä¸€ç›´é™ªï¼Œä½†ä½ å«å®ƒæ—¶å®ƒä¼šçœ‹ä½ ä¸€çœ¼ï¼ˆä¸ä¸€å®šè¿‡æ¥ï¼‰","å¶å°”çªç„¶è¹­ä½ ä¸€ä¸‹ï¼Œè¹­å®Œå°±èµ°"],
      innerVsOuter:{inner:["æˆ‘è‡ªå·±å¾…ç€æŒºå¥½çš„ï¼Œä½ ä¸ç”¨ç®¡æˆ‘","ä½ å›æ¥äº†â€¦å—¯ï¼ŒæŒºå¥½","å…¶å®â€¦å¶å°”è¢«ä½ æ‘¸ä¸€ä¸‹è¿˜æŒºèˆ’æœçš„"],outer:["åœ¨è§’è½è¶´äº†ä¸€æ•´å¤©ï¼Œè°å«éƒ½ä¸åŠ¨","ä½ è¿›é—¨å®ƒæŠ¬å¤´çœ‹äº†ä¸€çœ¼åˆç»§ç»­è¶´ç€","è·¯è¿‡ä½ æ—¶çªç„¶è¹­äº†ä½ ä¸€ä¸‹ç„¶åç»§ç»­èµ°"]}
    },
    guide:{
      relationship:["ç»™è¶³ç©ºé—´ï¼Œåˆ«è¿½ç€å®ƒæŠ±","å®ƒä¸»åŠ¨æ¥æ‰¾ä½ çš„æ—¶å€™å¥½å¥½å›åº”"],
      feeding:["å®‰é™ç‹¬ç«‹çš„è¿›é£Ÿç©ºé—´","ä¸å–œæ¬¢è¢«ç›¯ç€åƒé¥­"],
      toys:["ç‹¬è‡ªèƒ½ç©çš„ç©å…·æœ€åˆé€‚â€”â€”çƒã€å¼¹ç°§é¼ ","äº’åŠ¨æ—¶ä¿æŒ'å†·é…·'é£æ ¼ï¼Œåˆ«å¤ªçƒ­æƒ…","ä¸éœ€è¦å¤ªå¤šç¤¾äº¤äº’åŠ¨"],
      emotion:["å®ƒçš„'ç‹¬å¤„'æ˜¯å……ç”µä¸æ˜¯å†·æˆ˜","å¶å°”çš„è¹­è¹­å°±æ˜¯å®ƒæœ€å¤§çš„å‘Šç™½"]
    }},
  "ISTJ": { name:"å‡†æ—¶é—¹é’Ÿå–µ", rarity:8, line:"ç¨³ã€å‡†ã€é è°±â€”â€”æŒ‰è§„çŸ©æ¥ï¼Œå®ƒæœ€èˆ’æœã€‚", tags:["è§„å¾‹è¾¾äºº","å®ˆåº","çœå¿ƒ"],
    monologue:"æ—©ä¸Šå…­ç‚¹åŠå‡†æ—¶å«ä½ èµ·åºŠä¸æ˜¯å› ä¸ºæˆ‘é¥¿äº†â€”â€”å¥½å§ä¹Ÿæ˜¯å› ä¸ºé¥¿äº†ã€‚ä½†æ›´é‡è¦çš„æ˜¯ä½ æ˜¨å¤©ä¹Ÿæ˜¯å…­ç‚¹åŠå–‚çš„ï¼Œå‰å¤©ä¹Ÿæ˜¯ã€‚æ—¢ç„¶å½¢æˆäº†è§„çŸ©ï¼Œå°±ä¸€å¤©ä¹Ÿä¸èƒ½å·®ã€‚",
    tips:["å›ºå®šè§„åˆ™+å›ºå®šèŠ‚å¥æ˜¯å®ƒçš„äººç”Ÿä¿¡æ¡","ç¯å¢ƒå˜åŒ–è¦ç»™å……è¶³çš„é€‚åº”æœŸ","å®ƒçš„'å‚¬ä¿ƒ'ä¸æ˜¯çƒ¦äººï¼Œæ˜¯åœ¨æ‰§è¡Œå®ƒè®¤å®šçš„è§„åˆ™"],
    bubbles:["ç¨³é‡","å¯é ","è§„å¾‹","è¸å®","è‡ªå¾‹","åšå®š"],
    profile:{
      traits:["ç¨³å®šå¯é æ˜¯å®ƒæœ€å¤§çš„æ ‡ç­¾","å¯¹è§„åˆ™å’Œç§©åºæœ‰å¤©ç”Ÿçš„å°Šé‡","ä½æ³¢åŠ¨çš„æƒ…ç»ªè®©ä½ æ ¼å¤–å®‰å¿ƒ"],
      behaviors:["æ¯å¤©åŒä¸€æ—¶é—´å«ä½ èµ·åºŠï¼Œè¯¯å·®ä¸è¶…è¿‡äº”åˆ†é’Ÿ","å›ºå®šåœ¨åŒä¸€ä¸ªä½ç½®ç¡è§‰ï¼ŒåŒä¸€ä¸ªä½ç½®åƒé¥­","ä¸ä¼šçªç„¶å‘ç–¯æˆ–åšå‡ºå‡ºæ ¼çš„äº‹â€”â€”è¡Œä¸ºé«˜åº¦å¯é¢„æµ‹"],
      innerVsOuter:{inner:["å…­ç‚¹åŠäº†ï¼Œè¯¥èµ·äº†ã€‚è¿™æ˜¯è§„çŸ©ã€‚","ä»Šå¤©çš„æµç¨‹è·Ÿæ˜¨å¤©ä¸€æ ·ï¼Œå¾ˆå¥½","è™½ç„¶æ—¥å­é‡å¤ï¼Œä½†æ¯å¤©æœ‰ä½ å°±å¾ˆå¥½"],outer:["å‡†æ—¶è·³ä¸ŠåºŠï¼Œæ‹ä½ çš„è„¸","åƒå®Œé¥­å»çª—å°è¶´ç€ï¼Œè·Ÿæ˜¨å¤©ä¸€æ¨¡ä¸€æ ·","æ¯å¤©æ™šä¸Šå›ºå®šæ—¶é—´èµ°åˆ°ä½ èº«è¾¹è¶´ä¸‹"]}
    },
    guide:{
      relationship:["ä¿æŒæ—¥å¸¸èŠ‚å¥ç¨³å®š","æ”¹å˜ä»»ä½•äº‹æƒ…éƒ½è¦å¾ªåºæ¸è¿›"],
      feeding:["å›ºå®šæ—¶é—´å›ºå®šåœ°ç‚¹å›ºå®šåˆ†é‡â€”â€”å®ƒçš„ç»ˆæå®‰å…¨æ„Ÿæ¥æº","æ‰“ä¹±èŠ‚å¥ä¼šè®©å®ƒç„¦è™‘"],
      toys:["è§„å¾‹æ€§çš„äº’åŠ¨â€”â€”æ¯å¤©å›ºå®šæ—¶é—´ç©ä¸€æ¬¡å°±å¥½","ä¸éœ€è¦èŠ±å“¨","ç®€å•é‡å¤çš„æ¸¸æˆå®ƒæœ€å–œæ¬¢"],
      emotion:["çªç„¶çš„å˜åŒ–æ˜¯å®ƒæœ€å¤§çš„å‹åŠ›æº","æ¬å®¶/æ¢ç¯å¢ƒç»™è¶³è¿‡æ¸¡æ—¶é—´"]
    }}
};

// è¿™é‡Œçš„ YOUR_TEST_LINK é»˜è®¤ç›´æ¥ç”¨å½“å‰é¡µé¢åœ°å€
const getTestLink = () => location.href.split('?')[0];

function start(){
  idx = 0;
  score = {E:0,I:0,S:0,N:0,T:0,F:0,J:0,P:0};
  isTransitioning = false;
  document.getElementById("hero").style.display = "none";
  document.getElementById("panel").style.display = "block";
  document.getElementById("statusTag").innerText = "æµ‹è¯•è¿›è¡Œä¸­";
  // éšè—è§£é”æ‚¬æµ®æ¡ï¼ˆç­”é¢˜è¿‡ç¨‹ä¸­ä¸æ˜¾ç¤ºï¼‰
  var unlockBar = document.getElementById('unlockBar');
  if (unlockBar) unlockBar.classList.remove('is-show');
  trackEvent('funnel', 'test_start', 'begin');
  renderQuestion(true);
}

function showDemo(){
  // ç›´æ¥è®¾ç½®çŠ¶æ€ï¼Œä¸è°ƒ start() é¿å…é—ªçƒ
  idx = 16;
  score = {E:3,I:1,S:1,N:3,T:1,F:3,J:1,P:3}; // æ¨¡æ‹Ÿ ENFP åˆ†æ•°ï¼Œç»´åº¦æ¡æ˜¾ç¤ºçœŸå®æ¯”ä¾‹
  finalType = "ENFP";
  isTransitioning = false;
  document.getElementById("hero").style.display = "none";
  document.getElementById("panel").style.display = "block";
  document.getElementById("statusTag").innerText = "ç¤ºä¾‹æ¨¡å¼";
  trackEvent('funnel', 'demo_viewed', 'ENFP');
  renderResult("ENFP");
}

const dimLabels = { EI:'ç¤¾äº¤èƒ½é‡', SN:'æ„ŸçŸ¥æ–¹å¼', TF:'å†³ç­–åå¥½', JP:'ç”Ÿæ´»æ–¹å¼' };
const dimEmoji = { EI:'ğŸ’¬', SN:'ğŸ‘€', TF:'ğŸ§ ', JP:'ğŸ“‹' };

function renderQuestion(animate){
  const q = questions[idx];
  trackEvent('funnel', 'question_reached', 'q' + (idx + 1), idx + 1);
  const panel = document.getElementById("panel");
  if(panel) panel.classList.remove("panel-result");
  const pct = Math.round(((idx)/questions.length)*100);
  document.getElementById("step").innerText = "é¢˜ç›®è¿›åº¦";
  document.getElementById("progress").innerText = `${idx+1}/${questions.length}`;
  setBar((idx)/questions.length);

  const dimClass = q.dim.toLowerCase();
  const dimLabel = dimLabels[q.dim] || '';
  const dimEm = dimEmoji[q.dim] || '';

  document.getElementById("content").innerHTML = `
    <div class="quiz-card ${animate ? 'quiz-enter' : ''}">
      <div class="dim-badge ${dimClass}">${dimEm} ${dimLabel}</div>
      <div class="q">${q.q}</div>
      <button class="opt" id="optA" onclick="choose('A')">A. ${q.A}</button>
      <button class="opt" id="optB" onclick="choose('B')">B. ${q.B}</button>
      <div class="progress-text">${pct}% å·²å®Œæˆ Â· è¿˜å‰© ${questions.length - idx} é¢˜</div>
    </div>
  `;
}


function choose(which){
  if(isTransitioning) return;
  isTransitioning = true;

  const q = questions[idx];
  const s = (which === "A") ? q.scoreA : q.scoreB;
  Object.keys(s).forEach(k => score[k] += s[k]);

  // é€‰ä¸­åé¦ˆ
  const btn = document.getElementById(which === 'A' ? 'optA' : 'optB');
  if(btn) btn.classList.add('opt-selected');

  // å»¶è¿Ÿååˆ‡é¢˜
  setTimeout(()=>{
    const card = document.querySelector('.quiz-card');
    if(card) card.classList.add('quiz-exit');

    setTimeout(()=>{
      idx += 1;
      if(idx >= questions.length){
        // ä»ªå¼æ„ŸåŠ è½½ï¼šåˆ†é˜¶æ®µå±•ç¤ºè¶£å‘³æ–‡æ¡ˆ
        finalType = calcType();
        const loadingTexts = [
          { text: "æ­£åœ¨è§£è¯» TA çš„å†…å¿ƒä¸–ç•Œ...", sub: "ç»¼åˆ " + questions.length + " é“é¢˜ç›®æ·±åº¦åˆ†æ" },
          { text: "æ­£åœ¨åŒ¹é…æ€§æ ¼æ¡£æ¡ˆ...", sub: "åœ¨ 16 ç§æ€§æ ¼ä¸­å¯»æ‰¾ TA çš„ä½ç½®" },
          { text: "æŠ¥å‘Šç”Ÿæˆä¸­...", sub: "å³å°†æ­æ™“ TA çš„éšè—äººæ ¼ âœ¨" }
        ];
        let loadingStep = 0;
        const contentEl = document.getElementById("content");
        function showLoadingStep() {
          const t = loadingTexts[loadingStep];
          contentEl.innerHTML = '<div class="calc-loading"><div class="calc-spinner"></div><div class="calc-text">' + t.text + '</div><div class="calc-sub">' + t.sub + '</div></div>';
        }
        showLoadingStep();
        const loadingInterval = setInterval(()=>{
          loadingStep++;
          if (loadingStep < loadingTexts.length) {
            showLoadingStep();
          } else {
            clearInterval(loadingInterval);
            // æ£€æŸ¥æ˜¯å¦å·²æœ‰å¤´åƒ
            const hasCustomAvatar = (function(){
              try { return !!localStorage.getItem(AVATAR_KEY); } catch(e){ return false; }
            })();
            if (hasCustomAvatar) avatarUploaded = true;
            // ç›´æ¥å±•ç¤ºç»“æœé¡µï¼Œä¸å†å¼¹å¤´åƒå¼•å¯¼
            renderResult(finalType);
            isTransitioning = false;
          }
        }, 900);
      }else{
        renderQuestion(true);
        isTransitioning = false;
      }
    }, 150);
  }, 150);
}

function calcType(){
  const EI = (score.E >= score.I) ? "E" : "I";
  const SN = (score.S >= score.N) ? "S" : "N";
  const TF = (score.T >= score.F) ? "T" : "F";
  const JP = (score.J >= score.P) ? "J" : "P";
  return EI+SN+TF+JP;
}

const subTitles = {
  E: "æ®è¯´è¿™ç§çŒ«å’ªåœ¨ç¾¤é‡Œæœ€å—æ¬¢è¿ğŸ˜†",
  I: "å¤–å†·å†…çƒ­çš„å°ç”œå¿ƒå°±æ˜¯å®ƒå§âœ¨",
  S: "ç¨³é‡å¯é çš„å±…å®¶å°å«å£«ğŸ±",
  N: "è„‘å›è·¯æ¸…å¥‡çš„æœºçµé¬¼æœ¬é¬¼ğŸ§ "
};


function getAvatar(){
  try{ return localStorage.getItem(AVATAR_KEY) || DEFAULT_AVATAR; }
  catch(e){ return DEFAULT_AVATAR; }
}

function applyAvatar(){
  const avatarUrl = getAvatar();
  const img = document.getElementById("avatarImg");
  const imgPoster = document.getElementById("avatarImgPoster");
  const imgPosterFree = document.getElementById("avatarImgPosterFree");
  if(img) img.src = avatarUrl;
  if(imgPoster) imgPoster.src = avatarUrl;
  if(imgPosterFree) imgPosterFree.src = avatarUrl;
}

function openAvatarPicker(){
  const input = document.getElementById("avatarInput");
  if(input){ input.value = ""; input.click(); }
}

function clickAvatar(){
  openAvatarPicker();
}

function handleAvatarChange(e){
  const file = e.target.files && e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(ev){
    const img = new Image();
    img.onload = function(){
      try {
        // å±…ä¸­è£åˆ‡ä¸ºæ­£æ–¹å½¢ 200x200ï¼ŒJPEG 0.8 è´¨é‡ï¼ˆçº¦ 10-30KBï¼‰
        const canvas = document.createElement('canvas');
        const SIZE = 200;
        canvas.width = SIZE; canvas.height = SIZE;
        const min = Math.min(img.width, img.height);
        const sx = (img.width - min) / 2;
        const sy = (img.height - min) / 2;
        canvas.getContext('2d').drawImage(img, sx, sy, min, min, 0, 0, SIZE, SIZE);
        const compressed = canvas.toDataURL('image/jpeg', 0.8);
        try { localStorage.setItem(AVATAR_KEY, compressed); }
        catch(storageErr) { console.warn('localStorage full, avatar in memory only'); }
        avatarUploaded = true;
        // ç›´æ¥åº”ç”¨å‹ç¼©åçš„å¤´åƒ
        const avatarImg = document.getElementById("avatarImg");
        const avatarImgPoster = document.getElementById("avatarImgPoster");
        if(avatarImg) avatarImg.src = compressed;
        if(avatarImgPoster) avatarImgPoster.src = compressed;
        // æ¸…é™¤å¤´åƒæé†’å¡ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        const remindContainer = document.getElementById("avatarRemindContainer");
        if(remindContainer) remindContainer.innerHTML = "";
        // æ£€æŸ¥å…¨å±æµ·æŠ¥æ˜¯å¦å·²æ‰“å¼€ï¼Œè‹¥æ‰“å¼€åˆ™åˆ·æ–°
        const fsPoster = document.getElementById("posterFullscreen");
        if(fsPoster && fsPoster.classList.contains("is-show")){
          savePoster({ autoDownload:false, showLoadingToast:false, showSuccessToast:true, refreshOnly:true });
        } else if(_fromRemindCard){
          // ä»æé†’å¡ä¸Šä¼ å¤´åƒåï¼Œè‡ªåŠ¨ç”Ÿæˆæµ·æŠ¥
          _fromRemindCard = false;
          savePoster();
        }
      } catch(compressErr) {
        console.error('Avatar compression failed:', compressErr);
        toast("å¤´åƒå¤„ç†å¤±è´¥ï¼Œè¯·æ¢ä¸€å¼ è¯•è¯•");
      }
    };
    img.onerror = function(){ toast("å¤´åƒåŠ è½½å¤±è´¥ï¼Œè¯·æ¢ä¸€å¼ å›¾ç‰‡"); };
    img.src = ev.target.result;
  };
  reader.onerror = function(){ toast("æ–‡ä»¶è¯»å–å¤±è´¥"); };
  reader.readAsDataURL(file);
}

/* ==========================================
 * å¤´åƒå¼•å¯¼é¡µï¼ˆç­”é¢˜å®Œæˆå â†’ ç»“æœé¡µä¹‹å‰ï¼‰
 * ========================================== */
function renderAvatarPrompt(type) {
  trackEvent('avatar', 'avatar_prompt_shown', type);
  document.getElementById("content").innerHTML = `
    <div class="avatar-prompt">
      <div class="avatar-prompt-title">ğŸ‰ åˆ†æå®Œæˆï¼</div>
      <div class="avatar-prompt-circle" id="avatarPromptCircle" onclick="avatarPromptUpload()">
        <div class="prompt-placeholder">
          <span class="camera-icon">ğŸ“·</span>
          <span>ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡</span>
        </div>
        <img id="avatarPromptImg" alt="é¢„è§ˆ" />
        <div class="check-mark">âœ“</div>
      </div>
      <input id="avatarPromptInput" type="file" accept="image/*" style="display:none" onchange="handleAvatarPromptChange(event)" />
      <div class="avatar-prompt-desc">
        ä¸Šä¼ ä½ å®¶çŒ«ä¸»å­çš„ç…§ç‰‡<br/>è®©ç»“æœå¡æ›´æœ‰ä¸“å±æ„Ÿ âœ¨
      </div>
      <button class="avatar-prompt-btn" id="avatarPromptBtn" onclick="avatarPromptContinue()">ä¸Šä¼ ç…§ç‰‡ï¼Œç”Ÿæˆä¸“å±å¡</button>
      <button class="avatar-prompt-skip" onclick="avatarPromptSkip()">å…ˆè·³è¿‡ï¼Œç›´æ¥çœ‹ç»“æœ</button>
    </div>
  `;
}

function avatarPromptUpload() {
  const input = document.getElementById("avatarPromptInput");
  if (input) { input.value = ""; input.click(); }
}

function handleAvatarPromptChange(e) {
  const file = e.target.files && e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(ev) {
    const img = new Image();
    img.onload = function() {
      try {
        // å±…ä¸­è£åˆ‡ä¸ºæ­£æ–¹å½¢ 200x200, JPEG 0.8
        const canvas = document.createElement('canvas');
        const SIZE = 200;
        canvas.width = SIZE; canvas.height = SIZE;
        const min = Math.min(img.width, img.height);
        const sx = (img.width - min) / 2;
        const sy = (img.height - min) / 2;
        canvas.getContext('2d').drawImage(img, sx, sy, min, min, 0, 0, SIZE, SIZE);
        const compressed = canvas.toDataURL('image/jpeg', 0.8);
        try { localStorage.setItem(AVATAR_KEY, compressed); }
        catch(storageErr) { console.warn('localStorage full, avatar in memory only'); }

        avatarUploaded = true;

        // æ›´æ–°å¼•å¯¼é¡µé¢„è§ˆ
        const circle = document.getElementById("avatarPromptCircle");
        const previewImg = document.getElementById("avatarPromptImg");
        if (circle) circle.classList.add("has-photo");
        if (previewImg) { previewImg.src = compressed; previewImg.style.display = "block"; }

        // æŒ‰é’®æ–‡æ¡ˆå˜æ›´
        const btn = document.getElementById("avatarPromptBtn");
        if (btn) btn.textContent = "æŸ¥çœ‹æˆ‘çš„ä¸“å±ç»“æœ ğŸ¾";

        trackEvent('avatar', 'avatar_uploaded', 'prompt_page');
      } catch(err) {
        console.error('Avatar prompt compression failed:', err);
        toast("å¤´åƒå¤„ç†å¤±è´¥ï¼Œè¯·æ¢ä¸€å¼ è¯•è¯•");
      }
    };
    img.onerror = function() { toast("å¤´åƒåŠ è½½å¤±è´¥ï¼Œè¯·æ¢ä¸€å¼ å›¾ç‰‡"); };
    img.src = ev.target.result;
  };
  reader.onerror = function() { toast("æ–‡ä»¶è¯»å–å¤±è´¥"); };
  reader.readAsDataURL(file);
}

function avatarPromptContinue() {
  // å¦‚æœè¿˜æ²¡ä¸Šä¼ ç…§ç‰‡ï¼Œç‚¹ä¸»æŒ‰é’®ä¹Ÿè§¦å‘æ–‡ä»¶é€‰æ‹©
  if (!avatarUploaded) {
    avatarPromptUpload();
    return;
  }
  renderResult(finalType);
}

function avatarPromptSkip() {
  trackEvent('avatar', 'avatar_prompt_skip', finalType);
  renderResult(finalType);
}

/* ==========================================
 * æ¨¡å—åŒ–æ„å»ºå‡½æ•°
 * ========================================== */

// æ„å»ºæƒ…ç»ªæ³¡æ³¡å›¾ HTML
function buildEmotionBubbles(r) {
  const layout = [
    { size:'lg', x:-65, y:-45, color:'#FF6B81', delay:'0s' },
    { size:'md', x:58, y:-52, color:'#FFD666', delay:'0.3s' },
    { size:'sm', x:75, y:22, color:'#7ED9A6', delay:'0.6s' },
    { size:'md', x:-55, y:38, color:'#C4A6FF', delay:'0.9s' },
    { size:'sm', x:5, y:68, color:'#8CC8FF', delay:'1.2s' },
    { size:'lg', x:12, y:-72, color:'#FFB074', delay:'0.5s' },
    { size:'sm', x:-70, y:-5, color:'#FF6B81', delay:'0.8s' },
  ];
  return (r.bubbles||[]).slice(0,7).map((b,i) => {
    const l = layout[i] || layout[0];
    return `<span class="bubble bubble-${l.size}" style="--x:${l.x}px;--y:${l.y}px;--color:${l.color};--delay:${l.delay}">${b}</span>`;
  }).join("");
}

// æ„å»ºç»´åº¦æ¡å½¢å›¾ HTML
function buildDimensionRows(score) {
  const config = [
    { left:'E å¤–å‘', right:'å†…å‘ I', lKey:'E', rKey:'I', lColor:'#FF6B81', rColor:'#C4A6FF', label:'ç¤¾äº¤èƒ½é‡' },
    { left:'S å®æ„Ÿ', right:'ç›´è§‰ N', lKey:'S', rKey:'N', lColor:'#FFB074', rColor:'#8CC8FF', label:'æ„ŸçŸ¥æ–¹å¼' },
    { left:'T ç†æ€§', right:'æ„Ÿæ€§ F', lKey:'T', rKey:'F', lColor:'#7ED9A6', rColor:'#FFD666', label:'å†³ç­–åå¥½' },
    { left:'J è®¡åˆ’', right:'éšæ€§ P', lKey:'J', rKey:'P', lColor:'#FF6B81', rColor:'#7ED9A6', label:'ç”Ÿæ´»æ–¹å¼' },
  ];
  return config.map(d => {
    const total = score[d.lKey] + score[d.rKey];
    const lPct = total === 0 ? 50 : Math.round((score[d.lKey]/total)*100);
    const rPct = 100 - lPct;
    return `<div class="dim-title-label">${d.label}</div>
      <div class="dim-row">
        <span class="dim-label dim-left">${d.left}</span>
        <div class="dim-bar-track">
          <div class="dim-bar-fill" style="width:${lPct}%;--bar-color:${d.lColor}">${lPct}%</div>
          <div class="dim-bar-fill" style="width:${rPct}%;--bar-color:${d.rColor}">${rPct}%</div>
        </div>
        <span class="dim-label dim-right">${d.right}</span>
      </div>`;
  }).join("");
}

// æ„å»ºæ€§æ ¼ç”»åƒ HTML ç‰‡æ®µ
function buildPersonaSections(r) {
  return {
    traitsHtml: (r.profile?.traits||[]).map(t => `<li>${t}</li>`).join(""),
    behaviorsHtml: (r.profile?.behaviors||[]).map(t => `<li>${t}</li>`).join(""),
    vsInner: r.profile?.innerVsOuter?.inner || [],
    vsOuter: r.profile?.innerVsOuter?.outer || []
  };
}

// æ„å»ºä¸»äººæŒ‡å— HTML
function buildGuideSections(r) {
  const data = [
    { icon:'ğŸ¤', title:'å¦‚ä½•ç›¸å¤„', items: r.guide?.relationship || [] },
    { icon:'ğŸ–', title:'å–‚å…»æŒ‡å—', items: r.guide?.feeding || [] },
    { icon:'ğŸ¾', title:'ç©å…·ä¸äº’åŠ¨', items: r.guide?.toys || [] },
    { icon:'ğŸ’›', title:'æƒ…ç»ªä¸å¿ƒç†', items: r.guide?.emotion || [] },
  ];
  return data.map(g => {
    const lis = g.items.map(i => `<li>${i}</li>`).join("");
    return `<div class="guide-card"><div class="guide-title">${g.icon} ${g.title}</div><ul>${lis}</ul></div>`;
  }).join("");
}

// æ„å»ºæµ·æŠ¥æ³¡æ³¡ HTML
function buildPosterBubbles(r) {
  const colors = ['#FF6B81','#FFD666','#7ED9A6','#C4A6FF','#8CC8FF','#FFB074'];
  const layout = [
    { size:'lg', left:'18px',  top:'22px' },
    { size:'lg', left:'96px',  top:'0px' },
    { size:'md', left:'178px', top:'16px' },
    { size:'md', left:'32px',  top:'108px' },
    { size:'sm', left:'110px', top:'118px' },
    { size:'md', left:'168px', top:'100px' },
  ];
  return (r.bubbles||[]).slice(0,6).map((b,i) => {
    const p = layout[i];
    return `<span class="p-bubble p-bubble-${p.size}" style="background:${colors[i]};left:${p.left};top:${p.top}">${b}</span>`;
  }).join("");
}

// æ„å»ºæµ·æŠ¥ç»´åº¦æ¡ HTML
function buildPosterDimRows(score) {
  const config = [
    { left:'E', right:'I', lKey:'E', rKey:'I', lColor:'#FF6B81', rColor:'#C4A6FF' },
    { left:'S', right:'N', lKey:'S', rKey:'N', lColor:'#FFB074', rColor:'#8CC8FF' },
    { left:'T', right:'F', lKey:'T', rKey:'F', lColor:'#7ED9A6', rColor:'#FFD666' },
    { left:'J', right:'P', lKey:'J', rKey:'P', lColor:'#FF6B81', rColor:'#7ED9A6' },
  ];
  return config.map(d => {
    const total = score[d.lKey] + score[d.rKey];
    const lPct = total === 0 ? 50 : Math.round((score[d.lKey]/total)*100);
    const rPct = 100 - lPct;
    return `<div class="p-dim-row">
      <span class="p-dim-label p-dim-left">${d.left}</span>
      <div class="p-dim-track">
        <div class="p-dim-fill" style="width:${lPct}%;background:${d.lColor}">${lPct}%</div>
        <div class="p-dim-fill" style="width:${rPct}%;background:${d.rColor}">${rPct}%</div>
      </div>
      <span class="p-dim-label p-dim-right">${d.right}</span>
    </div>`;
  }).join("");
}

/* ==========================================
 * ç»“æœé¡µæ¸²æŸ“ï¼ˆç»„åˆæ¨¡å—åŒ–å‡½æ•°ï¼‰
 * ========================================== */
function renderResult(type){
  var r = results[type];
  if (!r) {
    console.error('Result type not found:', type, '- falling back to ENFP');
    r = results["ENFP"];
    type = "ENFP";
    setTimeout(function(){ toast("ç»“æœåŒ¹é…å¼‚å¸¸ï¼Œå·²æ˜¾ç¤ºé»˜è®¤ç»“æœ"); }, 500);
  }
  finalType = type;
  trackEvent('funnel', 'test_complete', type);
  document.getElementById("statusTag").innerText = "å·²å‡ºç»“æœ";
  document.getElementById("step").innerText = "æµ‹è¯•å®Œæˆ";
  document.getElementById("progress").innerText = "";
  setBar(1);

  // ä½¿ç”¨æ¨¡å—åŒ–å‡½æ•°æ„å»ºå„åŒºå—
  const tipsHtml = r.tips.slice(0, 3).map(t=>`<li>${t}</li>`).join("");
  const tagsHtml = r.tags.map(t=>`<span class="tag">${t}</span>`).join("");
  const bubblesHtml = buildEmotionBubbles(r);
  const dimHtml = buildDimensionRows(score);
  const persona = buildPersonaSections(r);
  const guideHtml = buildGuideSections(r);
  const posterBubblesHtml = buildPosterBubbles(r);
  const posterDimHtml = buildPosterDimRows(score);

  const panel = document.getElementById("panel");
  if(panel) panel.classList.add("panel-result");

  document.getElementById("content").innerHTML = `
    <div class="page">
      <div class="result-card">
        <div class="result-title">æµ‹è¯•ç»“æœ</div>

        <div class="avatar-wrap">
            <div class="avatar-circle" style="border-color:${typeColors[type]||'#FF6B81'}" onclick="clickAvatar()">
                <img id="avatarImg" alt="å¤´åƒ" />
                <div class="avatar-camera-badge">ğŸ“·</div>
            </div>
            <input id="avatarInput" type="file" accept="image/*" style="display:none" onchange="handleAvatarChange(event)" />
        </div>

        <div class="result-type" style="color:${typeColors[type]||'#FF6B81'}">${type}</div>
        <div class="result-name">${r.name}</div>
        <div class="result-line">"${r.line}"</div>
        <div class="result-rarity">ğŸ± ä½ å®¶çŒ«ä¸»å­å±äº ${type} å‹ï¼Œä»…å æ‰€æœ‰æµ‹è¯•çŒ«å’ªçš„ ${r.rarity}%</div>

        <div class="result-tags">${tagsHtml}</div>

        <!-- ç»´åº¦æ¡å½¢å›¾ï¼ˆå…è´¹å±•ç¤ºï¼‰ -->
        <div class="dim-section">
          <div class="section-title">ç»´åº¦åˆ†æ</div>
          ${dimHtml}
        </div>

        <!-- å†…å¿ƒç‹¬ç™½ï¼ˆå…è´¹å±•ç¤ºï¼‰ -->
        <div class="monologue-card">
          <div class="monologue-label">TAçš„å†…å¿ƒç‹¬ç™½</div>
          <div class="monologue-text">"${r.monologue}"</div>
        </div>

        <!-- å¿ƒç† vs å¤–åœ¨ï¼ˆå…è´¹å±•ç¤ºï¼‰ -->
        <div class="vs-card">
          <div class="sub-title" style="font-size:15px;font-weight:800;color:#2D2A26;margin-bottom:12px;">ğŸ­ å¿ƒç†æƒ³çš„ vs å¤–è¡¨è¡¨ç°çš„</div>
          ${(Array.isArray(persona.vsInner) ? persona.vsInner : [persona.vsInner]).map((inner, i) => {
            const outer = Array.isArray(persona.vsOuter) ? persona.vsOuter[i] : persona.vsOuter;
            return `<div class="vs-row" ${i > 0 ? 'style="margin-top:10px;padding-top:10px;border-top:1px dashed #E8E0D8;"' : ''}>
            <div class="vs-col">
              ${i === 0 ? '<div class="vs-label">å†…å¿ƒä¸–ç•Œ</div>' : ''}
              <div class="vs-text">${inner || ''}</div>
            </div>
            <div class="vs-divider"></div>
            <div class="vs-col">
              ${i === 0 ? '<div class="vs-label">å¤–åœ¨è¡¨ç°</div>' : ''}
              <div class="vs-text">${outer || ''}</div>
            </div>
          </div>`;
          }).join('')}
        </div>

        <!-- ===== è§£é”åˆ†å‰²çº¿ ===== -->
        <div class="lock-divider">
          <div class="lock-divider-line"></div>
          <div class="lock-divider-text">ğŸ”’ ä»¥ä¸‹ä¸ºå®Œæ•´æŠ¥å‘Šå†…å®¹</div>
          <div class="lock-divider-line"></div>
        </div>

        <!-- ğŸ”’ æƒ…ç»ªæ³¡æ³¡å›¾ï¼ˆåŠ é®ç½©ï¼‰ -->
        <div class="locked-section">
          <div class="lock-overlay" onclick="showUnlockModal()">
            <div class="lock-icon">ğŸ”’</div>
            <div class="lock-text">åŠ ä¼å¾®å…è´¹è§£é”</div>
          </div>
          <div class="lock-content">
            <div class="bubble-section">
              <div class="section-title">å®ƒçš„æƒ…ç»ªæ³¡æ³¡</div>
              <div class="bubble-chart">
                <div class="bubble-container">
                  ${bubblesHtml}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ğŸ”’ è¯¦ç»†æ€§æ ¼ç”»åƒï¼ˆåŠ é®ç½©ï¼‰ -->
        <div class="locked-section">
          <div class="lock-overlay" onclick="showUnlockModal()">
            <div class="lock-icon">ğŸ”’</div>
            <div class="lock-text">åŠ ä¼å¾®å…è´¹è§£é”</div>
          </div>
          <div class="lock-content">
            <div class="profile-section">
              <div class="section-title">æ€§æ ¼ç”»åƒ</div>
              <div class="profile-card">
                <div class="sub-title">âœ¨ ä»£è¡¨ç‰¹ç‚¹</div>
                <ul>${persona.traitsHtml}</ul>
              </div>
              <div class="profile-card">
                <div class="sub-title">ğŸ¾ è¡Œä¸ºè¡¨ç°</div>
                <ul>${persona.behaviorsHtml}</ul>
              </div>
            </div>
          </div>
        </div>

        <!-- ğŸ”’ ä¸»äººæŒ‡å—ï¼ˆåŠ é®ç½©ï¼‰ -->
        <div class="locked-section">
          <div class="lock-overlay" onclick="showUnlockModal()">
            <div class="lock-icon">ğŸ”’</div>
            <div class="lock-text">åŠ ä¼å¾®å…è´¹è§£é”</div>
          </div>
          <div class="lock-content">
            <div class="guide-section">
              <div class="section-title">ä¸»äººæŒ‡å—</div>
              <div class="tips-card" style="margin-bottom:14px;">
                <div class="sub-title">âš¡ å¿«é€Ÿè¦ç‚¹</div>
                <ul>${tipsHtml}</ul>
              </div>
              ${guideHtml}
            </div>
          </div>
        </div>

        <div class="hr"></div>

        <!-- æµ·æŠ¥å¡ï¼ˆè±ªåç‰ˆï¼‰ï¼š9:16é•¿å›¾ 540x960 -->
        <div id="resultCard" class="poster">
          <div class="poster-brand">èŒå® è”èŒ Â· çŒ«å’ªMBTI</div>
          <div class="p-avatar"><img id="avatarImgPoster" alt="å¤´åƒ" /></div>
          <div class="p-type" style="color:${typeColors[type]||'#FF6B81'}">${type}</div>
          <div class="p-name">${r.name}</div>
          <div class="p-line">"${r.line}"</div>
          <div class="p-rarity">ğŸ¾ ä»…å æ‰€æœ‰æµ‹è¯•çŒ«å’ªçš„ ${r.rarity}%</div>
          <div class="p-monologue">"${r.monologue.length > 30 ? r.monologue.substring(0, 30) + '...' : r.monologue}"</div>
          <div class="p-tags">${r.tags.map(t=>'<span class="p-tag">'+t+'</span>').join('')}</div>
          <div class="p-section-title">å®ƒçš„æƒ…ç»ªæ³¡æ³¡</div>
          <div class="p-bubbles">${posterBubblesHtml}</div>
          <div class="p-section-title">ç»´åº¦åˆ†æ</div>
          <div class="p-dims">${posterDimHtml}</div>
          <div class="p-footer">
            <div class="p-footer-text">
              <div class="p-footer-title">æ‰«ç æµ‹æµ‹ä½ å®¶çŒ«ä¸»å­</div>
              <div class="p-footer-sub">1åˆ†é’Ÿå‡ºç»“æœ Â· 16ç§æ€§æ ¼</div>
            </div>
            <div class="p-footer-qr" id="posterQrCode"></div>
          </div>
        </div>

        <!-- æµ·æŠ¥å¡ï¼ˆå…è´¹ç‰ˆ/ç²¾ç®€ç‰ˆï¼‰ï¼š9:16é•¿å›¾ 540x960 -->
        <div id="resultCardFree" class="poster poster-free">
          <div class="poster-brand">èŒå® è”èŒ Â· çŒ«å’ªMBTI</div>
          <div class="pf-spacer-top"></div>
          <div class="p-avatar"><img id="avatarImgPosterFree" alt="å¤´åƒ" /></div>
          <div class="pf-spacer"></div>
          <div class="p-type" style="color:${typeColors[type]||'#FF6B81'}">${type}</div>
          <div class="p-name">${r.name}</div>
          <div class="pf-spacer"></div>
          <div class="p-line">"${r.line}"</div>
          <div class="pf-spacer-sm"></div>
          <div class="p-rarity">ğŸ¾ ä»…å æ‰€æœ‰æµ‹è¯•çŒ«å’ªçš„ ${r.rarity}%</div>
          <div class="pf-spacer"></div>
          <div class="p-tags">${r.tags.map(t=>'<span class="p-tag">'+t+'</span>').join('')}</div>
          <div class="pf-spacer-lg"></div>
          <div class="pf-unlock-hint">
            <div class="pf-unlock-icon">ğŸ”“</div>
            <div class="pf-unlock-text">æ‰«ç è§£é”å®Œæ•´æ€§æ ¼æŠ¥å‘Š</div>
            <div class="pf-unlock-sub">å«æƒ…ç»ªæ³¡æ³¡ Â· ç»´åº¦åˆ†æ Â· ä¸»äººæŒ‡å—</div>
          </div>
          <div class="p-footer">
            <div class="p-footer-text">
              <div class="p-footer-title">æ‰«ç æµ‹æµ‹ä½ å®¶çŒ«ä¸»å­</div>
              <div class="p-footer-sub">1åˆ†é’Ÿå‡ºç»“æœ Â· 16ç§æ€§æ ¼</div>
            </div>
            <div class="p-footer-qr" id="posterQrCodeFree"></div>
          </div>
        </div>

        <div id="avatarRemindContainer"></div>
        <div class="btns">
          <button class="btn-primary" id="posterBtn" onclick="handleGeneratePoster()">ç”Ÿæˆç»“æœå›¾</button>
        </div>

        <div class="btns">
          <button class="btn-ghost" onclick="start()">é‡æ–°æµ‹è¯•</button>
        </div>

        <div class="community-card">
          <div style="font-weight:900; color:var(--pri); font-size:15px; margin-bottom:4px;">ğŸ å…è´¹é¢†å–ä¸“å±å…»æŠ¤æ‰‹å†Œ</div>
          <div class="muted" style="font-size:12px; margin-bottom:12px;">åŠ ä¼å¾®é¢†å–å…»æŠ¤æ‰‹å†Œ + è¿›åŒå“ç§åŒæ€§æ ¼äº¤æµç¾¤</div>
          <div class="btns" style="margin-top:0;">
            <button class="btn-primary" onclick="trackEvent('funnel','wecom_button_clicked',finalType||'unknown');showWecomModal()">ç«‹å³é¢†å–</button>
          </div>
        </div>
        <!-- åº•éƒ¨é—´è·ï¼Œé˜²æ­¢è¢«æ‚¬æµ®è§£é”æ¡é®æŒ¡ -->
        <div style="height:70px;"></div>
      </div>
    </div>
  `;





  // å¤´åƒæ¸²æŸ“
  applyAvatar();

  // æ¸²æŸ“äºŒç»´ç 
  renderQRCode(getTestLink());

  // æµ·æŠ¥åº•éƒ¨äºŒç»´ç åŠ¨æ€ç”Ÿæˆï¼ˆè±ªåç‰ˆ+å…è´¹ç‰ˆï¼‰
  var _qrConfig = {
    text: getTestLink(),
    width: 72,
    height: 72,
    colorDark: "#1a1a1a",
    colorLight: "#ffffff",
    correctLevel: QRCode.Level ? QRCode.Level.H : 3
  };
  var posterQrContainer = document.getElementById('posterQrCode');
  if (posterQrContainer && typeof QRCode !== 'undefined') {
    posterQrContainer.innerHTML = '';
    new QRCode(posterQrContainer, _qrConfig);
  }
  var posterQrContainerFree = document.getElementById('posterQrCodeFree');
  if (posterQrContainerFree && typeof QRCode !== 'undefined') {
    posterQrContainerFree.innerHTML = '';
    new QRCode(posterQrContainerFree, _qrConfig);
  }

  // æ£€æŸ¥è§£é”çŠ¶æ€ + æ›´æ–°æµ·æŠ¥æŒ‰é’®æ–‡æ¡ˆ
  checkAndApplyUnlockState();
  updatePosterBtnText();
}


function showWecomModal() {
  const typeLabel = document.getElementById("wecomTypeLabel");
  if(typeLabel) typeLabel.innerText = finalType || "çŒ«å’ªæ€§æ ¼";
  document.getElementById("wecomModal").style.display = "flex";
  trackEvent('funnel', 'wecom_modal_shown', finalType || 'unknown');
}

/* ===== æµ·æŠ¥å…¨å±é¢„è§ˆæ§åˆ¶ ===== */
function closePosterFullscreen() {
  const fs = document.getElementById("posterFullscreen");
  if (fs) fs.classList.remove("is-show");
}

function posterFsChangeAvatar() {
  openAvatarPicker();
}

// ç‚¹å‡»é®ç½©ç©ºç™½åŒºåŸŸå…³é—­
(function(){
  var fs = document.getElementById("posterFullscreen");
  if (fs) {
    fs.addEventListener("click", function(e) {
      if (e.target === fs) closePosterFullscreen();
    });
  }
})();

function closeWecomModal() {
  document.getElementById("wecomModal").style.display = "none";
}

document.addEventListener("click", function(e){
  const mask = document.getElementById("wecomModal");
  if(mask && e.target === mask) closeWecomModal();
});

/* ==========================================
 * å†…å®¹è§£é”ç³»ç»Ÿ
 * ========================================== */

// æ£€æŸ¥å¹¶åº”ç”¨è§£é”çŠ¶æ€
function checkAndApplyUnlockState() {
  let isUnlocked = false;
  try { isUnlocked = localStorage.getItem(UNLOCK_KEY) === 'true'; } catch(e) {}

  const resultCard = document.querySelector('.result-card');
  const unlockBar = document.getElementById('unlockBar');

  if (isUnlocked) {
    // å·²è§£é”ï¼šå»æ‰æ‰€æœ‰é®ç½©
    if (resultCard) resultCard.classList.add('unlocked');
    if (unlockBar) unlockBar.classList.remove('is-show');
  } else {
    // æœªè§£é”ï¼šæ˜¾ç¤ºé®ç½©å’Œåº•éƒ¨æ‚¬æµ®æ¡
    if (resultCard) resultCard.classList.remove('unlocked');
    if (unlockBar) unlockBar.classList.add('is-show');
  }
}

// æ˜¾ç¤ºè§£é”å¼¹çª—ï¼ˆå§‹ç»ˆä»ç¬¬ä¸€å±å¼€å§‹ï¼‰
function showUnlockModal() {
  const modal = document.getElementById('unlockModal');
  if (!modal) return;

  // é‡ç½®ä¸ºç¬¬ä¸€å±
  var s1 = document.getElementById('unlockScreen1');
  var s2 = document.getElementById('unlockScreen2');
  if (s1) s1.style.display = '';
  if (s2) s2.style.display = 'none';

  modal.classList.add('is-show');

  // éšè—å€’è®¡æ—¶ï¼Œç«‹å³æ˜¾ç¤ºä¸¤ä¸ªæŒ‰é’®
  var countdownWrap = document.getElementById('unlockCountdown');
  var confirmBtn = document.getElementById('unlockConfirmBtn');
  var skipBtn = document.getElementById('unlockSkip');
  if (countdownWrap) countdownWrap.style.display = 'none';
  if (confirmBtn) confirmBtn.classList.add('is-show');
  if (skipBtn) skipBtn.classList.add('is-show');

  trackEvent('funnel', 'unlock_modal_shown', finalType || 'unknown');
}

// ç‚¹å‡»"æš‚æ—¶è·³è¿‡"â†’ åˆ‡æ¢åˆ°ç¬¬äºŒå±
function showUnlockScreen2() {
  if (unlockCountdownTimer) {
    clearTimeout(unlockCountdownTimer);
    unlockCountdownTimer = null;
  }
  var s1 = document.getElementById('unlockScreen1');
  var s2 = document.getElementById('unlockScreen2');
  if (s1) s1.style.display = 'none';
  if (s2) s2.style.display = '';
  trackEvent('funnel', 'unlock_skip_to_screen2', finalType || 'unknown');
}

// å…³é—­è§£é”å¼¹çª—
function closeUnlockModal() {
  var modal = document.getElementById('unlockModal');
  if (modal) modal.classList.remove('is-show');
  if (unlockCountdownTimer) {
    clearTimeout(unlockCountdownTimer);
    unlockCountdownTimer = null;
  }
}

// ç‚¹å‡»é®ç½©å…³é—­è§£é”å¼¹çª—
document.addEventListener("click", function(e){
  const mask = document.getElementById("unlockModal");
  if(mask && e.target === mask) closeUnlockModal();
});

// ç¡®è®¤è§£é”
function confirmUnlock() {
  // ä¿å­˜è§£é”çŠ¶æ€
  try { localStorage.setItem(UNLOCK_KEY, 'true'); } catch(e) {}

  // å…³é—­å¼¹çª—
  closeUnlockModal();

  // åº”ç”¨è§£é”æ•ˆæœ
  const resultCard = document.querySelector('.result-card');
  const unlockBar = document.getElementById('unlockBar');
  if (resultCard) resultCard.classList.add('unlocked');
  if (unlockBar) unlockBar.classList.remove('is-show');

  // æ›´æ–°æµ·æŠ¥æŒ‰é’®æ–‡æ¡ˆ
  updatePosterBtnText();

  // åŸ‹ç‚¹
  trackEvent('funnel', 'content_unlocked', finalType || 'unknown');

  // æç¤º
  toast('ğŸ‰ å®Œæ•´æŠ¥å‘Šå·²è§£é”');
}

// æ ¹æ®è§£é”çŠ¶æ€æ›´æ–°æµ·æŠ¥æŒ‰é’®æ–‡æ¡ˆ
function updatePosterBtnText() {
  var btn = document.getElementById('posterBtn');
  if (!btn) return;
  var isUnlocked = false;
  try { isUnlocked = localStorage.getItem(UNLOCK_KEY) === 'true'; } catch(e) {}
  btn.textContent = isUnlocked ? 'âœ¨ ç”Ÿæˆä¸“å±æµ·æŠ¥' : 'ç”Ÿæˆç»“æœå›¾';
}

function renderQRCode(url){
  if (typeof QRCode === 'undefined') { console.warn('QRCode library not loaded'); return; }
  // ç¡®ä¿ url æ˜¯å¯è®¿é—®çš„ http/https åœ°å€ï¼Œfile:// åè®®ä¼šå½±å“éƒ¨åˆ†æ‰«ç å™¨
  const validUrl = url.startsWith('http') ? url : 'https://www.mclmpet.com/cat/'; // å…œåº•çº¿ä¸Šåœ°å€

  const container = document.getElementById("qrcode");

  if(!container) return;
  container.innerHTML = "";
  new QRCode(container, {
    text: validUrl,
    width: 96,
    height: 110,
    colorDark : "#1a1a1a",
    colorLight : "#ffffff",
    correctLevel : QRCode.Level ? QRCode.Level.H : 3 // QRCode.Level å¯èƒ½ä¸å­˜åœ¨ï¼ŒLevel.H å¯¹åº” 3
  });
}

/* ç‚¹å‡»"ç”Ÿæˆç»“æœå›¾"å…¥å£ï¼šæ£€æŸ¥æ˜¯å¦éœ€è¦æé†’ä¸Šä¼ å¤´åƒ */
function handleGeneratePoster() {
  const isDefault = !avatarUploaded && (function(){
    try { return !localStorage.getItem(AVATAR_KEY); } catch(e){ return true; }
  })();
  const container = document.getElementById("avatarRemindContainer");

  if (isDefault && container && !container.querySelector('.avatar-remind-card')) {
    trackEvent('avatar', 'avatar_remind_shown', finalType);
    container.innerHTML = `
      <div class="avatar-remind-card">
        <div class="remind-icon">ğŸ“·</div>
        <div class="remind-text"><strong>ä¸Šä¼  TA çš„ç…§ç‰‡ï¼Œæµ·æŠ¥æ›´æœ‰ä¸“å±æ„Ÿ</strong><br/>ä¸€å¼ æœ‰ä½ å®¶çŒ«ä¸»å­å¤´åƒçš„æµ·æŠ¥æ‰å€¼å¾—æ™’</div>
        <div class="remind-actions">
          <button class="remind-btn remind-btn-upload" onclick="remindUploadAvatar()">ä¸Šä¼ ç…§ç‰‡</button>
          <button class="remind-btn remind-btn-skip" onclick="remindSkipAvatar()">å…ˆç”¨é»˜è®¤å¤´åƒ</button>
        </div>
      </div>
    `;
    return;
  }
  savePoster();
}

let _fromRemindCard = false;
function remindUploadAvatar() {
  _fromRemindCard = true;
  openAvatarPicker();
  // å…³é—­æé†’å¡
  const container = document.getElementById("avatarRemindContainer");
  if (container) container.innerHTML = "";
}

function remindSkipAvatar() {
  const container = document.getElementById("avatarRemindContainer");
  if (container) container.innerHTML = "";
  savePoster();
}

async function savePoster(options = {}){
  try{
    const opts = {
      autoDownload: true,
      showLoadingToast: true,
      showSuccessToast: true,
      refreshOnly: false,
      ...options
    };

    // æ‡’åŠ è½½ html2canvasï¼ˆé¦–æ¬¡ç”Ÿæˆæµ·æŠ¥æ—¶æ‰ä¸‹è½½ï¼‰
    try { await ensureHtml2Canvas(); } catch(e) {}
    if (typeof html2canvas === 'undefined') {
      toast("æµ·æŠ¥ç»„ä»¶åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•");
      return;
    }

    // æ ¹æ®è§£é”çŠ¶æ€é€‰æ‹©æµ·æŠ¥ç‰ˆæœ¬
    var _isUnlockedForPoster = false;
    try { _isUnlockedForPoster = localStorage.getItem(UNLOCK_KEY) === 'true'; } catch(e) {}
    const posterId = _isUnlockedForPoster ? "resultCard" : "resultCardFree";
    const el = document.getElementById(posterId);
    if(!el){ toast("æ²¡æ‰¾åˆ°ç»“æœå¡"); return; }

    if(opts.showLoadingToast){
      toast(opts.refreshOnly ? "æ­£åœ¨æ›´æ–°æµ·æŠ¥..." : "æµ·æŠ¥ç”Ÿæˆä¸­...");
    }
    // å»¶è¿Ÿç¡®ä¿äºŒç»´ç æ¸²æŸ“å®Œæˆ
    await new Promise(resolve => setTimeout(resolve, 150));

    // ä¸´æ—¶åˆ‡æ¢ä¸º absolute ä»¥ä¾¿ html2canvas æ­£ç¡®æ•è·
    el.style.position = 'absolute';
    el.style.left = '0';
    el.style.top = '0';
    el.style.zIndex = '-1';

    const canvas = await html2canvas(el, {
      scale: 2,
      useCORS: true,
      backgroundColor: "#ffffff",
      width: 540,
      height: 960
    });

    // æ¢å¤ fixed å®šä½
    el.style.position = 'fixed';
    el.style.left = '-9999px';
    el.style.zIndex = '';


    const dataUrl = canvas.toDataURL("image/png");

    // å…¨å±é®ç½©å±•ç¤ºæµ·æŠ¥
    const fsImg = document.getElementById("posterFsImg");
    const fs = document.getElementById("posterFullscreen");
    if (fsImg) fsImg.src = dataUrl;
    if (fs && !opts.refreshOnly) fs.classList.add("is-show");

    // PC å°è¯•ä¸‹è½½
    if(opts.autoDownload && !/MicroMessenger/i.test(navigator.userAgent)){
      const a = document.createElement("a");
      a.href = dataUrl;
      a.download = `çŒ«å’ªMBTI-${finalType || "RESULT"}.png`;
      a.click();
    }

    if (!opts.refreshOnly) trackEvent('funnel', 'poster_generated', finalType || 'unknown');
    if(opts.showSuccessToast && opts.refreshOnly){
      toast("å¤´åƒå·²æ›´æ–°ï¼Œæµ·æŠ¥å·²åˆ·æ–°");
    }

    // äºŒæ¬¡è½¬åŒ–ï¼šç”¨æˆ·æ»šåŠ¨åˆ°ç¤¾åŒºå¡ç‰‡åŒºåŸŸæ—¶å¼¹çª—ï¼ˆä»…é™ä¸€æ¬¡ï¼‰
    // å¦‚æœç”¨æˆ·å·²è§£é”å†…å®¹ï¼Œè¯´æ˜å·²ç»å¼•å¯¼è¿‡åŠ ä¼å¾®äº†ï¼Œä¸å†è‡ªåŠ¨å¼¹çª—
    var _isUnlocked = false;
    try { _isUnlocked = localStorage.getItem(UNLOCK_KEY) === 'true'; } catch(e) {}
    if (!hasShownWecomModal && !_isUnlocked) {
      hasShownWecomModal = true;
      var communityCard = document.querySelector('.community-card');
      if (communityCard && typeof IntersectionObserver !== 'undefined') {
        var wecomObserver = new IntersectionObserver(function(entries) {
          entries.forEach(function(entry) {
            if (entry.isIntersecting) {
              wecomObserver.disconnect();
              setTimeout(function(){ showWecomModal(); }, 1000);
            }
          });
        }, { threshold: 0.3 });
        wecomObserver.observe(communityCard);
        // å…œåº•ï¼š15ç§’åä»æœªæ»šåŠ¨åˆ°åˆ™è‡ªåŠ¨å¼¹å‡º
        setTimeout(function() {
          wecomObserver.disconnect();
          var modal = document.getElementById("wecomModal");
          if (modal && modal.style.display !== "flex") showWecomModal();
        }, 15000);
      } else {
        // ä¸æ”¯æŒ IntersectionObserver çš„æµè§ˆå™¨å…œåº•
        setTimeout(function(){ showWecomModal(); }, 8000);
      }
    }
  }catch(e){

    console.error(e);
    toast("ç”Ÿæˆå¤±è´¥ï¼Œè¯·æˆªå›¾ä¿å­˜");
  }
}

function setBar(p){


  const w = Math.max(0, Math.min(1, p)) * 100;
  const bar = document.getElementById("bar");
  if(bar) bar.style.width = w.toFixed(0) + "%";
}

function toast(msg){
  const el = document.getElementById("toast");
  el.innerText = msg;
  el.style.display = "block";
  clearTimeout(window.__t);
  window.__t = setTimeout(()=> el.style.display="none", 2000);
}

// å›åˆ°é¡¶éƒ¨æŒ‰é’®æ˜¾ç¤º/éšè—
(function(){
  var btn = document.getElementById('backToTop');
  if (!btn) return;
  var ticking = false;
  window.addEventListener('scroll', function(){
    if (!ticking) {
      requestAnimationFrame(function(){
        btn.classList.toggle('is-visible', window.scrollY > 400);
        ticking = false;
      });
      ticking = true;
    }
  }, { passive: true });
})();

